ace.define("ace/ext/hardwrap",["require","exports","module","ace/range","ace/editor","ace/config"],(function(e,t,n){"use strict";function o(e,t){function n(e,t,n){var o,i,r,a,s,c;if(!(e.length<t))return o=e.slice(0,t),i=e.slice(t),r=/^(?:(\s+)|(\S+)(\s+))/.exec(i),s=0,c=0,(a=/(?:(\s+)|(\s+)(\S+))$/.exec(o))&&!a[2]&&(s=t-a[1].length,c=t),r&&!r[2]&&(s||(s=t),c=t+r[1].length),s?{start:s,end:c}:a&&a[2]&&a.index>n?{start:a.index,end:a.index+a[2].length}:r&&r[2]?{start:s=t+r[2].length,end:s+r[3].length}:void 0}for(var o,i,a,s,c,l,u,h,d=t.column||e.getOption("printMarginColumn"),p=0!=t.allowMerge,f=Math.min(t.startRow,t.endRow),m=Math.max(t.startRow,t.endRow),g=e.session;f<=m;)(o=g.getLine(f)).length>d?((i=n(o,d,5))&&(a=/^\s*/.exec(o)[0],g.replace(new r(f,i.start,f,i.end),"\n"+a)),m++):p&&/\S/.test(o)&&f!=m&&(s=g.getLine(f+1))&&/\S/.test(s)&&((i=n(u=(c=o.replace(/\s+$/,""))+" "+(l=s.replace(/^\s+/,"")),d,5))&&i.start>c.length||u.length<d?(h=new r(f,c.length,f+1,s.length-l.length),g.replace(h," "),f--,m--):c.length<o.length&&g.remove(new r(f,c.length,f,o.length))),f++}function i(e){var t,n,i;if("insertstring"==e.command.name&&/\S/.test(e.args)){if((n=(t=e.editor).selection.cursor).column<=t.renderer.$printMarginColumn)return;i=t.session.$undoManager.$lastDelta,o(t,{startRow:n.row,endRow:n.row,allowMerge:!1}),i!=t.session.$undoManager.$lastDelta&&t.session.markUndoGroup()}}var r=e("../range").Range,a=e("../editor").Editor;e("../config").defineOptions(a.prototype,"editor",{hardWrap:{set:function(e){e?this.commands.on("afterExec",i):this.commands.off("afterExec",i)},value:!1}}),t.hardWrap=o})),ace.define("ace/keyboard/vim",["require","exports","module","ace/range","ace/lib/event_emitter","ace/lib/dom","ace/lib/oop","ace/lib/keys","ace/lib/event","ace/search","ace/lib/useragent","ace/search_highlight","ace/commands/multi_select_commands","ace/mode/text","ace/ext/hardwrap","ace/multi_select"],(function(e,t,n){"use strict";function o(e){return{row:e.line,column:e.ch}}function i(e){return new Ve(e.row,e.column)}function r(e,t,n){var o;return t.line===n.line&&t.ch>=n.ch-1&&55296<=(o=e.getLine(t.line).charCodeAt(t.ch))&&o<=55551&&(n.ch+=1),{start:t,end:n}}function a(e){e.setOption("disableInput",!0),e.setOption("showCursorWhenSelecting",!1),De.signal(e,"vim-mode-change",{mode:"normal"}),e.on("cursorActivity",Oe),C(e),De.on(e.getInputField(),"paste",c(e))}function s(e){e.setOption("disableInput",!1),e.off("cursorActivity",Oe),De.off(e.getInputField(),"paste",c(e)),e.state.vim=null,Ct&&clearTimeout(Ct)}function c(e){var t=e.state.vim;return t.onPasteFn||(t.onPasteFn=function(){t.insertMode||(e.setCursor(K(e.getCursor(),0,1)),ft.enterInsertMode(e,{},t))}),t.onPasteFn}function l(e,t){return t>=e.firstLine()&&t<=e.lastLine()}function u(e){return/^[a-z]$/.test(e)}function h(e){return Ze.test(e)}function d(e){return/^\s*$/.test(e)}function p(e){return-1!=".?!".indexOf(e)}function f(e,t){for(var n=0;n<t.length;n++)if(t[n]==e)return!0;return!1}function m(e,t,n,o,i){if(void 0===t&&!i)throw Error("defaultValue is required unless callback is provided");if(n||(n="string"),Ye[e]={type:n,defaultValue:t,callback:i},o)for(var r=0;r<o.length;r++)Ye[o[r]]=Ye[e];t&&g(e,t)}function g(e,t,n,o){var i,r=Ye[e];if(i=(o=o||{}).scope,!r)return new Error("Unknown option: "+e);if("boolean"==r.type){if(t&&!0!==t)return new Error("Invalid argument: "+e+"="+t);!1!==t&&(t=!0)}r.callback?("local"!==i&&r.callback(t,void 0),"global"!==i&&n&&r.callback(t,n)):("local"!==i&&(r.value="boolean"==r.type?!!t:t),"global"!==i&&n&&(n.state.vim.options[e]={value:t}))}function y(e,t,n){var o,i,r=Ye[e];return o=(n=n||{}).scope,r?r.callback?(i=t&&r.callback(void 0,t),"global"!==o&&void 0!==i?i:"local"!==o?r.callback():void 0):((i="global"!==o&&t&&t.state.vim.options[e])||"local"!==o&&r||{}).value:new Error("Unknown option: "+e)}function v(){this.latestRegister=void 0,this.isPlaying=!1,this.isRecording=!1,this.replaySearchQueries=[],this.onRecordingDone=void 0,this.lastInsertModeChanges=tt()}function C(e){return e.state.vim||(e.state.vim={inputState:new b,lastEditInputState:void 0,lastEditActionCommand:void 0,lastHPos:-1,lastHSPos:-1,lastMotion:null,marks:{},insertMode:!1,insertModeReturn:!1,insertModeRepeat:void 0,visualMode:!1,visualLine:!1,visualBlock:!1,lastSelection:null,lastPastedText:null,sel:{},options:{},expectLiteralNext:!1}),e.state.vim}function w(){var e,t;for(e in nt={searchQuery:null,searchIsReversed:!1,lastSubstituteReplacePart:void 0,jumpList:et(),macroModeState:new v,lastCharacterSearch:{increment:0,forward:!0,selectedCharacter:""},registerController:new O({}),searchHistoryController:new R,exCommandHistoryController:new R},Ye)(t=Ye[e]).value=t.defaultValue}function k(e){function t(e){"string"==typeof e?st.value=e:st=null}var n,o,i,r,a;if("<"==e[0])if(o=(n=e.toLowerCase().slice(1,-1)).split("-"),"lt"==(n=o.pop()||""))e="<";else if("space"==n)e=" ";else if("cr"==n)e="\n";else if(ut[n])return i=st.value,r={key:ut[n],target:{value:i,selectionEnd:i.length,selectionStart:i.length}},st.onKeyDown&&st.onKeyDown(r,st.value,t),void(st&&st.onKeyUp&&st.onKeyUp(r,st.value,t));"\n"==e?(a=st,st=null,a.onClose&&a.onClose(a.value)):st.value=(st.value||"")+e}function S(e,t,n){var o,i,r,a,s,c,l,u,h=at;if(n){if(-1!=rt.indexOf(n))return;rt.push(n),at=0!=n.noremap}try{for(o=C(e),i=/<(?:[CSMA]-)*\w+>|./gi;r=i.exec(t);)if(a=r[0],s=o.insertMode,st)k(a);else if(!it.handleKey(e,a,"mapping")&&s&&o.insertMode){if("<"==a[0])if(l=(c=a.toLowerCase().slice(1,-1)).split("-"),"lt"==(c=l.pop()||""))a="<";else if("space"==c)a=" ";else if("cr"==c)a="\n";else{if(ut.hasOwnProperty(c)){Ke(e,a=ut[c]);continue}a=a[0],i.lastIndex=r.index+1}e.replaceSelection(a)}}finally{rt.pop(),at=!!rt.length&&h,!rt.length&&st&&(u=st,st=null,ve(e,u))}}function x(e,t){var n,o,i=e.key;if(!lt[i])return i.length>1&&"n"==i[0]&&(i=i.replace("Numpad","")),i=ct[i]||i,n="",e.ctrlKey&&(n+="C-"),e.altKey&&(n+="A-"),e.metaKey&&(n+="M-"),De.isMac&&e.altKey&&!e.metaKey&&!e.ctrlKey&&(n=n.slice(2)),(n||i.length>1)&&e.shiftKey&&(n+="S-"),t&&!t.expectLiteralNext&&1==i.length&&(Ue.keymap&&i in Ue.keymap?0==Ue.remapCtrl&&n||(i=Ue.keymap[i]):i.charCodeAt(0)>255&&(o=e.code&&e.code.slice(-1)||"",e.shiftKey||(o=o.toLowerCase()),o&&(i=o))),(n+=i).length>1&&(n="<"+n+">"),n}function M(e,t){Ue.string!==e&&(Ue=A(e)),Ue.remapCtrl=t}function A(e){function t(e){return e.split(/\\?(.)/).filter(Boolean)}var n={};return e?(e.split(/((?:[^\\,]|\\.)+),/).map((function(e){var o,i,r,a,s;if(e)if(3==(o=e.split(/((?:[^\\;]|\\.)+);/)).length){if(i=t(o[1]),r=t(o[2]),i.length!==r.length)return;for(a=0;a<i.length;++a)n[i[a]]=r[a]}else if(1==o.length){if((s=t(e)).length%2!=0)return;for(a=0;a<s.length;a+=2)n[s[a]]=s[a+1]}})),{keymap:n,string:e}):{keymap:n,string:""}}function b(){this.prefixRepeat=[],this.motionRepeat=[],this.operator=null,this.operatorArgs=null,this.motion=null,this.motionArgs=null,this.keyBuffer=[],this.registerName=null,this.changeQueue=null}function L(e,t){e.state.vim.inputState=new b,e.state.vim.expectLiteralNext=!1,De.signal(e,"vim-command-done",t)}function T(){this.removed=[],this.inserted=""}function E(e,t,n){this.clear(),this.keyBuffer=[e||""],this.insertModeChanges=[],this.searchQueries=[],this.linewise=!!t,this.blockwise=!!n}function O(e){this.registers=e,this.unnamedRegister=e['"']=new E,e["."]=new E,e[":"]=new E,e["/"]=new E,e["+"]=new E}function R(){this.historyBuffer=[],this.iterator=0,this.initialPrefix=null}function B(e,t){var n,o=[];for(n=0;n<t;n++)o.push(e);return o}function I(e,t,n){var o,i=e.state.vim,r=i.insertMode||i.visualMode,a=Math.min(Math.max(e.firstLine(),t.line),e.lastLine()),s=e.getLine(a),c=s.length-1+Number(!!r),l=Math.min(Math.max(0,t.ch),c),u=s.charCodeAt(l);return 56320<=u&&u<=57343&&(o=1,n&&n.line==a&&n.ch>l&&(o=-1),(l+=o)>c&&(l-=2)),new Ve(a,l)}function N(e){var t,n={};for(t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n}function K(e,t,n){return"object"==typeof t&&(n=t.ch,t=t.line),new Ve(e.line+t,e.ch+n)}function P(e,t){var n,o,i,r="<character>"==t.slice(-11),a="<register>"==t.slice(-10);return r||a?(n=t.length-(r?11:10),(o=e.slice(0,n))==(i=t.slice(0,n))&&e.length>n?"full":0==i.indexOf(o)&&"partial"):e==t?"full":0==t.indexOf(e)&&"partial"}function H(e,t,n){return function(){for(var o=0;o<n;o++)t(e)}}function _(e){return new Ve(e.line,e.ch)}function $(e,t){return e.ch==t.ch&&e.line==t.line}function D(e,t){return e.line<t.line||e.line==t.line&&e.ch<t.ch}function V(e,t){return arguments.length>2&&(t=V.apply(void 0,Array.prototype.slice.call(arguments,1))),D(e,t)?e:t}function W(e,t){return arguments.length>2&&(t=W.apply(void 0,Array.prototype.slice.call(arguments,1))),D(e,t)?t:e}function j(e,t,n){var o=D(e,t),i=D(t,n);return o&&i}function F(e,t){return e.getLine(t).length}function U(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function z(e,t,n){var o=F(e,t),i=new Array(n-o+1).join(" ");e.setCursor(new Ve(t,o)),e.replaceRange(i,e.getCursor())}function Q(e,t){var n,o,i=[],r=e.listSelections(),a=_(e.clipPos(t)),s=!$(t,a),c=e.getCursor("head"),l=function(e,t,n){var o,i,r;for(o=0;o<e.length;o++)if(i="head"!=n&&$(e[o].anchor,t),r="anchor"!=n&&$(e[o].head,t),i||r)return o;return-1}(r,c),u=$(r[l].head,r[l].anchor),h=r.length-1,d=h-l>l?h:0,p=r[d].anchor,f=Math.min(p.line,a.line),m=Math.max(p.line,a.line),g=p.ch,y=a.ch,v=r[d].head.ch-g,C=y-g;for(v>0&&C<=0?(g++,s||y--):v<0&&C>=0?(g--,u||y++):v<0&&-1==C&&(g--,y++),n=f;n<=m;n++)o={anchor:new Ve(n,g),head:new Ve(n,y)},i.push(o);return e.setSelections(i),t.ch=y,p.ch=g,p}function q(e,t,n){var o,i,r=[];for(o=0;o<n;o++)i=K(t,o,0),r.push({anchor:i,head:i});e.setSelections(r,0)}function J(e,t){var n=t.sel.anchor,o=t.sel.head;t.lastPastedText&&(o=e.posFromIndex(e.indexFromPos(n)+t.lastPastedText.length),t.lastPastedText=null),t.lastSelection={anchorMark:e.setBookmark(n),headMark:e.setBookmark(o),anchor:_(n),head:_(o),visualMode:t.visualMode,visualLine:t.visualLine,visualBlock:t.visualBlock}}function G(e,t,n){var o,i=e.state.vim;o=X(e,t=t||i.sel,n=n||i.visualLine?"line":i.visualBlock?"block":"char"),e.setSelections(o.ranges,o.primary)}function X(e,t,n,o){var i,r,a,s,c,l,u,h,d,p,f,m=_(t.head),g=_(t.anchor);if("char"==n)return i=o||D(t.head,t.anchor)?0:1,r=D(t.head,t.anchor)?1:0,m=K(t.head,0,i),{ranges:[{anchor:g=K(t.anchor,0,r),head:m}],primary:0};if("line"==n)return D(t.head,t.anchor)?(m.ch=0,g.ch=F(e,g.line)):(g.ch=0,a=e.lastLine(),m.line>a&&(m.line=a),m.ch=F(e,m.line)),{ranges:[{anchor:g,head:m}],primary:0};if("block"==n){for(s=Math.min(g.line,m.line),c=g.ch,l=Math.max(g.line,m.line),c<(u=m.ch)?u+=1:c+=1,h=l-s+1,d=m.line==s?0:h-1,p=[],f=0;f<h;f++)p.push({anchor:new Ve(s+f,c),head:new Ve(s+f,u)});return{ranges:p,primary:d}}}function Z(e,t){var n=e.state.vim;!1!==t&&e.setCursor(I(e,n.sel.head)),J(e,n),n.visualMode=!1,n.visualLine=!1,n.visualBlock=!1,n.insertMode||De.signal(e,"vim-mode-change",{mode:"normal"})}function Y(e){if(!e)return 0;var t=e.search(/\S/);return-1==t?e.length:t}function ee(e,t,n){var o,i,r,a,s,c,l=t.inclusive,u=t.innerWord,h=t.bigWord,d=t.noSymbol,p=t.multiline,f=n||function(e){var t=e.getCursor("head");return 1==e.getSelection().length&&(t=V(t,e.getCursor("anchor"))),t}(e),m=e.getLine(f.line),g=m,y=f.line,v=y,C=f.ch,w=d?Qe[0]:qe[0];if(u&&/\s/.test(m.charAt(C)))w=function(e){return/\s/.test(e)};else{for(;!w(m.charAt(C));)if(++C>=m.length){if(!p)return null;C--,o=oe(e,f,!0,h,!0);break}h?w=qe[0]:(w=Qe[0])(m.charAt(C))||(w=Qe[1])}for(i=C,r=C;w(m.charAt(r))&&r>=0;)r--;if(r++,o)i=o.to,v=o.line,(g=e.getLine(v))||0!=i||i++;else for(;w(m.charAt(i))&&i<m.length;)i++;if(l){if(a=i,!(s=f.ch<=r&&/\s/.test(m.charAt(f.ch))))for(;/\s/.test(g.charAt(i))&&i<g.length;)i++;if(a==i||s){for(c=r;/\s/.test(m.charAt(r-1))&&r>0;)r--;r||s||(r=c)}}return{start:new Ve(y,r),end:new Ve(v,i)}}function te(e,t,n){$(t,n)||nt.jumpList.add(e,t,n)}function ne(e,t){nt.lastCharacterSearch.increment=e,nt.lastCharacterSearch.forward=t.forward,nt.lastCharacterSearch.selectedCharacter=t.selectedCharacter}function oe(e,t,n,o,i){var r,a,s,c,u,h=t.line,d=t.ch,p=e.getLine(h),f=n?1:-1,m=o?qe:Qe;if(i&&""==p){if(h+=f,p=e.getLine(h),!l(e,h))return null;d=n?0:p.length}for(;;){if(i&&""==p)return{from:0,to:0,line:h};for(a=r=f>0?p.length:-1,s=r;d!=r;){for(c=!1,u=0;u<m.length&&!c;++u)if(m[u](p.charAt(d))){for(a=d;d!=r&&m[u](p.charAt(d));)d+=f;if(c=a!=(s=d),a==t.ch&&h==t.line&&s==a+f)continue;return{from:Math.min(a,s+1),to:Math.max(a,s),line:h}}c||(d+=f)}if(!l(e,h+=f))return null;p=e.getLine(h),d=f>0?0:p.length}}function ie(e,t,n,o,i){var r=t,a=new Ve(r.line+n.repeat-1,1/0),s=e.clipPos(a);return s.ch--,i||(o.lastHPos=1/0,o.lastHSPos=e.charCoords(s,"div").left),a}function re(e,t,n,o,i){var r,a,s=i||e.getCursor(),c=s.ch;for(a=0;a<t;a++){if(-1==(r=se(c,e.getLine(s.line),o,n,!0)))return null;c=r}return new Ve(e.getCursor().line,r)}function ae(e,t,n,o){(f(n,Je)||Xe.test(n))&&(t.marks[n]&&t.marks[n].clear(),t.marks[n]=e.setBookmark(o))}function se(e,t,n,o,i){var r;return o?-1==(r=t.indexOf(n,e+1))||i||(r-=1):-1==(r=t.lastIndexOf(n,e-1))||i||(r+=1),r}function ce(e,t,n,o,i){function r(t){return!/\S/.test(e.getLine(t))}function a(e,t,n){return n?r(e)!=r(e+t):!r(e)&&r(e+t)}function s(t){o=o>0?1:-1;var n=e.ace.session.getFoldLine(t);n&&t+o>n.start.row&&t+o<n.end.row&&(o=(o>0?n.end.row:n.start.row)-t)}var c,l,u,h,d=t.line,p=e.firstLine(),f=e.lastLine(),m=d;if(o){for(;p<=m&&m<=f&&n>0;)s(m),a(m,o)&&n--,m+=o;return new Ve(m,0)}for((l=e.state.vim).visualLine&&a(d,1,!0)&&a((u=l.sel.anchor).line,-1,!0)&&(i&&u.line==d||(d+=1)),h=r(d),m=d;m<=f&&n;m++)a(m,1,!0)&&(i&&r(m)==h||n--);for(c=new Ve(m,0),m>f&&!h?h=!0:i=!1,m=d;m>p&&(i&&r(m)!=h&&m!=d||!a(m,-1,!0));m--);return{start:new Ve(m,0),end:c}}function le(e,t,n,o,i){function r(e){e.pos+e.dir<0||e.pos+e.dir>=e.line.length?e.line=null:e.pos+=e.dir}function a(e,t,n,o){var a,s=e.getLine(t),c={line:s,ln:t,pos:n,dir:o};if(""===c.line)return{ln:c.ln,pos:c.pos};for(a=c.pos,r(c);null!==c.line;){if(a=c.pos,p(c.line[c.pos])){if(i){for(r(c);null!==c.line&&d(c.line[c.pos]);)a=c.pos,r(c);return{ln:c.ln,pos:a+1}}return{ln:c.ln,pos:c.pos+1}}r(c)}return{ln:c.ln,pos:a+1}}function s(e,t,n,o){var a,s=e.getLine(t),c={line:s,ln:t,pos:n,dir:o};if(""===c.line)return{ln:c.ln,pos:c.pos};for(a=c.pos,r(c);null!==c.line;){if(d(c.line[c.pos])||p(c.line[c.pos])){if(p(c.line[c.pos]))return i&&d(c.line[c.pos+1])?{ln:c.ln,pos:c.pos+1}:{ln:c.ln,pos:a}}else a=c.pos;r(c)}return c.line=s,i&&d(c.line[c.pos])?{ln:c.ln,pos:c.pos}:{ln:c.ln,pos:a}}for(var c={ln:t.line,pos:t.ch};n>0;)c=o<0?s(e,c.ln,c.pos,o):a(e,c.ln,c.pos,o),n--;return new Ve(c.ln,c.pos)}function ue(e,t,n,o){var i,r=t,a={"(":/[()]/,")":/[()]/,"[":/[[\]]/,"]":/[[\]]/,"{":/[{}]/,"}":/[{}]/,"<":/[<>]/,">":/[<>]/}[n],s={"(":"(",")":"(","[":"[","]":"[","{":"{","}":"{","<":"<",">":"<"}[n],c=e.getLine(r.line).charAt(r.ch),l=c===s?1:0,u=e.scanForBracket(new Ve(r.line,r.ch+l),-1,void 0,{bracketRegex:a}),h=e.scanForBracket(new Ve(r.line,r.ch+l),1,void 0,{bracketRegex:a});return u&&h?(u=u.pos,h=h.pos,(u.line==h.line&&u.ch>h.ch||u.line>h.line)&&(i=u,u=h,h=i),o?h.ch+=1:u.ch+=1,{start:u,end:h}):null}function he(){}function de(e){var t=e.state.vim;return t.searchState_||(t.searchState_=new he)}function pe(e,t){var n,o,i=fe(e,t)||[];if(!i.length)return[];if(n=[],0===i[0]){for(o=0;o<i.length;o++)"number"==typeof i[o]&&n.push(e.substring(i[o]+1,i[o+1]));return n}}function fe(e,t){var n,o,i,r;for(t||(t="/"),n=!1,o=[],i=0;i<e.length;i++)r=e.charAt(i),n||r!=t||o.push(i),n=!n&&"\\"==r;return o}function me(e,t,n){var o,i,r,a=nt.registerController.getRegister("/");return a.setText(e),e instanceof RegExp?e:((o=fe(e,"/")).length?(i=e.substring(0,o[0]),r=-1!=e.substring(o[0]).indexOf("i")):i=e,i?(y("pcre")||(i=function(e){var t,n,o,i,r="|(){",a="}",s=!1,c=[];for(t=-1;t<e.length;t++)n=e.charAt(t)||"",i=(o=e.charAt(t+1)||"")&&-1!=r.indexOf(o),s?("\\"===n&&i||c.push(n),s=!1):"\\"===n?(s=!0,o&&-1!=a.indexOf(o)&&(i=!0),i&&"\\"!==o||c.push(n)):(c.push(n),i&&"\\"!==o&&c.push("\\"));return c.join("")}(i)),n&&(t=/^[^A-Z]*$/.test(i)),new RegExp(i,t||r?"im":"m")):null)}function ge(e){var t,n,o;for("string"==typeof e&&(e=document.createElement(e)),n=1;n<arguments.length;n++)if(t=arguments[n])if("object"!=typeof t&&(t=document.createTextNode(t)),t.nodeType)e.appendChild(t);else for(o in t)Object.prototype.hasOwnProperty.call(t,o)&&("$"===o[0]?e.style[o.slice(1)]=t[o]:e.setAttribute(o,t[o]));return e}function ye(e,t){var n=ge("div",{$color:"red",$whiteSpace:"pre",class:"cm-vim-message"},t);e.openNotification?e.openNotification(n,{bottom:!0,duration:5e3}):alert(n.innerText)}function ve(e,t){var n,o,i,r;if(rt.length)return t.value||(t.value=""),void(st=t);i=t.prefix,r=t.desc,n=ge("div",{$display:"flex"},ge("span",{$fontFamily:"monospace",$whiteSpace:"pre",$flex:1},i,ge("input",{type:"text",autocorrect:"off",autocapitalize:"off",spellcheck:"false",$width:"100%"})),r&&ge("span",{$color:"#888"},r)),e.openDialog?e.openDialog(n,t.onClose,{onKeyDown:t.onKeyDown,onKeyUp:t.onKeyUp,bottom:!0,selectValueOnOpen:!1,value:t.value}):(o="","string"!=typeof t.prefix&&t.prefix&&(o+=t.prefix.textContent),t.desc&&(o+=" "+t.desc),t.onClose(prompt(o,"")))}function Ce(e,t,n,o){var i,r;if(t&&(i=de(e),r=me(t,!!n,!!o)))return we(e,r),function(e,t){var n,o,i;if(e instanceof RegExp&&t instanceof RegExp){for(n=["global","multiline","ignoreCase","source"],o=0;o<n.length;o++)if(e[i=n[o]]!==t[i])return!1;return!0}return!1}(r,i.getQuery())||i.setQuery(r),r}function we(e,t){clearTimeout(Ct),de(e).highlightTimeout=Ct,Ct=setTimeout((function(){var n,o;e.state.vim&&((n=de(e)).highlightTimeout=null,(o=n.getOverlay())&&t==o.query||(o&&e.removeOverlay(o),o=function(e){if("^"==e.source.charAt(0))var t=!0;return{token:function(n){if(!t||n.sol()){var o=n.match(e,!1);if(o)return 0==o[0].length?(n.next(),"searching"):n.sol()||(n.backUp(1),e.exec(n.next()+o[0]))?(n.match(e),"searching"):(n.next(),null);for(;!n.eol()&&(n.next(),!n.match(e,!1)););}else n.skipToEnd()},query:e}}(t),e.addOverlay(o),e.showMatchesOnScrollbar&&(n.getScrollbarAnnotate()&&n.getScrollbarAnnotate().clear(),n.setScrollbarAnnotate(e.showMatchesOnScrollbar(t))),n.setOverlay(o)))}),50)}function ke(e,t,n,o){return void 0===o&&(o=1),e.operation((function(){var i,r,a,s=e.getCursor(),c=e.getSearchCursor(n,s);for(i=0;i<o;i++)if(r=c.find(t),0==i&&r&&$(c.from(),s)&&(a=t?c.from():c.to(),(r=c.find(t))&&!r[0]&&$(c.from(),a)&&e.getLine(a.line).length==a.ch&&(r=c.find(t))),!r&&!(c=e.getSearchCursor(n,t?new Ve(e.lastLine()):new Ve(e.firstLine(),0))).find(t))return;return c.from()}))}function Se(e){var t=de(e);t.highlightTimeout&&(clearTimeout(t.highlightTimeout),t.highlightTimeout=null),e.removeOverlay(de(e).getOverlay()),t.setOverlay(null),t.getScrollbarAnnotate()&&(t.getScrollbarAnnotate().clear(),t.setScrollbarAnnotate(null))}function xe(e){var t=e.ace.renderer;return{top:t.getFirstFullyVisibleRow(),bottom:t.getLastFullyVisibleRow()}}function Me(e,t,n){if("'"==n||"`"==n)return nt.jumpList.find(e,-1)||new Ve(0,0);if("."==n)return Ae(e);var o=t.marks[n];return o&&o.find()}function Ae(e){var t,n;if(e.getLastEditEnd)return e.getLastEditEnd();for(n=(t=e.doc.history.done).length;n--;)if(t[n].changes)return _(t[n].changes[0].to)}function be(e,t){var n=e.state.vim,o=nt.macroModeState,i=nt.registerController.getRegister("."),r=o.isPlaying,a=o.lastInsertModeChanges;r||(e.off("change",Ee),n.insertEnd&&n.insertEnd.clear(),n.insertEnd=null,De.off(e.getInputField(),"keydown",Ie)),!r&&n.insertModeRepeat>1&&(Ne(e,n,n.insertModeRepeat-1,!0),n.lastEditInputState.repeatOverride=n.insertModeRepeat),delete n.insertModeRepeat,n.insertMode=!1,t||e.setCursor(e.getCursor().line,e.getCursor().ch-1),e.setOption("keyMap","vim"),e.setOption("disableInput",!0),e.toggleOverwrite(!1),i.setText(a.changes.join("")),De.signal(e,"vim-mode-change",{mode:"normal"}),o.isRecording&&function(e){if(e.isPlaying)return;var t=e.latestRegister,n=nt.registerController.getRegister(t);n&&n.pushInsertModeChanges&&n.pushInsertModeChanges(e.lastInsertModeChanges)}(o)}function Le(e){We.unshift(e)}function Te(e,t,n,o){var i,r,a,s,c,l,u,h=nt.registerController.getRegister(o);if(":"==o)return h.keyBuffer[0]&&St.processCommand(e,h.keyBuffer[0]),void(n.isPlaying=!1);for(i=h.keyBuffer,r=0,n.isPlaying=!0,n.replaySearchQueries=h.searchQueries.slice(0),a=0;a<i.length;a++)for(s=i[a];s;)l=(c=/<\w+-.+?>|<\w+>|./.exec(s))[0],s=s.substring(c.index+l.length),it.handleKey(e,l,"macro"),t.insertMode&&(u=h.insertModeChanges[r++].changes,nt.macroModeState.lastInsertModeChanges.changes=u,Pe(e,u,1),be(e));n.isPlaying=!1}function Ee(e,t){var n,o,i,r,a,s,c=nt.macroModeState,l=c.lastInsertModeChanges;if(!c.isPlaying)for(n=e.state.vim;t;)l.expectCursorActivityForChange=!0,l.ignoreCount>1?l.ignoreCount--:"+input"!=t.origin&&"paste"!=t.origin&&void 0!==t.origin||((o=e.listSelections().length)>1&&(l.ignoreCount=o),i=t.text.join("\n"),l.maybeReset&&(l.changes=[],l.maybeReset=!1),i&&(e.state.overwrite&&!/\n/.test(i)?l.changes.push([i]):(i.length>1&&(r=n&&n.insertEnd&&n.insertEnd.find(),a=e.getCursor(),r&&r.line==a.line&&(s=r.ch-a.ch)>0&&s<i.length&&(l.changes.push([i,s]),i="")),i&&l.changes.push(i)))),t=t.next}function Oe(e){var t,n,o=e.state.vim;if(o.insertMode){if((t=nt.macroModeState).isPlaying)return;(n=t.lastInsertModeChanges).expectCursorActivityForChange?n.expectCursorActivityForChange=!1:(n.maybeReset=!0,o.insertEnd&&o.insertEnd.clear(),o.insertEnd=e.setBookmark(e.getCursor(),{insertLeft:!0}))}else e.curOp.isVimOp||Re(e,o)}function Re(e,t,n){var o,i,r=e.getCursor("anchor"),a=e.getCursor("head");t.visualMode&&!e.somethingSelected()?Z(e,!1):t.visualMode||t.insertMode||!e.somethingSelected()||(t.visualMode=!0,t.visualLine=!1,De.signal(e,"vim-mode-change",{mode:"visual"})),t.visualMode?(o=D(a,r)?0:-1,i=D(a,r)?-1:0,a=K(a,0,o),r=K(r,0,i),t.sel={anchor:r,head:a},ae(e,t,"<",V(a,r)),ae(e,t,">",W(a,r))):t.insertMode||n||(t.lastHPos=e.getCursor().ch)}function Be(e,t){this.keyName=e,this.key=t.key,this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.metaKey=t.metaKey,this.shiftKey=t.shiftKey}function Ie(e){var t=nt.macroModeState,n=t.lastInsertModeChanges,o=De.keyName?De.keyName(e):e.key;o&&(-1==o.indexOf("Delete")&&-1==o.indexOf("Backspace")||(n.maybeReset&&(n.changes=[],n.maybeReset=!1),n.changes.push(new Be(o,e))))}function Ne(e,t,n,o){function i(){a?ht.processAction(e,t,t.lastEditActionCommand):ht.evalInput(e,t)}function r(n){if(l.lastInsertModeChanges.changes.length>0){n=t.lastEditActionCommand?n:1;var o=l.lastInsertModeChanges;Pe(e,o.changes,n)}}var a,s,c,l=nt.macroModeState;if(l.isPlaying=!0,a=!!t.lastEditActionCommand,s=t.inputState,t.inputState=t.lastEditInputState,a&&t.lastEditActionCommand.interlaceInsertRepeat)for(c=0;c<n;c++)i(),r(1);else o||i(),r(n);t.inputState=s,t.insertMode&&!o&&be(e),l.isPlaying=!1}function Ke(e,t){De.lookupKey(t,"vim-insert",(function(t){return"string"==typeof t?De.commands[t](e):t(e),!0}))}function Pe(e,t,n){var o,i,r,a,s,c=e.getCursor("head"),l=nt.macroModeState.lastInsertModeChanges.visualBlock;for(l&&(q(e,c,l+1),n=e.listSelections().length,e.setCursor(c)),o=0;o<n;o++)for(l&&e.setCursor(K(c,o,0)),i=0;i<t.length;i++)(r=t[i])instanceof Be?Ke(e,r.keyName):"string"==typeof r?e.replaceSelection(r):(s=K(a=e.getCursor(),0,r[0].length-(r[1]||0)),e.replaceRange(r[0],a,r[1]?a:s),e.setCursor(s));l&&e.setCursor(K(c,0,1))}function He(e){var t=new e.constructor;return Object.keys(e).forEach((function(n){if("insertEnd"!=n){var o=e[n];Array.isArray(o)?o=o.slice():o&&"object"==typeof o&&o.constructor!=Object&&(o=He(o)),t[n]=o}})),e.sel&&(t.sel={head:e.sel.head&&_(e.sel.head),anchor:e.sel.anchor&&_(e.sel.anchor)}),t}function _e(e,t,n){var o,i,r=!1,a=it.maybeInitVimState_(e),s=a.visualBlock||a.wasInVisualBlock,c=e.ace.inMultiSelectMode;return a.wasInVisualBlock&&!c?a.wasInVisualBlock=!1:c&&a.visualBlock&&(a.wasInVisualBlock=!0),"<Esc>"!=t||a.insertMode||a.visualMode||!c?s||!c||e.ace.inVirtualSelectionMode?r=it.handleKey(e,t,n):(o=He(a),i=a.inputState.changeQueueList||[],e.operation((function(){e.curOp.isVimOp=!0;var s=0;e.ace.forEachSelection((function(){var a,c,l,u,h=e.ace.selection;e.state.vim.lastHPos=null==h.$desiredColumn?h.lead.column:h.$desiredColumn,e.state.vim.inputState.changeQueue=i[s],l=D(a=e.getCursor("head"),c=e.getCursor("anchor"))?0:-1,u=D(a,c)?-1:0,a=K(a,0,l),c=K(c,0,u),e.state.vim.sel.head=a,e.state.vim.sel.anchor=c,r=Mt(e,t,n),h.$desiredColumn=-1==e.state.vim.lastHPos?null:e.state.vim.lastHPos,e.ace.inVirtualSelectionMode&&(i[s]=e.state.vim.inputState.changeQueue),e.virtualSelectionMode()&&(e.state.vim=He(o)),s++})),e.curOp.cursorActivity&&!r&&(e.curOp.cursorActivity=!1),a.status=e.state.vim.status,e.state.vim=a,a.inputState.changeQueueList=i,a.inputState.changeQueue=null}),!0)):e.ace.exitMultiSelectMode(),!r||a.visualMode||a.insert||a.visualMode==e.somethingSelected()||Re(e,a,!0),r}function $e(e,t){t.off("beforeEndOperation",$e);var n=t.state.cm.vimCmd;n&&t.execCommand(n.exec?n:n.name,n.args),t.curOp=t.prevOp}var De,Ve,We,je,Fe,Ue,ze,Qe,qe,Je,Ge,Xe,Ze,Ye,et,tt,nt,ot,it,rt,at,st,ct,lt,ut,ht,dt,pt,ft,mt,gt,yt,vt,Ct,wt,kt,St,xt,Mt,At,bt=e("../range").Range,Lt=e("../lib/event_emitter").EventEmitter,Tt=e("../lib/dom"),Et=e("../lib/oop"),Ot=e("../lib/keys"),Rt=e("../lib/event"),Bt=e("../search").Search,It=e("../lib/useragent"),Nt=e("../search_highlight").SearchHighlight,Kt=e("../commands/multi_select_commands"),Pt=e("../mode/text").Mode.prototype.tokenRe,Ht=e("../ext/hardwrap").hardWrap;e("../multi_select"),(De=function(e){this.ace=e,this.state={},this.marks={},this.options={},this.$uid=0,this.onChange=this.onChange.bind(this),this.onSelectionChange=this.onSelectionChange.bind(this),this.onBeforeEndOperation=this.onBeforeEndOperation.bind(this),this.ace.on("change",this.onChange),this.ace.on("changeSelection",this.onSelectionChange),this.ace.on("beforeEndOperation",this.onBeforeEndOperation)}).Pos=function(e,t){if(!(this instanceof Ve))return new Ve(e,t);this.line=e,this.ch=t},De.defineOption=function(e,t,n){},De.commands={redo:function(e){e.ace.redo()},undo:function(e){e.ace.undo()},newlineAndIndent:function(e){e.ace.insert("\n")},goLineLeft:function(e){e.ace.selection.moveCursorLineStart()},goLineRight:function(e){e.ace.selection.moveCursorLineEnd()}},De.keyMap={},De.addClass=De.rmClass=function(){},De.e_stop=De.e_preventDefault=Rt.stopEvent,De.keyName=function(e){var t=Ot[e.keyCode]||e.key||"";return 1==t.length&&(t=t.toUpperCase()),t=Rt.getModifierString(e).replace(/(^|-)\w/g,(function(e){return e.toUpperCase()}))+t},De.keyMap.default=function(e){return function(t){var n=t.ace.commands.commandKeyBinding[e.toLowerCase()];return n&&!1!==t.ace.execCommand(n)}},De.lookupKey=function e(t,n,o){var i,r,a;if(n||(n="default"),"string"==typeof n&&(n=De.keyMap[n]||De.keyMap.default),!1===(i="function"==typeof n?n(t):n[t]))return"nothing";if("..."===i)return"multi";if(null!=i&&o(i))return"handled";if(n.fallthrough){if(!Array.isArray(n.fallthrough))return e(t,n.fallthrough,o);for(r=0;r<n.fallthrough.length;r++)if(a=e(t,n.fallthrough[r],o))return a}},De.findMatchingTag=function(e,t){return e.findMatchingTag(t)},De.findEnclosingTag=function(e,t){},De.signal=function(e,t,n){return e._signal(t,n)},De.on=Rt.addListener,De.off=Rt.removeListener,De.isWordChar=function(e){return e<""?/^\w$/.test(e):(Pt.lastIndex=0,Pt.test(e))},function(){var e,t;Et.implement(De.prototype,Lt),this.destroy=function(){this.ace.off("change",this.onChange),this.ace.off("changeSelection",this.onSelectionChange),this.ace.off("beforeEndOperation",this.onBeforeEndOperation),this.removeOverlay()},this.virtualSelectionMode=function(){return this.ace.inVirtualSelectionMode&&this.ace.selection.index},this.onChange=function(e){var t,n;this.$lineHandleChanges&&this.$lineHandleChanges.push(e),t={text:"i"==e.action[0]?e.lines:[]},(n=this.curOp=this.curOp||{}).changeHandlers||(n.changeHandlers=this._eventRegistry.change&&this._eventRegistry.change.slice()),n.lastChange?n.lastChange.next=n.lastChange=t:n.lastChange=n.change=t,this.$updateMarkers(e)},this.onSelectionChange=function(){var e=this.curOp=this.curOp||{};e.cursorActivityHandlers||(e.cursorActivityHandlers=this._eventRegistry.cursorActivity&&this._eventRegistry.cursorActivity.slice()),this.curOp.cursorActivity=!0,this.ace.inMultiSelectMode&&this.ace.keyBinding.removeKeyboardHandler(Kt.keyboardHandler)},this.operation=function(e,t){var n,o,i;return!t&&this.curOp||t&&this.curOp&&this.curOp.force?e():(!t&&this.ace.curOp||this.curOp&&this.onBeforeEndOperation(),this.ace.curOp||(n=this.ace.prevOp,this.ace.startOperation({command:{name:"vim",scrollIntoView:"cursor"}})),o=this.curOp=this.curOp||{},this.curOp.force=t,i=e(),this.ace.curOp&&"vim"==this.ace.curOp.command.name&&(this.state.dialog&&(this.ace.curOp.command.scrollIntoView=this.ace.curOp.vimDialogScroll),this.ace.endOperation(),o.cursorActivity||o.lastChange||!n||(this.ace.prevOp=n)),!t&&this.ace.curOp||this.curOp&&this.onBeforeEndOperation(),i)},this.onBeforeEndOperation=function(){var e=this.curOp;e&&(e.change&&this.signal("change",e.change,e),e&&e.cursorActivity&&this.signal("cursorActivity",null,e),this.curOp=null)},this.signal=function(e,t,n){var o,i=n?n[e+"Handlers"]:(this._eventRegistry||{})[e];if(i)for(i=i.slice(),o=0;o<i.length;o++)i[o](this,t)},this.firstLine=function(){return 0},this.lastLine=function(){return this.ace.session.getLength()-1},this.lineCount=function(){return this.ace.session.getLength()},this.setCursor=function(e,t){"object"==typeof e&&(t=e.ch,e=e.line);var n=!this.curOp&&!this.ace.inVirtualSelectionMode;this.ace.inVirtualSelectionMode||this.ace.exitMultiSelectMode(),this.ace.session.unfold({row:e,column:t}),this.ace.selection.moveTo(e,t),n&&(this.ace.renderer.scrollCursorIntoView(),this.ace.endOperation())},this.getCursor=function(e){var t=this.ace.selection,n="anchor"==e?t.isEmpty()?t.lead:t.anchor:"head"!=e&&e?t.getRange()[e]:t.lead;return i(n)},this.listSelections=function(e){var t=this.ace.multiSelect.rangeList.ranges;return!t.length||this.ace.inVirtualSelectionMode?[{anchor:this.getCursor("anchor"),head:this.getCursor("head")}]:t.map((function(e){return{anchor:this.clipPos(i(e.cursor==e.end?e.start:e.end)),head:this.clipPos(i(e.cursor))}}),this)},this.setSelections=function(e,t){var n,i,r,a=this.ace.multiSelect,s=e.map((function(e){var t=o(e.anchor),n=o(e.head),i=bt.comparePoints(t,n)<0?new bt.fromPoints(t,n):new bt.fromPoints(n,t);return i.cursor=bt.comparePoints(i.start,n)?i.end:i.start,i}));if(this.ace.inVirtualSelectionMode)this.ace.selection.fromOrientedRange(s[0]);else for(t?s[t]&&s.push(s.splice(t,1)[0]):s=s.reverse(),a.toSingleRange(s[0].clone()),n=this.ace.session,i=0;i<s.length;i++)r=n.$clipRangeToDocument(s[i]),a.addRange(r)},this.setSelection=function(e,t,n){var o=this.ace.selection;o.moveTo(e.line,e.ch),o.selectTo(t.line,t.ch),n&&"*mouse"==n.origin&&this.onBeforeEndOperation()},this.somethingSelected=function(e){return!this.ace.selection.isEmpty()},this.clipPos=function(e){return i(this.ace.session.$clipPositionToDocument(e.line,e.ch))},this.foldCode=function(e){this.ace.session.$toggleFoldWidget(e.line,{})},this.markText=function(e){return{clear:function(){},find:function(){}}},this.$updateMarkers=function(e){var t,n,o,i,r="insert"==e.action,a=e.start,s=e.end,c=(s.row-a.row)*(r?1:-1),l=(s.column-a.column)*(r?1:-1);for(t in r&&(s=a),this.marks)if(n=this.marks[t],!((o=bt.comparePoints(n,a))<0)){if(0===o&&r)if(n.$insertRight){if(1!=n.bias){n.bias=-1;continue}o=1}else o=1;(i=r?o:bt.comparePoints(n,s))>0?(n.row+=c,n.column+=n.row==s.row?l:0):!r&&i<=0&&(n.row=a.row,n.column=a.column,0===i&&(n.bias=1))}},(e=function(e,t,n,o){this.cm=e,this.id=t,this.row=n,this.column=o,e.marks[this.id]=this}).prototype.clear=function(){delete this.cm.marks[this.id]},e.prototype.find=function(){return i(this)},this.setBookmark=function(t,n){var o=new e(this,this.$uid++,t.line,t.ch);return n&&n.insertLeft||(o.$insertRight=!0),this.marks[o.id]=o,o},this.moveH=function(e,t){if("char"==t){var n=this.ace.selection;n.clearSelection(),n.moveCursorBy(0,e)}},this.findPosV=function(e,t,n,o){var r,a;if("page"==n&&(r=this.ace.renderer.layerConfig,t*=Math.floor(r.height/r.lineHeight),n="line"),"line"==n)return a=this.ace.session.documentToScreenPosition(e.line,e.ch),null!=o&&(a.column=o),a.row+=t,a.row=Math.min(Math.max(0,a.row),this.ace.session.getScreenLength()-1),i(this.ace.session.screenToDocumentPosition(a.row,a.column))},this.charCoords=function(e,t){var n,o,i,r,a;return"div"!=t&&t?"local"==t?(o=this.ace.renderer,n=this.ace.session.documentToScreenPosition(e.line,e.ch),i=o.layerConfig.lineHeight,r=o.layerConfig.characterWidth,a=i*n.row,{left:n.column*r,top:a,bottom:a+i}):void 0:{left:(n=this.ace.session.documentToScreenPosition(e.line,e.ch)).column,top:n.row}},this.coordsChar=function(e,t){var n,o,r=this.ace.renderer;if("local"==t)return n=Math.max(0,Math.floor(e.top/r.lineHeight)),o=Math.max(0,Math.floor(e.left/r.characterWidth)),i(r.session.screenToDocumentPosition(n,o));if("div"==t)throw"not implemented"},this.getSearchCursor=function(e,t,n){var o,r,a,s,c=!1,l=!1;return e instanceof RegExp&&!e.global&&(c=!e.ignoreCase,e=e.source,l=!0),"\\n"==e&&(e="\n",l=!1),o=new Bt,null==t.ch&&(t.ch=Number.MAX_VALUE),r={row:t.line,column:t.ch},a=this,s=null,{findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(t){o.setOptions({needle:e,caseSensitive:c,wrap:!1,backwards:t,regExp:l,start:s||r});var n=o.find(a.ace.session);return(s=n)&&[!s.isEmpty()]},from:function(){return s&&i(s.start)},to:function(){return s&&i(s.end)},replace:function(e){s&&(s.end=a.ace.session.doc.replace(s,e))}}},this.scrollTo=function(e,t){var n=this.ace.renderer,o=n.layerConfig,i=o.maxHeight;i-=(n.$size.scrollerHeight-n.lineHeight)*n.$scrollPastEnd,null!=t&&this.ace.session.setScrollTop(Math.max(0,Math.min(t,i))),null!=e&&this.ace.session.setScrollLeft(Math.max(0,Math.min(e,o.width)))},this.scrollInfo=function(){return 0},this.scrollIntoView=function(e,t){var n,i;e&&(i={top:0,bottom:t},(n=this.ace.renderer).scrollCursorIntoView(o(e),2*n.lineHeight/n.$size.scrollerHeight,i))},this.getLine=function(e){return this.ace.session.getLine(e)},this.getRange=function(e,t){return this.ace.session.getTextRange(new bt(e.line,e.ch,t.line,t.ch))},this.replaceRange=function(e,t,n){n||(n=t);var o=new bt(t.line,t.ch,n.line,n.ch);return this.ace.session.$clipRangeToDocument(o),this.ace.session.replace(o,e)},this.replaceSelection=this.replaceSelections=function(e){var t,n,o=Array.isArray(e)&&e,i=this.ace.selection;if(this.ace.inVirtualSelectionMode)this.ace.session.replace(i.getRange(),o?e[0]||"":e);else{for(i.inVirtualSelectionMode=!0,(t=i.rangeList.ranges).length||(t=[this.ace.multiSelect.getRange()]),n=t.length;n--;)this.ace.session.replace(t[n],o?e[n]||"":e);i.inVirtualSelectionMode=!1}},this.getSelection=function(){return this.ace.getSelectedText()},this.getSelections=function(){return this.listSelections().map((function(e){return this.getRange(e.anchor,e.head)}),this)},this.getInputField=function(){return this.ace.textInput.getElement()},this.getWrapperElement=function(){return this.ace.container},t={indentWithTabs:"useSoftTabs",indentUnit:"tabSize",tabSize:"tabSize",firstLineNumber:"firstLineNumber",readOnly:"readOnly"},this.setOption=function(e,n){switch(this.state[e]=n,e){case"indentWithTabs":e=t[e],n=!n;break;case"keyMap":return void(this.state.$keyMap=n);default:e=t[e]}e&&this.ace.setOption(e,n)},this.getOption=function(e){var n,o=t[e];switch(o&&(n=this.ace.getOption(o)),e){case"indentWithTabs":return e=t[e],!n;case"keyMap":return this.state.$keyMap||"vim"}return o?n:this.state[e]},this.toggleOverwrite=function(e){return this.state.overwrite=e,this.ace.setOverwrite(e)},this.addOverlay=function(e){var t,n,o;this.$searchHighlight&&this.$searchHighlight.session||(t=new Nt(null,"ace_highlight-marker","text"),n=this.ace.session.addDynamicMarker(t),t.id=n.id,t.session=this.ace.session,t.destroy=function(e){t.session.off("change",t.updateOnChange),t.session.off("changeEditor",t.destroy),t.session.removeMarker(t.id),t.session=null},t.updateOnChange=function(e){var n=e.start.row;n==e.end.row?t.cache[n]=void 0:t.cache.splice(n,t.cache.length)},t.session.on("changeEditor",t.destroy),t.session.on("change",t.updateOnChange)),o=new RegExp(e.query.source,"gmi"),this.$searchHighlight=e.highlight=t,this.$searchHighlight.setRegexp(o),this.ace.renderer.updateBackMarkers()},this.removeOverlay=function(e){this.$searchHighlight&&this.$searchHighlight.session&&this.$searchHighlight.destroy()},this.getScrollInfo=function(){var e=this.ace.renderer,t=e.layerConfig;return{left:e.scrollLeft,top:e.scrollTop,height:t.maxHeight,width:t.width,clientHeight:t.height,clientWidth:t.width}},this.getValue=function(){return this.ace.getValue()},this.setValue=function(e){return this.ace.setValue(e,-1)},this.getTokenTypeAt=function(e){var t=this.ace.session.getTokenAt(e.line,e.ch);return t&&/comment|string/.test(t.type)?"string":""},this.findMatchingBracket=function(e){var t=this.ace.session.findMatchingBracket(o(e));return{to:t&&i(t)}},this.findMatchingTag=function(e){var t=this.ace.session.getMatchingTags(o(e));if(t)return{open:{from:i(t.openTag.start),to:i(t.openTag.end)},close:{from:i(t.closeTag.start),to:i(t.closeTag.end)}}},this.indentLine=function(e,t){!0===t?this.ace.session.indentRows(e,e,"\t"):!1===t&&this.ace.session.outdentRows(new bt(e,0,e,0))},this.indexFromPos=function(e){return this.ace.session.doc.positionToIndex(o(e))},this.posFromIndex=function(e){return i(this.ace.session.doc.indexToPosition(e))},this.focus=function(e){return this.ace.textInput.focus()},this.blur=function(e){return this.ace.blur()},this.defaultTextHeight=function(e){return this.ace.renderer.layerConfig.lineHeight},this.scanForBracket=function(e,t,n,r){var a,s=r.bracketRegex.source,c=/paren|text|operator|tag/;return 1==t?a=this.ace.session.$findClosingBracket(s.slice(1,2),o(e),c):!(a=this.ace.session.$findOpeningBracket(s.slice(-2,-1),{row:e.line,column:e.ch+1},c))&&r.bracketRegex&&r.bracketRegex.test(this.getLine(e.line)[e.ch-1])&&(a={row:e.line,column:e.ch-1}),a&&{pos:i(a)}},this.refresh=function(){return this.ace.resize(!0)},this.getMode=function(){return{name:this.getOption("mode")}},this.execCommand=function(e){return De.commands.hasOwnProperty(e)?De.commands[e](this):"indentAuto"==e?this.ace.execCommand("autoindent"):void console.log(e+" is not implemented")},this.getLineNumber=function(e){var t,n,o,i=this.$lineHandleChanges;if(!i)return null;for(t=e.row,n=0;n<i.length;n++)if((o=i[n]).start.row!=o.end.row)if("i"==o.action[0])o.start.row<t&&(t+=o.end.row-o.start.row);else if(o.start.row<t){if(t<o.end.row||t==o.end.row&&o.start.column>0)return null;t-=o.end.row-o.start.row}return t},this.getLineHandle=function(e){return this.$lineHandleChanges||(this.$lineHandleChanges=[]),{text:this.ace.session.getLine(e),row:e}},this.releaseLineHandles=function(){this.$lineHandleChanges=void 0},this.getLastEditEnd=function(){var e=this.ace.session.$undoManager;if(e&&e.$lastDelta)return i(e.$lastDelta.end)}}.call(De.prototype),(De.StringStream=function(e,t){this.pos=this.start=0,this.string=e,this.tabSize=t||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0}).prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos==this.lineStart},peek:function(){return this.string.charAt(this.pos)||void 0},next:function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},eat:function(e){var t=this.string.charAt(this.pos);if("string"==typeof e?t==e:t&&(e.test?e.test(t):e(t)))return++this.pos,t},eatWhile:function(e){for(var t=this.pos;this.eat(e););return this.pos>t},eatSpace:function(){for(var e=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>e},skipToEnd:function(){this.pos=this.string.length},skipTo:function(e){var t=this.string.indexOf(e,this.pos);if(t>-1)return this.pos=t,!0},backUp:function(e){this.pos-=e},column:function(){throw"not implemented"},indentation:function(){throw"not implemented"},match:function(e,t,n){var o,i;return"string"!=typeof e?(i=this.string.slice(this.pos).match(e))&&i.index>0?null:(i&&!1!==t&&(this.pos+=i[0].length),i):(o=function(e){return n?e.toLowerCase():e})(this.string.substr(this.pos,e.length))==o(e)?(!1!==t&&(this.pos+=e.length),!0):void 0},current:function(){return this.string.slice(this.start,this.pos)},hideFirstChars:function(e,t){this.lineStart+=e;try{return t()}finally{this.lineStart-=e}}},De.defineExtension=function(e,t){De.prototype[e]=t},Tt.importCssString(".normal-mode .ace_cursor{\n    border: none;\n    background-color: rgba(255,0,0,0.5);\n}\n.normal-mode .ace_hidden-cursors .ace_cursor{\n  background-color: transparent;\n  border: 1px solid red;\n  opacity: 0.7\n}\n.ace_dialog {\n  position: absolute;\n  left: 0; right: 0;\n  background: inherit;\n  z-index: 15;\n  padding: .1em .8em;\n  overflow: hidden;\n  color: inherit;\n}\n.ace_dialog-top {\n  border-bottom: 1px solid #444;\n  top: 0;\n}\n.ace_dialog-bottom {\n  border-top: 1px solid #444;\n  bottom: 0;\n}\n.ace_dialog input {\n  border: none;\n  outline: none;\n  background: transparent;\n  width: 20em;\n  color: inherit;\n  font-family: monospace;\n}","vimMode",!1),function(){function e(e,t,n){var o=e.ace.container,i=o.appendChild(document.createElement("div"));return i.className=n?"ace_dialog ace_dialog-bottom":"ace_dialog ace_dialog-top","string"==typeof t?i.innerHTML=t:i.appendChild(t),i}function t(e,t){e.state.currentNotificationClose&&e.state.currentNotificationClose(),e.state.currentNotificationClose=t}De.defineExtension("openDialog",(function(n,o,i){function r(e){if("string"==typeof e)l.value=e;else{if(s)return;if(e&&"blur"==e.type&&document.activeElement===l)return;c.state.dialog==a&&(c.state.dialog=null,c.focus()),s=!0,a.remove(),i.onClose&&i.onClose(a);var t=c;t.state.vim&&(t.state.vim.status=null,t.ace._signal("changeStatus"),t.ace.renderer.$loop.schedule(t.ace.renderer.CHANGE_CURSOR))}}var a,s,c,l,u;if(!this.virtualSelectionMode())return i||(i={}),t(this,null),a=e(this,n,i.bottom),s=!1,c=this,this.state.dialog=a,(l=a.getElementsByTagName("input")[0])?(i.value&&(l.value=i.value,!1!==i.selectValueOnOpen&&l.select()),i.onInput&&De.on(l,"input",(function(e){i.onInput(e,l.value,r)})),i.onKeyUp&&De.on(l,"keyup",(function(e){i.onKeyUp(e,l.value,r)})),De.on(l,"keydown",(function(e){i&&i.onKeyDown&&i.onKeyDown(e,l.value,r)||(13==e.keyCode&&o(l.value),(27==e.keyCode||!1!==i.closeOnEnter&&13==e.keyCode)&&(De.e_stop(e),r()))})),!1!==i.closeOnBlur&&De.on(l,"blur",r),l.focus()):(u=a.getElementsByTagName("button")[0])&&(De.on(u,"click",(function(){r(),c.focus()})),!1!==i.closeOnBlur&&De.on(u,"blur",r),u.focus()),r})),De.defineExtension("openNotification",(function(n,o){function i(){a||(a=!0,clearTimeout(s),r.remove())}var r,a,s,c;if(!this.virtualSelectionMode())return t(this,i),r=e(this,n,o&&o.bottom),a=!1,c=o&&void 0!==o.duration?o.duration:5e3,De.on(r,"click",(function(e){De.e_preventDefault(e),i()})),c&&(s=setTimeout(i,c)),i}))}(),Ve=De.Pos,je=(We=[{keys:"<Left>",type:"keyToKey",toKeys:"h"},{keys:"<Right>",type:"keyToKey",toKeys:"l"},{keys:"<Up>",type:"keyToKey",toKeys:"k"},{keys:"<Down>",type:"keyToKey",toKeys:"j"},{keys:"g<Up>",type:"keyToKey",toKeys:"gk"},{keys:"g<Down>",type:"keyToKey",toKeys:"gj"},{keys:"<Space>",type:"keyToKey",toKeys:"l"},{keys:"<BS>",type:"keyToKey",toKeys:"h"},{keys:"<Del>",type:"keyToKey",toKeys:"x"},{keys:"<C-Space>",type:"keyToKey",toKeys:"W"},{keys:"<C-BS>",type:"keyToKey",toKeys:"B"},{keys:"<S-Space>",type:"keyToKey",toKeys:"w"},{keys:"<S-BS>",type:"keyToKey",toKeys:"b"},{keys:"<C-n>",type:"keyToKey",toKeys:"j"},{keys:"<C-p>",type:"keyToKey",toKeys:"k"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"<C-Esc>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-Esc>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"s",type:"keyToKey",toKeys:"cl",context:"normal"},{keys:"s",type:"keyToKey",toKeys:"c",context:"visual"},{keys:"S",type:"keyToKey",toKeys:"cc",context:"normal"},{keys:"S",type:"keyToKey",toKeys:"VdO",context:"visual"},{keys:"<Home>",type:"keyToKey",toKeys:"0"},{keys:"<End>",type:"keyToKey",toKeys:"$"},{keys:"<PageUp>",type:"keyToKey",toKeys:"<C-b>"},{keys:"<PageDown>",type:"keyToKey",toKeys:"<C-f>"},{keys:"<CR>",type:"keyToKey",toKeys:"j^",context:"normal"},{keys:"<Ins>",type:"keyToKey",toKeys:"i",context:"normal"},{keys:"<Ins>",type:"action",action:"toggleOverwrite",context:"insert"},{keys:"H",type:"motion",motion:"moveToTopLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"M",type:"motion",motion:"moveToMiddleLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"L",type:"motion",motion:"moveToBottomLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"h",type:"motion",motion:"moveByCharacters",motionArgs:{forward:!1}},{keys:"l",type:"motion",motion:"moveByCharacters",motionArgs:{forward:!0}},{keys:"j",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,linewise:!0}},{keys:"k",type:"motion",motion:"moveByLines",motionArgs:{forward:!1,linewise:!0}},{keys:"gj",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:!0}},{keys:"gk",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:!1}},{keys:"w",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!1}},{keys:"W",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!1,bigWord:!0}},{keys:"e",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!0,inclusive:!0}},{keys:"E",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!0,bigWord:!0,inclusive:!0}},{keys:"b",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1}},{keys:"B",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1,bigWord:!0}},{keys:"ge",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!0,inclusive:!0}},{keys:"gE",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!0,bigWord:!0,inclusive:!0}},{keys:"{",type:"motion",motion:"moveByParagraph",motionArgs:{forward:!1,toJumplist:!0}},{keys:"}",type:"motion",motion:"moveByParagraph",motionArgs:{forward:!0,toJumplist:!0}},{keys:"(",type:"motion",motion:"moveBySentence",motionArgs:{forward:!1}},{keys:")",type:"motion",motion:"moveBySentence",motionArgs:{forward:!0}},{keys:"<C-f>",type:"motion",motion:"moveByPage",motionArgs:{forward:!0}},{keys:"<C-b>",type:"motion",motion:"moveByPage",motionArgs:{forward:!1}},{keys:"<C-d>",type:"motion",motion:"moveByScroll",motionArgs:{forward:!0,explicitRepeat:!0}},{keys:"<C-u>",type:"motion",motion:"moveByScroll",motionArgs:{forward:!1,explicitRepeat:!0}},{keys:"gg",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!1,explicitRepeat:!0,linewise:!0,toJumplist:!0}},{keys:"G",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!0,explicitRepeat:!0,linewise:!0,toJumplist:!0}},{keys:"g$",type:"motion",motion:"moveToEndOfDisplayLine"},{keys:"g^",type:"motion",motion:"moveToStartOfDisplayLine"},{keys:"g0",type:"motion",motion:"moveToStartOfDisplayLine"},{keys:"0",type:"motion",motion:"moveToStartOfLine"},{keys:"^",type:"motion",motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"+",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,toFirstChar:!0}},{keys:"-",type:"motion",motion:"moveByLines",motionArgs:{forward:!1,toFirstChar:!0}},{keys:"_",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,toFirstChar:!0,repeatOffset:-1}},{keys:"$",type:"motion",motion:"moveToEol",motionArgs:{inclusive:!0}},{keys:"%",type:"motion",motion:"moveToMatchedSymbol",motionArgs:{inclusive:!0,toJumplist:!0}},{keys:"f<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:!0,inclusive:!0}},{keys:"F<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:!1}},{keys:"t<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:!0,inclusive:!0}},{keys:"T<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:!1}},{keys:";",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:!0}},{keys:",",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:!1}},{keys:"'<register>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:!0,linewise:!0}},{keys:"`<register>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:!0}},{keys:"]`",type:"motion",motion:"jumpToMark",motionArgs:{forward:!0}},{keys:"[`",type:"motion",motion:"jumpToMark",motionArgs:{forward:!1}},{keys:"]'",type:"motion",motion:"jumpToMark",motionArgs:{forward:!0,linewise:!0}},{keys:"['",type:"motion",motion:"jumpToMark",motionArgs:{forward:!1,linewise:!0}},{keys:"]p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!0,isEdit:!0,matchIndent:!0}},{keys:"[p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!1,isEdit:!0,matchIndent:!0}},{keys:"]<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:!0,toJumplist:!0}},{keys:"[<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:!1,toJumplist:!0}},{keys:"|",type:"motion",motion:"moveToColumn"},{keys:"o",type:"motion",motion:"moveToOtherHighlightedEnd",context:"visual"},{keys:"O",type:"motion",motion:"moveToOtherHighlightedEnd",motionArgs:{sameLine:!0},context:"visual"},{keys:"d",type:"operator",operator:"delete"},{keys:"y",type:"operator",operator:"yank"},{keys:"c",type:"operator",operator:"change"},{keys:"=",type:"operator",operator:"indentAuto"},{keys:">",type:"operator",operator:"indent",operatorArgs:{indentRight:!0}},{keys:"<",type:"operator",operator:"indent",operatorArgs:{indentRight:!1}},{keys:"g~",type:"operator",operator:"changeCase"},{keys:"gu",type:"operator",operator:"changeCase",operatorArgs:{toLower:!0},isEdit:!0},{keys:"gU",type:"operator",operator:"changeCase",operatorArgs:{toLower:!1},isEdit:!0},{keys:"n",type:"motion",motion:"findNext",motionArgs:{forward:!0,toJumplist:!0}},{keys:"N",type:"motion",motion:"findNext",motionArgs:{forward:!1,toJumplist:!0}},{keys:"gn",type:"motion",motion:"findAndSelectNextInclusive",motionArgs:{forward:!0}},{keys:"gN",type:"motion",motion:"findAndSelectNextInclusive",motionArgs:{forward:!1}},{keys:"gq",type:"operator",operator:"hardWrap"},{keys:"gw",type:"operator",operator:"hardWrap",operatorArgs:{keepCursor:!0}},{keys:"x",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:!0},operatorMotionArgs:{visualLine:!1}},{keys:"X",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:!1},operatorMotionArgs:{visualLine:!0}},{keys:"D",type:"operatorMotion",operator:"delete",motion:"moveToEol",motionArgs:{inclusive:!0},context:"normal"},{keys:"D",type:"operator",operator:"delete",operatorArgs:{linewise:!0},context:"visual"},{keys:"Y",type:"operatorMotion",operator:"yank",motion:"expandToLine",motionArgs:{linewise:!0},context:"normal"},{keys:"Y",type:"operator",operator:"yank",operatorArgs:{linewise:!0},context:"visual"},{keys:"C",type:"operatorMotion",operator:"change",motion:"moveToEol",motionArgs:{inclusive:!0},context:"normal"},{keys:"C",type:"operator",operator:"change",operatorArgs:{linewise:!0},context:"visual"},{keys:"~",type:"operatorMotion",operator:"changeCase",motion:"moveByCharacters",motionArgs:{forward:!0},operatorArgs:{shouldMoveCursor:!0},context:"normal"},{keys:"~",type:"operator",operator:"changeCase",context:"visual"},{keys:"<C-u>",type:"operatorMotion",operator:"delete",motion:"moveToStartOfLine",context:"insert"},{keys:"<C-w>",type:"operatorMotion",operator:"delete",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1},context:"insert"},{keys:"<C-w>",type:"idle",context:"normal"},{keys:"<C-i>",type:"action",action:"jumpListWalk",actionArgs:{forward:!0}},{keys:"<C-o>",type:"action",action:"jumpListWalk",actionArgs:{forward:!1}},{keys:"<C-e>",type:"action",action:"scroll",actionArgs:{forward:!0,linewise:!0}},{keys:"<C-y>",type:"action",action:"scroll",actionArgs:{forward:!1,linewise:!0}},{keys:"a",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"charAfter"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"eol"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"endOfSelectedArea"},context:"visual"},{keys:"i",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"inplace"},context:"normal"},{keys:"gi",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"lastEdit"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"firstNonBlank"},context:"normal"},{keys:"gI",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"bol"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"startOfSelectedArea"},context:"visual"},{keys:"o",type:"action",action:"newLineAndEnterInsertMode",isEdit:!0,interlaceInsertRepeat:!0,actionArgs:{after:!0},context:"normal"},{keys:"O",type:"action",action:"newLineAndEnterInsertMode",isEdit:!0,interlaceInsertRepeat:!0,actionArgs:{after:!1},context:"normal"},{keys:"v",type:"action",action:"toggleVisualMode"},{keys:"V",type:"action",action:"toggleVisualMode",actionArgs:{linewise:!0}},{keys:"<C-v>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:!0}},{keys:"<C-q>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:!0}},{keys:"gv",type:"action",action:"reselectLastSelection"},{keys:"J",type:"action",action:"joinLines",isEdit:!0},{keys:"gJ",type:"action",action:"joinLines",actionArgs:{keepSpaces:!0},isEdit:!0},{keys:"p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!0,isEdit:!0}},{keys:"P",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!1,isEdit:!0}},{keys:"r<character>",type:"action",action:"replace",isEdit:!0},{keys:"@<register>",type:"action",action:"replayMacro"},{keys:"q<register>",type:"action",action:"enterMacroRecordMode"},{keys:"R",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{replace:!0},context:"normal"},{keys:"R",type:"operator",operator:"change",operatorArgs:{linewise:!0,fullLine:!0},context:"visual",exitVisualBlock:!0},{keys:"u",type:"action",action:"undo",context:"normal"},{keys:"u",type:"operator",operator:"changeCase",operatorArgs:{toLower:!0},context:"visual",isEdit:!0},{keys:"U",type:"operator",operator:"changeCase",operatorArgs:{toLower:!1},context:"visual",isEdit:!0},{keys:"<C-r>",type:"action",action:"redo"},{keys:"m<register>",type:"action",action:"setMark"},{keys:'"<register>',type:"action",action:"setRegister"},{keys:"<C-r><register>",type:"action",action:"insertRegister",context:"insert",isEdit:!0},{keys:"<C-o>",type:"action",action:"oneNormalCommand",context:"insert"},{keys:"zz",type:"action",action:"scrollToCursor",actionArgs:{position:"center"}},{keys:"z.",type:"action",action:"scrollToCursor",actionArgs:{position:"center"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"zt",type:"action",action:"scrollToCursor",actionArgs:{position:"top"}},{keys:"z<CR>",type:"action",action:"scrollToCursor",actionArgs:{position:"top"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"zb",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"}},{keys:"z-",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:".",type:"action",action:"repeatLastEdit"},{keys:"<C-a>",type:"action",action:"incrementNumberToken",isEdit:!0,actionArgs:{increase:!0,backtrack:!1}},{keys:"<C-x>",type:"action",action:"incrementNumberToken",isEdit:!0,actionArgs:{increase:!1,backtrack:!1}},{keys:"<C-t>",type:"action",action:"indent",actionArgs:{indentRight:!0},context:"insert"},{keys:"<C-d>",type:"action",action:"indent",actionArgs:{indentRight:!1},context:"insert"},{keys:"a<register>",type:"motion",motion:"textObjectManipulation"},{keys:"i<register>",type:"motion",motion:"textObjectManipulation",motionArgs:{textObjectInner:!0}},{keys:"/",type:"search",searchArgs:{forward:!0,querySrc:"prompt",toJumplist:!0}},{keys:"?",type:"search",searchArgs:{forward:!1,querySrc:"prompt",toJumplist:!0}},{keys:"*",type:"search",searchArgs:{forward:!0,querySrc:"wordUnderCursor",wholeWordOnly:!0,toJumplist:!0}},{keys:"#",type:"search",searchArgs:{forward:!1,querySrc:"wordUnderCursor",wholeWordOnly:!0,toJumplist:!0}},{keys:"g*",type:"search",searchArgs:{forward:!0,querySrc:"wordUnderCursor",toJumplist:!0}},{keys:"g#",type:"search",searchArgs:{forward:!1,querySrc:"wordUnderCursor",toJumplist:!0}},{keys:":",type:"ex"}]).length,Fe=[{name:"colorscheme",shortName:"colo"},{name:"map"},{name:"imap",shortName:"im"},{name:"nmap",shortName:"nm"},{name:"vmap",shortName:"vm"},{name:"omap",shortName:"om"},{name:"noremap",shortName:"no"},{name:"nnoremap",shortName:"nn"},{name:"vnoremap",shortName:"vn"},{name:"inoremap",shortName:"ino"},{name:"onoremap",shortName:"ono"},{name:"unmap"},{name:"mapclear",shortName:"mapc"},{name:"nmapclear",shortName:"nmapc"},{name:"vmapclear",shortName:"vmapc"},{name:"imapclear",shortName:"imapc"},{name:"omapclear",shortName:"omapc"},{name:"write",shortName:"w"},{name:"undo",shortName:"u"},{name:"redo",shortName:"red"},{name:"set",shortName:"se"},{name:"setlocal",shortName:"setl"},{name:"setglobal",shortName:"setg"},{name:"sort",shortName:"sor"},{name:"substitute",shortName:"s",possiblyAsync:!0},{name:"startinsert",shortName:"start"},{name:"nohlsearch",shortName:"noh"},{name:"yank",shortName:"y"},{name:"delmarks",shortName:"delm"},{name:"registers",shortName:"reg",excludeFromCommandHistory:!0},{name:"vglobal",shortName:"v"},{name:"delete",shortName:"d"},{name:"join",shortName:"j"},{name:"normal",shortName:"norm"},{name:"global",shortName:"g"}],Ue=A(""),ze=/[\d]/,Qe=[De.isWordChar,function(e){return e&&!De.isWordChar(e)&&!/\s/.test(e)}],qe=[function(e){return/\S/.test(e)}],Je=["<",">"],Ge=["-",'"',".",":","_","/","+"],Xe=/^\w$/;try{Ze=new RegExp("^[\\p{Lu}]$","u")}catch(e){Ze=/^[A-Z]$/}Ye={},m("filetype",void 0,"string",["ft"],(function(e,t){var n;if(void 0!==t)return void 0===e?"null"==(n=t.getOption("mode"))?"":n:(n=""==e?"null":e,void t.setOption("mode",n))})),m("textwidth",80,"number",["tw"],(function(e,t){var n;if(void 0!==t)return void 0===e?t.getOption("textwidth"):void((n=Math.round(e))>1&&t.setOption("textwidth",n))})),et=function(){function e(e,a){var s,c,l,u;if((n+=a)>o?n=o:n<i&&(n=i),(s=r[(t+n)%t])&&!s.find()){c=a>0?1:-1,u=e.getCursor();do{if((s=r[(t+(n+=c))%t])&&(l=s.find())&&!$(u,l))break}while(n<o&&n>i)}return s}var t=100,n=-1,o=0,i=0,r=new Array(t);return{cachedCursor:void 0,add:function(e,a,s){function c(o){var i=++n%t,a=r[i];a&&a.clear(),r[i]=e.setBookmark(o)}var l,u=n%t,h=r[u];h?(l=h.find())&&!$(l,a)&&c(a):c(a),c(s),o=n,(i=n-t+1)<0&&(i=0)},find:function(t,o){var i=n,r=e(t,o);return n=i,r&&r.find()},move:e}},tt=function(e){return e?{changes:e.changes,expectCursorActivityForChange:e.expectCursorActivityForChange}:{changes:[],expectCursorActivityForChange:!1}},v.prototype={exitMacroRecordMode:function(){var e=nt.macroModeState;e.onRecordingDone&&e.onRecordingDone(),e.onRecordingDone=void 0,e.isRecording=!1},enterMacroRecordMode:function(e,t){var n,o=nt.registerController.getRegister(t);o&&(o.clear(),this.latestRegister=t,e.openDialog&&(n=ge("span",{class:"cm-vim-message"},"recording @"+t),this.onRecordingDone=e.openDialog(n,null,{bottom:!0})),this.isRecording=!0)}},it={enterVimMode:a,leaveVimMode:s,buildKeyMap:function(){},getRegisterController:function(){return nt.registerController},resetVimGlobalState_:w,getVimGlobalState_:function(){return nt},maybeInitVimState_:C,suppressErrorLogging:!1,InsertModeKey:Be,map:function(e,t,n){St.map(e,t,n)},unmap:function(e,t){return St.unmap(e,t)},noremap:function(e,t,n){St.map(e,t,n,!0)},mapclear:function(e){var t,n,o,i,r,a,s=We.length,c=je,l=We.slice(0,s-c);if(We=We.slice(s-c),e)for(t=l.length-1;t>=0;t--)if(e!==(n=l[t]).context)if(n.context)this._mapCommand(n);else for(i in o=["normal","insert","visual"])if(o[i]!==e){for(a in r={},n)r[a]=n[a];r.context=o[i],this._mapCommand(r)}},langmap:M,vimKeyFromEvent:x,setOption:g,getOption:y,defineOption:m,defineEx:function(e,t,n){if(t){if(0!==e.indexOf(t))throw new Error('(Vim.defineEx) "'+t+'" is not a prefix of "'+e+'", command not registered')}else t=e;kt[e]=n,St.commandMap_[t]={name:e,shortName:t,type:"api"}},handleKey:function(e,t,n){var o=this.findKey(e,t,n);if("function"==typeof o)return o()},multiSelectHandleKey:_e,findKey:function(e,t,n){function o(){var o=nt.macroModeState;if(o.isRecording){if("q"==t)return o.exitMacroRecordMode(),L(e),!0;"mapping"!=n&&function(e,t){var n,o;e.isPlaying||(n=e.latestRegister,(o=nt.registerController.getRegister(n))&&o.pushText(t))}(o,t)}}function i(){if("<Esc>"==t){if(h.visualMode)Z(e);else{if(!h.insertMode)return;be(e)}return L(e),!0}}var r,a,s,c,l,u,h=C(e);return r=h.insertMode?function(){var n,o,r,a,s,c,l,u,d,p;if(i())return!0;if(h.inputState.keyBuffer.push(t),n=h.inputState.keyBuffer.join(""),o=1==t.length,r=ht.matchCommand(n,We,h.inputState,"insert"),a=h.inputState.changeQueue,"none"==r.type)return L(e),!1;if("partial"==r.type){if(r.expectLiteralNext&&(h.expectLiteralNext=!0),ot&&window.clearTimeout(ot),ot=o&&window.setTimeout((function(){h.insertMode&&h.inputState.keyBuffer.length&&L(e)}),y("insertModeEscKeysTimeout")),o)for(s=e.listSelections(),a&&a.removed.length==s.length||(a=h.inputState.changeQueue=new T),a.inserted+=t,c=0;c<s.length;c++)l=V(s[c].anchor,s[c].head),u=W(s[c].anchor,s[c].head),d=e.getRange(l,e.state.overwrite?K(u,0,1):u),a.removed[c]=(a.removed[c]||"")+d;return!o}if(h.expectLiteralNext=!1,ot&&window.clearTimeout(ot),r.command&&a){for(s=e.listSelections(),c=0;c<s.length;c++)p=s[c].head,e.replaceRange(a.removed[c]||"",K(p,0,-a.inserted.length),p,"+input");nt.macroModeState.lastInsertModeChanges.changes.pop()}return r.command||L(e),r.command}():!(!o()&&!i())||(h.inputState.keyBuffer.push(t),a=h.inputState.keyBuffer.join(""),!!/^[1-9]\d*$/.test(a)||((s=/^(\d*)(.*)$/.exec(a))?(c=h.visualMode?"visual":"normal",l=s[2]||s[1],h.inputState.operatorShortcut&&h.inputState.operatorShortcut.slice(-1)==l&&(l=h.inputState.operatorShortcut),"none"==(u=ht.matchCommand(l,We,h.inputState,c)).type?(L(e),!1):"partial"==u.type?(u.expectLiteralNext&&(h.expectLiteralNext=!0),!0):"clear"==u.type?(L(e),!0):(h.expectLiteralNext=!1,h.inputState.keyBuffer.length=0,(s=/^(\d*)(.*)$/.exec(a))[1]&&"0"!=s[1]&&h.inputState.pushRepeatDigit(s[1]),u.command)):(L(e),!1))),!1===r?h.insertMode||1!==t.length?void 0:function(){return!0}:!0===r?function(){return!0}:function(){if(!r.operator&&!r.isEdit||!e.getOption("readOnly"))return e.operation((function(){e.curOp.isVimOp=!0;try{"keyToKey"==r.type?S(e,r.toKeys,r):ht.processCommand(e,h,r)}catch(t){throw e.state.vim=void 0,C(e),it.suppressErrorLogging||console.log(t),t}return!0}))}},handleEx:function(e,t){St.processCommand(e,t)},defineMotion:function(e,t){dt[e]=t},defineAction:function(e,t){ft[e]=t},defineOperator:function(e,t){pt[e]=t},mapCommand:function(e,t,n,o,i){var r,a={keys:e,type:t};for(r in a[t]=n,a[t+"Args"]=o,i)a[r]=i[r];Le(a)},_mapCommand:Le,defineRegister:function(e,t){var n=nt.registerController.registers;if(!e||1!=e.length)throw Error("Register name must be 1 character");n[e]=t,Ge.push(e)},exitVisualMode:Z,exitInsertMode:be},rt=[],at=!1,ct={Return:"CR",Backspace:"BS",Delete:"Del",Escape:"Esc",Insert:"Ins",ArrowLeft:"Left",ArrowRight:"Right",ArrowUp:"Up",ArrowDown:"Down",Enter:"CR"," ":"Space"},lt={Shift:1,Alt:1,Command:1,Control:1,CapsLock:1,AltGraph:1,Dead:1,Unidentified:1},ut={},"Left|Right|Up|Down|End|Home".split("|").concat(Object.keys(ct)).forEach((function(e){ut[(ct[e]||"").toLowerCase()]=ut[e.toLowerCase()]=e})),m("langmap",void 0,"string",["lmap"],(function(e,t){if(void 0===e)return Ue.string;M(e)})),b.prototype.pushRepeatDigit=function(e){this.operator?this.motionRepeat=this.motionRepeat.concat(e):this.prefixRepeat=this.prefixRepeat.concat(e)},b.prototype.getRepeat=function(){var e=0;return(this.prefixRepeat.length>0||this.motionRepeat.length>0)&&(e=1,this.prefixRepeat.length>0&&(e*=parseInt(this.prefixRepeat.join(""),10)),this.motionRepeat.length>0&&(e*=parseInt(this.motionRepeat.join(""),10))),e},E.prototype={setText:function(e,t,n){this.keyBuffer=[e||""],this.linewise=!!t,this.blockwise=!!n},pushText:function(e,t){t&&(this.linewise||this.keyBuffer.push("\n"),this.linewise=!0),this.keyBuffer.push(e)},pushInsertModeChanges:function(e){this.insertModeChanges.push(tt(e))},pushSearchQuery:function(e){this.searchQueries.push(e)},clear:function(){this.keyBuffer=[],this.insertModeChanges=[],this.searchQueries=[],this.linewise=!1},toString:function(){return this.keyBuffer.join("")}},O.prototype={pushText:function(e,t,n,o,i){var r;if("_"!==e)if(o&&"\n"!==n.charAt(n.length-1)&&(n+="\n"),r=this.isValidRegister(e)?this.getRegister(e):null)h(e)?r.pushText(n,o):r.setText(n,o,i),"+"===e&&"undefined"!=typeof navigator&&void 0!==navigator.clipboard&&"function"==typeof navigator.clipboard.readText&&navigator.clipboard.writeText(n),this.unnamedRegister.setText(r.toString(),o);else{switch(t){case"yank":this.registers[0]=new E(n,o,i);break;case"delete":case"change":-1==n.indexOf("\n")?this.registers["-"]=new E(n,o):(this.shiftNumericRegisters_(),this.registers[1]=new E(n,o))}this.unnamedRegister.setText(n,o,i)}},getRegister:function(e){return this.isValidRegister(e)?(e=e.toLowerCase(),this.registers[e]||(this.registers[e]=new E),this.registers[e]):this.unnamedRegister},isValidRegister:function(e){return e&&(f(e,Ge)||Xe.test(e))},shiftNumericRegisters_:function(){for(var e=9;e>=2;e--)this.registers[e]=this.getRegister(""+(e-1))}},R.prototype={nextMatch:function(e,t){var n,o,i,r=this.historyBuffer,a=t?-1:1;for(null===this.initialPrefix&&(this.initialPrefix=e),n=this.iterator+a;t?n>=0:n<r.length;n+=a)for(o=r[n],i=0;i<=o.length;i++)if(this.initialPrefix==o.substring(0,i))return this.iterator=n,o;return n>=r.length?(this.iterator=r.length,this.initialPrefix):n<0?e:void 0},pushInput:function(e){var t=this.historyBuffer.indexOf(e);t>-1&&this.historyBuffer.splice(t,1),e.length&&this.historyBuffer.push(e)},reset:function(){this.initialPrefix=null,this.iterator=this.historyBuffer.length}},ht={matchCommand:function(e,t,n,o){var i,r,a,s,c=function(e,t,n,o){var i,r,a,s,c;for(o.operator&&(n="operatorPending"),r=[],a=[],s=at?t.length-je:0;s<t.length;s++)c=t[s],"insert"==n&&"insert"!=c.context||c.context&&c.context!=n||o.operator&&"action"==c.type||!(i=P(e,c.keys))||("partial"==i&&r.push(c),"full"==i&&a.push(c));return{partial:r.length&&r,full:a.length&&a}}(e,t,o,n);if(!c.full&&!c.partial)return{type:"none"};if(!c.full&&c.partial)return{type:"partial",expectLiteralNext:1==c.partial.length&&"<character>"==c.partial[0].keys.slice(-11)};for(r=0;r<c.full.length;r++)a=c.full[r],i||(i=a);if("<character>"==i.keys.slice(-11)||"<register>"==i.keys.slice(-10)){if(s=function(e){var t=/^.*(<[^>]+>)$/.exec(e),n=t?t[1]:e.slice(-1);if(n.length>1)switch(n){case"<CR>":n="\n";break;case"<Space>":n=" ";break;default:n=""}return n}(e),!s||s.length>1)return{type:"clear"};n.selectedCharacter=s}return{type:"full",command:i}},processCommand:function(e,t,n){switch(t.inputState.repeatOverride=n.repeatOverride,n.type){case"motion":this.processMotion(e,t,n);break;case"operator":this.processOperator(e,t,n);break;case"operatorMotion":this.processOperatorMotion(e,t,n);break;case"action":this.processAction(e,t,n);break;case"search":this.processSearch(e,t,n);break;case"ex":case"keyToEx":this.processEx(e,t,n)}},processMotion:function(e,t,n){t.inputState.motion=n.motion,t.inputState.motionArgs=N(n.motionArgs),this.evalInput(e,t)},processOperator:function(e,t,n){var o=t.inputState;if(o.operator){if(o.operator==n.operator)return o.motion="expandToLine",o.motionArgs={linewise:!0},void this.evalInput(e,t);L(e)}o.operator=n.operator,o.operatorArgs=N(n.operatorArgs),n.keys.length>1&&(o.operatorShortcut=n.keys),n.exitVisualBlock&&(t.visualBlock=!1,G(e)),t.visualMode&&this.evalInput(e,t)},processOperatorMotion:function(e,t,n){var o=t.visualMode,i=N(n.operatorMotionArgs);i&&o&&i.visualLine&&(t.visualLine=!0),this.processOperator(e,t,n),o||this.processMotion(e,t,n)},processAction:function(e,t,n){var o=t.inputState,i=o.getRepeat(),r=!!i,a=N(n.actionArgs)||{};o.selectedCharacter&&(a.selectedCharacter=o.selectedCharacter),n.operator&&this.processOperator(e,t,n),n.motion&&this.processMotion(e,t,n),(n.motion||n.operator)&&this.evalInput(e,t),a.repeat=i||1,a.repeatIsExplicit=r,a.registerName=o.registerName,L(e),t.lastMotion=null,n.isEdit&&this.recordLastEdit(t,o,n),ft[n.action](e,a,t)},processSearch:function(e,t,n){function o(o,i,r){nt.searchHistoryController.pushInput(o),nt.searchHistoryController.reset();try{Ce(e,o,i,r)}catch(t){return ye(e,"Invalid regex: "+o),void L(e)}ht.processMotion(e,t,{type:"motion",motion:"findNext",motionArgs:{forward:!0,toJumplist:n.searchArgs.toJumplist}})}var i,r,a,s,c,l,u,h,d;if(e.getSearchCursor)switch(i=n.searchArgs.forward,r=n.searchArgs.wholeWordOnly,de(e).setReversed(!i),a=i?"/":"?",s=de(e).getQuery(),c=e.getScrollInfo(),n.searchArgs.querySrc){case"prompt":(l=nt.macroModeState).isPlaying?o(u=l.replaySearchQueries.shift(),!0,!1):ve(e,{onClose:function(e){o(e,!0,!0);var t=nt.macroModeState;t.isRecording&&function(e,t){var n,o;e.isPlaying||(n=e.latestRegister,(o=nt.registerController.getRegister(n))&&o.pushSearchQuery&&o.pushSearchQuery(t))}(t,e)},prefix:a,desc:"(JavaScript regexp)",onKeyUp:function(t,n,o){var r,a,s,l=x(t);"<Up>"==l||"<Down>"==l?(r="<Up>"==l,a=t.target?t.target.selectionEnd:0,o(n=nt.searchHistoryController.nextMatch(n,r)||""),a&&t.target&&(t.target.selectionEnd=t.target.selectionStart=Math.min(a,t.target.value.length))):l&&"<Left>"!=l&&"<Right>"!=l&&nt.searchHistoryController.reset();try{s=Ce(e,n,!0,!0)}catch(t){}s?e.scrollIntoView(ke(e,!i,s),30):(Se(e),e.scrollTo(c.left,c.top))},onKeyDown:function(t,n,o){var i=x(t);"<Esc>"==i||"<C-c>"==i||"<C-[>"==i||"<BS>"==i&&""==n?(nt.searchHistoryController.pushInput(n),nt.searchHistoryController.reset(),Ce(e,s),Se(e),e.scrollTo(c.left,c.top),De.e_stop(t),L(e),o(),e.focus()):"<Up>"==i||"<Down>"==i?De.e_stop(t):"<C-u>"==i&&(De.e_stop(t),o(""))}});break;case"wordUnderCursor":if(d=!0,(h=ee(e,{noSymbol:!0}))||(h=ee(e,{noSymbol:!1}),d=!1),!h)return ye(e,"No word under cursor"),void L(e);u=e.getLine(h.start.line).substring(h.start.ch,h.end.ch),u=d&&r?"\\b"+u+"\\b":u.replace(/([.?*+$\[\]\/\\(){}|\-])/g,"\\$1"),nt.jumpList.cachedCursor=e.getCursor(),e.setCursor(h.start),o(u,!0,!1)}},processEx:function(e,t,n){function o(t){nt.exCommandHistoryController.pushInput(t),nt.exCommandHistoryController.reset(),St.processCommand(e,t),e.state.vim&&L(e)}function i(t,n,o){var i,r,a=x(t);("<Esc>"==a||"<C-c>"==a||"<C-[>"==a||"<BS>"==a&&""==n)&&(nt.exCommandHistoryController.pushInput(n),nt.exCommandHistoryController.reset(),De.e_stop(t),L(e),o(),e.focus()),"<Up>"==a||"<Down>"==a?(De.e_stop(t),i="<Up>"==a,r=t.target?t.target.selectionEnd:0,o(n=nt.exCommandHistoryController.nextMatch(n,i)||""),r&&t.target&&(t.target.selectionEnd=t.target.selectionStart=Math.min(r,t.target.value.length))):"<C-u>"==a?(De.e_stop(t),o("")):a&&"<Left>"!=a&&"<Right>"!=a&&nt.exCommandHistoryController.reset()}"keyToEx"==n.type?St.processCommand(e,n.exArgs.input):t.visualMode?ve(e,{onClose:o,prefix:":",value:"'<,'>",onKeyDown:i,selectValueOnOpen:!1}):ve(e,{onClose:o,prefix:":",onKeyDown:i})},evalInput:function(e,t){var n,o,i,a,s,c,l,u,h,p,f,m,g,y,v,C,w,k,S,x,M=t.inputState,A=M.motion,b=M.motionArgs||{},T=M.operator,E=M.operatorArgs||{},O=M.registerName,R=t.sel,B=_(t.visualMode?I(e,R.head):e.getCursor("head")),N=_(t.visualMode?I(e,R.anchor):e.getCursor("anchor")),K=_(B),P=_(N);if(T&&this.recordLastEdit(t,M),(i=void 0!==M.repeatOverride?M.repeatOverride:M.getRepeat())>0&&b.explicitRepeat?b.repeatIsExplicit=!0:(b.noRepeat||!b.explicitRepeat&&0===i)&&(i=1,b.repeatIsExplicit=!1),M.selectedCharacter&&(b.selectedCharacter=E.selectedCharacter=M.selectedCharacter),b.repeat=i,L(e),A){if(a=dt[A](e,B,b,t,M),t.lastMotion=dt[A],!a)return;b.toJumplist&&(T||null==e.ace.curOp||(e.ace.curOp.command.scrollIntoView="center-animate"),(c=(s=nt.jumpList).cachedCursor)?(te(e,c,a),delete s.cachedCursor):te(e,B,a)),a instanceof Array?(o=a[0],n=a[1]):n=a,n||(n=_(B)),t.visualMode?(t.visualBlock&&n.ch===1/0||(n=I(e,n,K)),o&&(o=I(e,o)),o=o||P,R.anchor=o,R.head=n,G(e),ae(e,t,"<",D(o,n)?o:n),ae(e,t,">",D(o,n)?n:o)):T||(e.ace.curOp&&(e.ace.curOp.vimDialogScroll="center-animate"),n=I(e,n,K),e.setCursor(n.line,n.ch))}if(T){if(E.lastSel?(o=P,l=E.lastSel,u=Math.abs(l.head.line-l.anchor.line),h=Math.abs(l.head.ch-l.anchor.ch),n=l.visualLine?new Ve(P.line+u,P.ch):l.visualBlock?new Ve(P.line+u,P.ch+h):l.head.line==l.anchor.line?new Ve(P.line,P.ch+h):new Ve(P.line+u,P.ch),t.visualMode=!0,t.visualLine=l.visualLine,t.visualBlock=l.visualBlock,R=t.sel={anchor:o,head:n},G(e)):t.visualMode&&(E.lastSel={anchor:_(R.anchor),head:_(R.head),visualBlock:t.visualBlock,visualLine:t.visualLine}),t.visualMode){if(p=V(R.head,R.anchor),f=W(R.head,R.anchor),m=t.visualLine||E.linewise,g=t.visualBlock?"block":m?"line":"char",y=X(e,{anchor:(v=r(e,p,f)).start,head:v.end},g),m)if(C=y.ranges,"block"==g)for(w=0;w<C.length;w++)C[w].head.ch=F(e,C[w].head.line);else"line"==g&&(C[0].head=new Ve(C[0].head.line+1,0))}else p=_(o||P),D(f=_(n||K),p)&&(k=p,p=f,f=k),(m=b.linewise||E.linewise)?function(e,t,n){t.ch=0,n.ch=0,n.line++}(0,p,f):b.forward&&function(e,t,n){var o,i,r=e.getRange(t,n);if(/\n\s*$/.test(r)){for((o=r.split("\n")).pop(),i=o.pop();o.length>0&&i&&d(i);i=o.pop())n.line--,n.ch=0;i?(n.line--,n.ch=F(e,n.line)):n.ch=0}}(e,p,f),g="char",S=!b.inclusive||m,y=X(e,{anchor:(v=r(e,p,f)).start,head:v.end},g,S);e.setSelections(y.ranges,y.primary),t.lastMotion=null,E.repeat=i,E.registerName=O,E.linewise=m,x=pt[T](e,E,y.ranges,P,n),t.visualMode&&Z(e,null!=x),x&&e.setCursor(x)}},recordLastEdit:function(e,t,n){var o=nt.macroModeState;o.isPlaying||(e.lastEditInputState=t,e.lastEditActionCommand=n,o.lastInsertModeChanges.changes=[],o.lastInsertModeChanges.expectCursorActivityForChange=!1,o.lastInsertModeChanges.visualBlock=e.visualBlock?e.sel.head.line-e.sel.anchor.line:0)}},dt={moveToTopLine:function(e,t,n){var o=xe(e).top+n.repeat-1;return new Ve(o,Y(e.getLine(o)))},moveToMiddleLine:function(e){var t=xe(e),n=Math.floor(.5*(t.top+t.bottom));return new Ve(n,Y(e.getLine(n)))},moveToBottomLine:function(e,t,n){var o=xe(e).bottom-n.repeat+1;return new Ve(o,Y(e.getLine(o)))},expandToLine:function(e,t,n){return new Ve(t.line+n.repeat-1,1/0)},findNext:function(e,t,n){var o,i=de(e),r=i.getQuery();if(r)return o=!n.forward,o=i.isReversed()?!o:o,we(e,r),ke(e,o,r,n.repeat)},findAndSelectNextInclusive:function(e,t,n,o,i){var r,a,s,c,l,u=de(e),h=u.getQuery();if(h&&(r=!n.forward,a=function(e,t,n,o,i){return void 0===o&&(o=1),e.operation((function(){var r,a=e.getCursor(),s=e.getSearchCursor(n,a),c=s.find(!t);for(!i.visualMode&&c&&$(s.from(),a)&&s.find(!t),r=0;r<o;r++)if(!(c=s.find(t))&&!(s=e.getSearchCursor(n,t?new Ve(e.lastLine()):new Ve(e.firstLine(),0))).find(t))return;return[s.from(),s.to()]}))}(e,r=u.isReversed()?!r:r,h,n.repeat,o),a)){if(i.operator)return a;if(s=a[0],c=new Ve(a[1].line,a[1].ch-1),o.visualMode){if((o.visualLine||o.visualBlock)&&(o.visualLine=!1,o.visualBlock=!1,De.signal(e,"vim-mode-change",{mode:"visual",subMode:""})),l=o.sel.anchor)return u.isReversed()?n.forward?[l,s]:[l,c]:n.forward?[l,c]:[l,s]}else o.visualMode=!0,o.visualLine=!1,o.visualBlock=!1,De.signal(e,"vim-mode-change",{mode:"visual",subMode:""});return r?[c,s]:[s,c]}},goToMark:function(e,t,n,o){var i=Me(e,o,n.selectedCharacter);return i?n.linewise?{line:i.line,ch:Y(e.getLine(i.line))}:i:null},moveToOtherHighlightedEnd:function(e,t,n,o){if(o.visualBlock&&n.sameLine){var i=o.sel;return[I(e,new Ve(i.anchor.line,i.head.ch)),I(e,new Ve(i.head.line,i.anchor.ch))]}return[o.sel.head,o.sel.anchor]},jumpToMark:function(e,t,n,o){var i,r,a,s,c,l,h=t;for(i=0;i<n.repeat;i++)for(a in r=h,o.marks)u(a)&&(s=o.marks[a].find(),(n.forward?D(s,r):D(r,s))||n.linewise&&s.line==r.line||(c=$(r,h),l=n.forward?j(r,s,h):j(h,s,r),(c||l)&&(h=s)));return n.linewise&&(h=new Ve(h.line,Y(e.getLine(h.line)))),h},moveByCharacters:function(e,t,n){var o=t,i=n.repeat,r=n.forward?o.ch+i:o.ch-i;return new Ve(o.line,r)},moveByLines:function(e,t,n,o){var i,r,a,s,c,l=t,u=l.ch;switch(o.lastMotion){case this.moveByLines:case this.moveByDisplayLines:case this.moveByScroll:case this.moveToColumn:case this.moveToEol:u=o.lastHPos;break;default:o.lastHPos=u}return i=n.repeat+(n.repeatOffset||0),r=n.forward?l.line+i:l.line-i,a=e.firstLine(),s=e.lastLine(),r<a&&l.line==a?this.moveToStartOfLine(e,t,n,o):r>s&&l.line==s?ie(e,t,n,o,!0):((c=e.ace.session.getFoldLine(r))&&(n.forward?r>c.start.row&&(r=c.end.row+1):r=c.start.row),n.toFirstChar&&(u=Y(e.getLine(r)),o.lastHPos=u),o.lastHSPos=e.charCoords(new Ve(r,u),"div").left,new Ve(r,u))},moveByDisplayLines:function(e,t,n,o){var i,r,a,s,c=t;switch(o.lastMotion){case this.moveByDisplayLines:case this.moveByScroll:case this.moveByLines:case this.moveToColumn:case this.moveToEol:break;default:o.lastHSPos=e.charCoords(c,"div").left}return i=n.repeat,(r=e.findPosV(c,n.forward?i:-i,"line",o.lastHSPos)).hitSide&&(n.forward?(a={top:e.charCoords(r,"div").top+8,left:o.lastHSPos},r=e.coordsChar(a,"div")):((s=e.charCoords(new Ve(e.firstLine(),0),"div")).left=o.lastHSPos,r=e.coordsChar(s,"div"))),o.lastHPos=r.ch,r},moveByPage:function(e,t,n){var o=t,i=n.repeat;return e.findPosV(o,n.forward?i:-i,"page")},moveByParagraph:function(e,t,n){var o=n.forward?1:-1;return ce(e,t,n.repeat,o)},moveBySentence:function(e,t,n){var o=n.forward?1:-1;return function(e,t,n,o){function i(e,t){if(t.pos+t.dir<0||t.pos+t.dir>=t.line.length){if(t.ln+=t.dir,!l(e,t.ln))return t.line=null,t.ln=null,void(t.pos=null);t.line=e.getLine(t.ln),t.pos=t.dir>0?0:t.line.length-1}else t.pos+=t.dir}function r(e,t,n,o){var r,a=e.getLine(t),s=""===a,c={line:a,ln:t,pos:n,dir:o},l={ln:c.ln,pos:c.pos},u=""===c.line;for(i(e,c);null!==c.line;){if(l.ln=c.ln,l.pos=c.pos,""===c.line&&!u)return{ln:c.ln,pos:c.pos};if(s&&""!==c.line&&!d(c.line[c.pos]))return{ln:c.ln,pos:c.pos};!p(c.line[c.pos])||s||c.pos!==c.line.length-1&&!d(c.line[c.pos+1])||(s=!0),i(e,c)}for(a=e.getLine(l.ln),l.pos=0,r=a.length-1;r>=0;--r)if(!d(a[r])){l.pos=r;break}return l}function a(e,t,n,o){var r,a=e.getLine(t),s={line:a,ln:t,pos:n,dir:o},c={ln:s.ln,pos:null},l=""===s.line;for(i(e,s);null!==s.line;){if(""===s.line&&!l)return null!==c.pos?c:{ln:s.ln,pos:s.pos};if(p(s.line[s.pos])&&null!==c.pos&&(s.ln!==c.ln||s.pos+1!==c.pos))return c;""===s.line||d(s.line[s.pos])||(l=!1,c={ln:s.ln,pos:s.pos}),i(e,s)}for(a=e.getLine(c.ln),c.pos=0,r=0;r<a.length;++r)if(!d(a[r])){c.pos=r;break}return c}for(var s={ln:t.line,pos:t.ch};n>0;)s=o<0?a(e,s.ln,s.pos,o):r(e,s.ln,s.pos,o),n--;return new Ve(s.ln,s.pos)}(e,t,n.repeat,o)},moveByScroll:function(e,t,n,o){var i,r,a=e.getScrollInfo(),s=null,c=n.repeat;return c||(c=a.clientHeight/(2*e.defaultTextHeight())),i=e.charCoords(t,"local"),n.repeat=c,(s=dt.moveByDisplayLines(e,t,n,o))?(r=e.charCoords(s,"local"),e.scrollTo(null,a.top+r.top-i.top),s):null},moveByWords:function(e,t,n){return function(e,t,n,o,i,r){var a,s,c,l,u,h,d,p=_(t),f=[];for((o&&!i||!o&&i)&&n++,a=!(o&&i),s=0;s<n;s++){if(!(c=oe(e,t,o,r,a))){l=F(e,e.lastLine()),f.push(o?{line:e.lastLine(),from:l,to:l}:{line:0,from:0,to:0});break}f.push(c),t=new Ve(c.line,o?c.to-1:c.from)}return u=f.length!=n,h=f[0],d=f.pop(),o&&!i?(u||h.from==p.ch&&h.line==p.line||(d=f.pop()),new Ve(d.line,d.from)):o&&i?new Ve(d.line,d.to-1):!o&&i?(u||h.to==p.ch&&h.line==p.line||(d=f.pop()),new Ve(d.line,d.to)):new Ve(d.line,d.from)}(e,t,n.repeat,!!n.forward,!!n.wordEnd,!!n.bigWord)},moveTillCharacter:function(e,t,n){var o=n.repeat,i=re(e,o,n.forward,n.selectedCharacter,t),r=n.forward?-1:1;return ne(r,n),i?(i.ch+=r,i):null},moveToCharacter:function(e,t,n){var o=n.repeat;return ne(0,n),re(e,o,n.forward,n.selectedCharacter,t)||t},moveToSymbol:function(e,t,n){return function(e,t,n,o){var i,r,a,s=_(e.getCursor()),c=n?1:-1,l=n?e.lineCount():-1,u=s.ch,h=s.line,d=e.getLine(h),p={lineText:d,nextCh:d.charAt(u),lastCh:null,index:u,symb:o,reverseSymb:(n?{")":"(","}":"{"}:{"(":")","{":"}"})[o],forward:n,depth:0,curMoveThrough:!1},f=mt[o];if(!f)return s;for(i=gt[f].init,r=gt[f].isComplete,i&&i(p);h!==l&&t;)p.index+=c,p.nextCh=p.lineText.charAt(p.index),p.nextCh||(h+=c,p.lineText=e.getLine(h)||"",c>0?p.index=0:(a=p.lineText.length,p.index=a>0?a-1:0),p.nextCh=p.lineText.charAt(p.index)),r(p)&&(s.line=h,s.ch=p.index,t--);return p.nextCh||p.curMoveThrough?new Ve(h,p.index):s}(e,n.repeat,n.forward,n.selectedCharacter)||t},moveToColumn:function(e,t,n,o){var i=n.repeat;return o.lastHPos=i-1,o.lastHSPos=e.charCoords(t,"div").left,function(e,t){var n=e.getCursor().line;return I(e,new Ve(n,t-1))}(e,i)},moveToEol:function(e,t,n,o){return ie(e,t,n,o,!1)},moveToFirstNonWhiteSpaceCharacter:function(e,t){var n=t;return new Ve(n.line,Y(e.getLine(n.line)))},moveToMatchedSymbol:function(e,t){for(var n,o,i,r=t,a=r.line,s=r.ch,c=e.getLine(a);s<c.length&&(!(n=c.charAt(s))||-1=="()[]{}".indexOf(n)||"string"===(o=e.getTokenTypeAt(new Ve(a,s+1)))||"comment"===o);s++);return s<c.length?(i=/[<>]/.test(c[s])?/[(){}[\]<>]/:/[(){}[\]]/,e.findMatchingBracket(new Ve(a,s+1),{bracketRegex:i}).to):r},moveToStartOfLine:function(e,t){return new Ve(t.line,0)},moveToLineOrEdgeOfDocument:function(e,t,n){var o=n.forward?e.lastLine():e.firstLine();return n.repeatIsExplicit&&(o=n.repeat-e.getOption("firstLineNumber")),new Ve(o,Y(e.getLine(o)))},moveToStartOfDisplayLine:function(e){return e.execCommand("goLineLeft"),e.getCursor()},moveToEndOfDisplayLine:function(e){e.execCommand("goLineRight");var t=e.getCursor();return"before"==t.sticky&&t.ch--,t},textObjectManipulation:function(e,t,n,o){var i,r,a,s,c,l,u,h,f,m,g={"(":")",")":"(","{":"}","}":"{","[":"]","]":"[","<":">",">":"<"},y={"'":!0,'"':!0,"`":!0},v=n.selectedCharacter;if("b"==v?v="(":"B"==v&&(v="{"),i=!n.textObjectInner,g[v])a=!0,(r=ue(e,t,v,i))||(s=e.getSearchCursor(new RegExp("\\"+v,"g"),t)).find()&&(r=ue(e,s.from(),v,i));else if(y[v])a=!0,r=function(e,t,n,o){var i,r,a,s,c,l,u=_(t),h=e.getLine(u.line),d=h.split(""),p=d.indexOf(n);if(u.ch<p?u.ch=p:p<u.ch&&d[u.ch]==n&&(c=/string/.test(e.getTokenTypeAt(K(t,0,1))),l=/string/.test(e.getTokenTypeAt(t)),c&&!l||(r=u.ch,--u.ch)),d[u.ch]!=n||r)for(a=u.ch;a>-1&&!i;a--)d[a]==n&&(i=a+1);else i=u.ch+1;if(i&&!r)for(a=i,s=d.length;a<s&&!r;a++)d[a]==n&&(r=a);return i&&r?(o&&(--i,++r),{start:new Ve(u.line,i),end:new Ve(u.line,r)}):{start:u,end:u}}(e,t,v,i);else if("W"===v||"w"===v)for(c=n.repeat||1;c-- >0;)(l=ee(e,{inclusive:i,innerWord:!i,bigWord:"W"===v,noSymbol:"W"===v,multiline:!0},r&&r.end))&&(r||(r=l),r.end=l.end);else"p"===v?(r=ce(e,t,n.repeat,0,i),n.linewise=!0,o.visualMode?o.visualLine||(o.visualLine=!0):((u=o.inputState.operatorArgs)&&(u.linewise=!0),r.end.line--)):"t"===v?r=function(e,t,n){var o,i=t;return De.findMatchingTag&&De.findEnclosingTag&&(o=De.findMatchingTag(e,t)||De.findEnclosingTag(e,t))&&o.open&&o.close?n?{start:o.open.from,end:o.close.to}:{start:o.open.to,end:o.close.from}:{start:i,end:i}}(e,t,i):"s"===v&&(h=e.getLine(t.line),t.ch>0&&p(h[t.ch])&&(t.ch-=1),f=le(e,t,n.repeat,1,i),m=le(e,t,n.repeat,-1,i),d(e.getLine(m.line)[m.ch])&&d(e.getLine(f.line)[f.ch-1])&&(m={line:m.line,ch:m.ch+1}),r={start:m,end:f});return r?e.state.vim.visualMode?function(e,t,n,o){var i,r=e.state.vim.sel,a=o?t:r.head,s=o?t:r.anchor;return D(n,t)&&(i=n,n=t,t=i),D(a,s)?(a=V(t,a),s=W(s,n)):(s=V(t,s),-1==(a=K(a=W(a,n),0,-1)).ch&&a.line!=e.firstLine()&&(a=new Ve(a.line-1,F(e,a.line-1)))),[s,a]}(e,r.start,r.end,a):[r.start,r.end]:null},repeatLastCharacterSearch:function(e,t,n){var o,i=nt.lastCharacterSearch,r=n.repeat,a=n.forward===i.forward,s=(i.increment?1:0)*(a?-1:1);return e.moveH(-s,"char"),n.inclusive=!!a,(o=re(e,r,a,i.selectedCharacter))?(o.ch+=s,o):(e.moveH(s,"char"),t)}},pt={change:function(e,t,n){var o,i,r,a,s,c=e.state.vim,l=n[0].anchor,u=n[0].head;c.visualMode?t.fullLine?(u.ch=Number.MAX_VALUE,u.line--,e.setSelection(l,u),i=e.getSelection(),e.replaceSelection(""),o=l):(i=e.getSelection(),s=B("",n.length),e.replaceSelections(s),o=V(n[0].head,n[0].anchor)):(i=e.getRange(l,u),"moveByWords"!=(r=c.lastEditInputState||{}).motion||d(i)||(a=/\s+$/.exec(i))&&r.motionArgs&&r.motionArgs.forward&&(u=K(u,0,-a[0].length),i=i.slice(0,-a[0].length)),t.linewise&&(l=new Ve(l.line,Y(e.getLine(l.line))),u.line>l.line&&(u=new Ve(u.line-1,Number.MAX_VALUE))),e.replaceRange("",l,u),o=l),nt.registerController.pushText(t.registerName,"change",i,t.linewise,n.length>1),ft.enterInsertMode(e,{head:o},e.state.vim)},delete:function(e,t,n){var o,i,r,a,s,c=e.state.vim;return c.visualBlock?(i=e.getSelection(),s=B("",n.length),e.replaceSelections(s),o=V(n[0].head,n[0].anchor)):(r=n[0].anchor,a=n[0].head,t.linewise&&a.line!=e.firstLine()&&r.line==e.lastLine()&&r.line==a.line-1&&(r.line==e.firstLine()?r.ch=0:r=new Ve(r.line-1,F(e,r.line-1))),i=e.getRange(r,a),e.replaceRange("",r,a),o=r,t.linewise&&(o=dt.moveToFirstNonWhiteSpaceCharacter(e,r))),nt.registerController.pushText(t.registerName,"delete",i,t.linewise,c.visualBlock),I(e,o)},indent:function(e,t,n){var o,i,r,a,s,c=e.state.vim;if(e.indentMore)for(o=c.visualMode?t.repeat:1,i=0;i<o;i++)t.indentRight?e.indentMore():e.indentLess();else for(r=n[0].anchor.line,a=c.visualBlock?n[n.length-1].anchor.line:n[0].head.line,o=c.visualMode?t.repeat:1,t.linewise&&a--,s=r;s<=a;s++)for(i=0;i<o;i++)e.indentLine(s,t.indentRight);return dt.moveToFirstNonWhiteSpaceCharacter(e,n[0].anchor)},indentAuto:function(e,t,n){return e.execCommand("indentAuto"),dt.moveToFirstNonWhiteSpaceCharacter(e,n[0].anchor)},hardWrap:function(e,t,n,o,i){var r,a,s;if(e.hardWrap)return r=n[0].anchor.line,a=n[0].head.line,t.linewise&&a--,(s=e.hardWrap({from:r,to:a}))>r&&t.linewise&&s--,t.keepCursor?o:new Ve(s,0)},changeCase:function(e,t,n,o,i){var r,a,s,c,l,u=e.getSelections(),d=[],p=t.toLower;for(r=0;r<u.length;r++){if(a=u[r],s="",!0===p)s=a.toLowerCase();else if(!1===p)s=a.toUpperCase();else for(c=0;c<a.length;c++)s+=h(l=a.charAt(c))?l.toLowerCase():l.toUpperCase();d.push(s)}return e.replaceSelections(d),t.shouldMoveCursor?i:!e.state.vim.visualMode&&t.linewise&&n[0].anchor.line+1==n[0].head.line?dt.moveToFirstNonWhiteSpaceCharacter(e,o):t.linewise?o:V(n[0].anchor,n[0].head)},yank:function(e,t,n,o){var i=e.state.vim,r=e.getSelection(),a=i.visualMode?V(i.sel.anchor,i.sel.head,n[0].head,n[0].anchor):o;return nt.registerController.pushText(t.registerName,"yank",r,t.linewise,i.visualBlock),a}},ft={jumpListWalk:function(e,t,n){var o,i,r,a;n.visualMode||(o=t.repeat,i=t.forward,a=(a=(r=nt.jumpList.move(e,i?o:-o))?r.find():void 0)||e.getCursor(),e.setCursor(a),e.ace.curOp.command.scrollIntoView="center-animate")},scroll:function(e,t,n){var o,i,r,a,s,c,l,u;n.visualMode||(o=t.repeat||1,i=e.defaultTextHeight(),r=e.getScrollInfo().top,a=i*o,s=t.forward?r+a:r-a,c=_(e.getCursor()),l=e.charCoords(c,"local"),t.forward?s>l.top?(c.line+=(s-l.top)/i,c.line=Math.ceil(c.line),e.setCursor(c),l=e.charCoords(c,"local"),e.scrollTo(null,l.top)):e.scrollTo(null,s):(u=s+e.getScrollInfo().clientHeight)<l.bottom?(c.line-=(l.bottom-u)/i,c.line=Math.floor(c.line),e.setCursor(c),l=e.charCoords(c,"local"),e.scrollTo(null,l.bottom-e.getScrollInfo().clientHeight)):e.scrollTo(null,s))},scrollToCursor:function(e,t){var n,o=e.getCursor().line,i=e.charCoords(new Ve(o,0),"local"),r=e.getScrollInfo().clientHeight,a=i.top;switch(t.position){case"center":a=i.bottom-r/2;break;case"bottom":n=new Ve(o,e.getLine(o).length-1),a=a-r+(e.charCoords(n,"local").bottom-a)}e.scrollTo(null,a)},replayMacro:function(e,t,n){var o=t.selectedCharacter,i=t.repeat,r=nt.macroModeState;for("@"==o?o=r.latestRegister:r.latestRegister=o;i--;)Te(e,n,r,o)},enterMacroRecordMode:function(e,t){var n=nt.macroModeState,o=t.selectedCharacter;nt.registerController.isValidRegister(o)&&n.enterMacroRecordMode(e,o)},toggleOverwrite:function(e){e.state.overwrite?(e.toggleOverwrite(!1),e.setOption("keyMap","vim-insert"),De.signal(e,"vim-mode-change",{mode:"insert"})):(e.toggleOverwrite(!0),e.setOption("keyMap","vim-replace"),De.signal(e,"vim-mode-change",{mode:"replace"}))},enterInsertMode:function(e,t,n){var o,i,a,s;if(!e.getOption("readOnly")){if(n.insertMode=!0,n.insertModeRepeat=t&&t.repeat||1,o=t?t.insertAt:null,i=n.sel,a=t.head||e.getCursor("head"),s=e.listSelections().length,"eol"==o)a=new Ve(a.line,F(e,a.line));else if("bol"==o)a=new Ve(a.line,0);else if("charAfter"==o)a=r(e,a,K(a,0,1)).end;else if("firstNonBlank"==o)a=r(e,a,dt.moveToFirstNonWhiteSpaceCharacter(e,a)).end;else if("startOfSelectedArea"==o){if(!n.visualMode)return;n.visualBlock?(a=new Ve(Math.min(i.head.line,i.anchor.line),Math.min(i.head.ch,i.anchor.ch)),s=Math.abs(i.head.line-i.anchor.line)+1):a=i.head.line<i.anchor.line?i.head:new Ve(i.anchor.line,0)}else if("endOfSelectedArea"==o){if(!n.visualMode)return;n.visualBlock?(a=new Ve(Math.min(i.head.line,i.anchor.line),Math.max(i.head.ch,i.anchor.ch)+1),s=Math.abs(i.head.line-i.anchor.line)+1):a=i.head.line>=i.anchor.line?K(i.head,0,1):new Ve(i.anchor.line,0)}else if("inplace"==o){if(n.visualMode)return}else"lastEdit"==o&&(a=Ae(e)||a);e.setOption("disableInput",!1),t&&t.replace?(e.toggleOverwrite(!0),e.setOption("keyMap","vim-replace"),De.signal(e,"vim-mode-change",{mode:"replace"})):(e.toggleOverwrite(!1),e.setOption("keyMap","vim-insert"),De.signal(e,"vim-mode-change",{mode:"insert"})),nt.macroModeState.isPlaying||(e.on("change",Ee),n.insertEnd&&n.insertEnd.clear(),n.insertEnd=e.setBookmark(a,{insertLeft:!0}),De.on(e.getInputField(),"keydown",Ie)),n.visualMode&&Z(e),q(e,a,s)}},toggleVisualMode:function(e,t,n){var o,i,a=t.repeat,s=e.getCursor();n.visualMode?n.visualLine^t.linewise||n.visualBlock^t.blockwise?(n.visualLine=!!t.linewise,n.visualBlock=!!t.blockwise,De.signal(e,"vim-mode-change",{mode:"visual",subMode:n.visualLine?"linewise":n.visualBlock?"blockwise":""}),G(e)):Z(e):(n.visualMode=!0,n.visualLine=!!t.linewise,n.visualBlock=!!t.blockwise,i=r(e,s,o=I(e,new Ve(s.line,s.ch+a-1))),n.sel={anchor:i.start,head:i.end},De.signal(e,"vim-mode-change",{mode:"visual",subMode:n.visualLine?"linewise":n.visualBlock?"blockwise":""}),G(e),ae(e,n,"<",V(s,o)),ae(e,n,">",W(s,o)))},reselectLastSelection:function(e,t,n){var o,i,r=n.lastSelection;if(n.visualMode&&J(e,n),r){if(o=r.anchorMark.find(),i=r.headMark.find(),!o||!i)return;n.sel={anchor:o,head:i},n.visualMode=!0,n.visualLine=r.visualLine,n.visualBlock=r.visualBlock,G(e),ae(e,n,"<",V(o,i)),ae(e,n,">",W(o,i)),De.signal(e,"vim-mode-change",{mode:"visual",subMode:n.visualLine?"linewise":n.visualBlock?"blockwise":""})}},joinLines:function(e,t,n){var o,i,r,a,s,c,l,u,h,d;for(n.visualMode?(o=e.getCursor("anchor"),D(i=e.getCursor("head"),o)&&(r=i,i=o,o=r),i.ch=F(e,i.line)-1):(a=Math.max(t.repeat,2),o=e.getCursor(),i=I(e,new Ve(o.line+a-1,1/0))),s=0,c=o.line;c<i.line;c++)s=F(e,o.line),l="",u=0,t.keepSpaces||(-1==(u=(h=e.getLine(o.line+1)).search(/\S/))?u=h.length:l=" "),e.replaceRange(l,new Ve(o.line,s),new Ve(o.line+1,u));d=I(e,new Ve(o.line,s)),n.visualMode&&Z(e,!1),e.setCursor(d)},newLineAndEnterInsertMode:function(e,t,n){var o;n.insertMode=!0,(o=_(e.getCursor())).line!==e.firstLine()||t.after?(o.line=t.after?o.line:o.line-1,o.ch=F(e,o.line),e.setCursor(o),(De.commands.newlineAndIndentContinueComment||De.commands.newlineAndIndent)(e)):(e.replaceRange("\n",new Ve(e.firstLine(),0)),e.setCursor(e.firstLine(),0)),this.enterInsertMode(e,{repeat:t.repeat},n)},paste:function(e,t,n){var o=this,i=nt.registerController.getRegister(t.registerName),r=function(){var r=i.toString();o.continuePaste(e,t,n,r,i)};"+"===t.registerName&&"undefined"!=typeof navigator&&void 0!==navigator.clipboard&&"function"==typeof navigator.clipboard.readText?navigator.clipboard.readText().then((function(r){o.continuePaste(e,t,n,r,i)}),(function(){r()})):r()},continuePaste:function(e,t,n,o,i){var r,a,s,c,l,u,h,d,p,f,m,g,y,v,C,w,k,S,x,M=_(e.getCursor());if(o){if(t.matchIndent&&(r=e.getOption("tabSize"),a=function(e){var t=e.split("\t").length-1,n=e.split(" ").length-1;return t*r+1*n},s=e.getLine(e.getCursor().line),c=a(s.match(/^\s*/)[0]),l=o.replace(/\n$/,""),u=o!==l,h=a(o.match(/^\s*/)[0]),o=l.replace(/^\s*/gm,(function(t){var n,o=c+(a(t)-h);return o<0?"":e.getOption("indentWithTabs")?(n=Math.floor(o/r),Array(n+1).join("\t")):Array(o+1).join(" ")})),o+=u?"\n":""),t.repeat>1&&(o=Array(t.repeat+1).join(o)),d=i.linewise,p=i.blockwise){for(o=o.split("\n"),d&&o.pop(),f=0;f<o.length;f++)o[f]=""==o[f]?" ":o[f];M.ch+=t.after?1:0,M.ch=Math.min(F(e,M.line),M.ch)}else d?n.visualMode?o=n.visualLine?o.slice(0,-1):"\n"+o.slice(0,o.length-1)+"\n":t.after?(o="\n"+o.slice(0,o.length-1),M.ch=F(e,M.line)):M.ch=0:M.ch+=t.after?1:0;if(n.visualMode)n.lastPastedText=o,y=function(e,t){var n=t.lastSelection,o=function(){var t=e.listSelections(),n=t[0],o=t[t.length-1];return[D(n.anchor,n.head)?n.anchor:n.head,D(o.anchor,o.head)?o.head:o.anchor]},i=function(){var t,o,i,r,a,s,c,l,u,h=e.getCursor(),d=e.getCursor(),p=n.visualBlock;if(p){for(t=p.width,o=p.height,d=new Ve(h.line+o,h.ch+t),i=[],r=h.line;r<d.line;r++)a={anchor:new Ve(r,h.ch),head:new Ve(r,d.ch)},i.push(a);e.setSelections(i)}else s=n.anchorMark.find(),l=(c=n.headMark.find()).line-s.line,u=c.ch-s.ch,d={line:d.line+l,ch:l?d.ch:u+d.ch},n.visualLine&&(h=new Ve(h.line,0),d=new Ve(d.line,F(e,d.line))),e.setSelection(h,d);return[h,d]};return t.visualMode?o():i()}(e,n),v=y[0],C=y[1],w=e.getSelection(),k=e.listSelections(),S=new Array(k.length).join("1").split("1"),n.lastSelection&&(g=n.lastSelection.headMark.find()),nt.registerController.unnamedRegister.setText(w),p?(e.replaceSelections(S),C=new Ve(v.line+o.length-1,v.ch),e.setCursor(v),Q(e,C),e.replaceSelections(o),m=v):n.visualBlock?(e.replaceSelections(S),e.setCursor(v),e.replaceRange(o,v,v),m=v):(e.replaceRange(o,v,C),m=e.posFromIndex(e.indexFromPos(v)+o.length-1)),g&&(n.lastSelection.headMark=e.setBookmark(g)),d&&(m.ch=0);else if(p){for(e.setCursor(M),f=0;f<o.length;f++)(x=M.line+f)>e.lastLine()&&e.replaceRange("\n",new Ve(x,0)),F(e,x)<M.ch&&z(e,x,M.ch);e.setCursor(M),Q(e,new Ve(M.line+o.length-1,M.ch)),e.replaceSelections(o),m=M}else e.replaceRange(o,M),d?(x=t.after?M.line+1:M.line,m=new Ve(x,Y(e.getLine(x)))):(m=_(M),/\n/.test(o)||(m.ch+=o.length-(t.after?1:0)));n.visualMode&&Z(e,!1),e.setCursor(m)}},undo:function(e,t){e.operation((function(){H(e,De.commands.undo,t.repeat)(),e.setCursor(I(e,e.getCursor("start")))}))},redo:function(e,t){H(e,De.commands.redo,t.repeat)()},setRegister:function(e,t,n){n.inputState.registerName=t.selectedCharacter},insertRegister:function(e,t,n){var o=t.selectedCharacter,i=nt.registerController.getRegister(o),r=i&&i.toString();r&&e.replaceSelection(r)},oneNormalCommand:function(e,t,n){be(e,!0),n.insertModeReturn=!0,De.on(e,"vim-command-done",(function t(){n.visualMode||(n.insertModeReturn&&(n.insertModeReturn=!1,n.insertMode||ft.enterInsertMode(e,{},n)),De.off(e,"vim-command-done",t))}))},setMark:function(e,t,n){ae(e,n,t.selectedCharacter,e.getCursor())},replace:function(e,t,n){var o,i,a,s,c,l,u=t.selectedCharacter,h=e.getCursor(),d=e.listSelections();n.visualMode?(h=e.getCursor("start"),i=e.getCursor("end")):(a=e.getLine(h.line),(o=h.ch+t.repeat)>a.length&&(o=a.length),i=new Ve(h.line,o)),h=(s=r(e,h,i)).start,i=s.end,"\n"==u?(n.visualMode||e.replaceRange("",h,i),(De.commands.newlineAndIndentContinueComment||De.commands.newlineAndIndent)(e)):(c=(c=(c=e.getRange(h,i)).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,u)).replace(/[^\n]/g,u),n.visualBlock?(l=new Array(e.getOption("tabSize")+1).join(" "),c=(c=(c=e.getSelection()).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,u)).replace(/\t/g,l).replace(/[^\n]/g,u).split("\n"),e.replaceSelections(c)):e.replaceRange(c,h,i),n.visualMode?(h=D(d[0].anchor,d[0].head)?d[0].anchor:d[0].head,e.setCursor(h),Z(e,!1)):e.setCursor(K(i,0,-1)))},incrementNumberToken:function(e,t){for(var n,o,i,r,a,s,c,l,u,h,d,p=e.getCursor(),f=e.getLine(p.line),m=/(-?)(?:(0x)([\da-f]+)|(0b|0|)(\d+))/gi;null!==(n=m.exec(f))&&(i=(o=n.index)+n[0].length,!(p.ch<i)););!t.backtrack&&i<=p.ch||n&&(a=n[2]||n[4],s=n[3]||n[5],c=t.increase?1:-1,l={"0b":2,0:8,"":10,"0x":16}[a.toLowerCase()],r=(parseInt(n[1]+s,l)+c*t.repeat).toString(l),u=a?new Array(s.length-r.length+1+n[1].length).join("0"):"",r="-"===r.charAt(0)?"-"+a+u+r.substr(1):a+u+r,h=new Ve(p.line,o),d=new Ve(p.line,i),e.replaceRange(r,h,d),e.setCursor(new Ve(p.line,o+r.length-1)))},repeatLastEdit:function(e,t,n){var o,i=n.lastEditInputState;i&&((o=t.repeat)&&t.repeatIsExplicit?n.lastEditInputState.repeatOverride=o:o=n.lastEditInputState.repeatOverride||o,Ne(e,n,o,!1))},indent:function(e,t){e.indentLine(e.getCursor().line,t.indentRight)},exitInsertMode:be},mt={"(":"bracket",")":"bracket","{":"bracket","}":"bracket","[":"section","]":"section","*":"comment","/":"comment",m:"method",M:"method","#":"preprocess"},gt={bracket:{isComplete:function(e){if(e.nextCh===e.symb){if(e.depth++,e.depth>=1)return!0}else e.nextCh===e.reverseSymb&&e.depth--;return!1}},section:{init:function(e){e.curMoveThrough=!0,e.symb=(e.forward?"]":"[")===e.symb?"{":"}"},isComplete:function(e){return 0===e.index&&e.nextCh===e.symb}},comment:{isComplete:function(e){var t="*"===e.lastCh&&"/"===e.nextCh;return e.lastCh=e.nextCh,t}},method:{init:function(e){e.symb="m"===e.symb?"{":"}",e.reverseSymb="{"===e.symb?"}":"{"},isComplete:function(e){return e.nextCh===e.symb}},preprocess:{init:function(e){e.index=0},isComplete:function(e){if("#"===e.nextCh){var t=e.lineText.match(/^#(\w+)/)[1];if("endif"===t){if(e.forward&&0===e.depth)return!0;e.depth++}else if("if"===t){if(!e.forward&&0===e.depth)return!0;e.depth--}if("else"===t&&0===e.depth)return!0}return!1}}},m("pcre",!0,"boolean"),he.prototype={getQuery:function(){return nt.query},setQuery:function(e){nt.query=e},getOverlay:function(){return this.searchOverlay},setOverlay:function(e){this.searchOverlay=e},isReversed:function(){return nt.isReversed},setReversed:function(e){nt.isReversed=e},getScrollbarAnnotate:function(){return this.annotate},setScrollbarAnnotate:function(e){this.annotate=e}},yt={"\\n":"\n","\\r":"\r","\\t":"\t"},vt={"\\/":"/","\\\\":"\\","\\n":"\n","\\r":"\r","\\t":"\t","\\&":"&"},Ct=0,(wt=function(){this.buildCommandMap_()}).prototype={processCommand:function(e,t,n){var o=this;e.operation((function(){e.curOp.isVimOp=!0,o._processCommand(e,t,n)}))},_processCommand:function(e,t,n){var o,i,r,a=e.state.vim,s=nt.registerController.getRegister(":"),c=s.toString(),l=new De.StringStream(t);s.setText(t),(o=n||{}).input=t;try{this.parseInput_(e,l,o)}catch(t){throw ye(e,t.toString()),t}if(a.visualMode&&Z(e),o.commandName){if(i=this.matchCommand_(o.commandName)){if(r=i.name,i.excludeFromCommandHistory&&s.setText(c),this.parseCommandArgs_(l,o,i),"exToKey"==i.type)return void S(e,i.toKeys,i);if("exToEx"==i.type)return void this.processCommand(e,i.toInput)}}else void 0!==o.line&&(r="move");if(r)try{kt[r](e,o),i&&i.possiblyAsync||!o.callback||o.callback()}catch(t){throw ye(e,t.toString()),t}else ye(e,'Not an editor command ":'+t+'"')},parseInput_:function(e,t,n){var o,i;return t.eatWhile(":"),t.eat("%")?(n.line=e.firstLine(),n.lineEnd=e.lastLine()):(n.line=this.parseLineSpec_(e,t),void 0!==n.line&&t.eat(",")&&(n.lineEnd=this.parseLineSpec_(e,t))),null==n.line?e.state.vim.visualMode?(o=Me(e,e.state.vim,"<"),n.selectionLine=o&&o.line,o=Me(e,e.state.vim,">"),n.selectionLineEnd=o&&o.line):n.selectionLine=e.getCursor().line:(n.selectionLine=n.line,n.selectionLineEnd=n.lineEnd),i=t.match(/^(\w+|!!|@@|[!#&*<=>@~])/),n.commandName=i?i[1]:t.match(/.*/)[0],n},parseLineSpec_:function(e,t){var n,o,i=t.match(/^(\d+)/);if(i)return parseInt(i[1],10)-1;switch(t.next()){case".":return this.parseLineSpecOffset_(t,e.getCursor().line);case"$":return this.parseLineSpecOffset_(t,e.lastLine());case"'":if(n=t.next(),!(o=Me(e,e.state.vim,n)))throw new Error("Mark not set");return this.parseLineSpecOffset_(t,o.line);case"-":case"+":return t.backUp(1),this.parseLineSpecOffset_(t,e.getCursor().line);default:return void t.backUp(1)}},parseLineSpecOffset_:function(e,t){var n,o=e.match(/^([+-])?(\d+)/);return o&&(n=parseInt(o[2],10),"-"==o[1]?t-=n:t+=n),t},parseCommandArgs_:function(e,t,n){var o,i;e.eol()||(t.argString=e.match(/.*/)[0],o=n.argDelimiter||/\s+/,(i=U(t.argString).split(o)).length&&i[0]&&(t.args=i))},matchCommand_:function(e){var t,n,o;for(t=e.length;t>0;t--)if(n=e.substring(0,t),this.commandMap_[n]&&0===(o=this.commandMap_[n]).name.indexOf(e))return o;return null},buildCommandMap_:function(){var e,t,n;for(this.commandMap_={},e=0;e<Fe.length;e++)n=(t=Fe[e]).shortName||t.name,this.commandMap_[n]=t},map:function(e,t,n,o){var i,r;if(":"!=e&&":"==e.charAt(0)){if(n)throw Error("Mode not supported for ex mappings");i=e.substring(1),":"!=t&&":"==t.charAt(0)?this.commandMap_[i]={name:i,type:"exToEx",toInput:t.substring(1),user:!0}:this.commandMap_[i]={name:i,type:"exToKey",toKeys:t,user:!0}}else r={keys:e,type:"keyToKey",toKeys:t,noremap:!!o},n&&(r.context=n),We.unshift(r)},unmap:function(e,t){var n,o,i;if(":"!=e&&":"==e.charAt(0)){if(t)throw Error("Mode not supported for ex mappings");if(n=e.substring(1),this.commandMap_[n]&&this.commandMap_[n].user)return delete this.commandMap_[n],!0}else for(o=e,i=0;i<We.length;i++)if(o==We[i].keys&&We[i].context===t)return We.splice(i,1),!0}},kt={colorscheme:function(e,t){!t.args||t.args.length<1?ye(e,e.getOption("theme")):e.setOption("theme",t.args[0])},map:function(e,t,n,o){var i=t.args;!i||i.length<2?e&&ye(e,"Invalid mapping: "+t.input):St.map(i[0],i[1],n,o)},imap:function(e,t){this.map(e,t,"insert")},nmap:function(e,t){this.map(e,t,"normal")},vmap:function(e,t){this.map(e,t,"visual")},omap:function(e,t){this.map(e,t,"operatorPending")},noremap:function(e,t){this.map(e,t,void 0,!0)},inoremap:function(e,t){this.map(e,t,"insert",!0)},nnoremap:function(e,t){this.map(e,t,"normal",!0)},vnoremap:function(e,t){this.map(e,t,"visual",!0)},onoremap:function(e,t){this.map(e,t,"operatorPending",!0)},unmap:function(e,t,n){var o=t.args;(!o||o.length<1||!St.unmap(o[0],n))&&e&&ye(e,"No such mapping: "+t.input)},mapclear:function(e,t){it.mapclear()},imapclear:function(e,t){it.mapclear("insert")},nmapclear:function(e,t){it.mapclear("normal")},vmapclear:function(e,t){it.mapclear("visual")},omapclear:function(e,t){it.mapclear("operatorPending")},move:function(e,t){ht.processCommand(e,e.state.vim,{type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!1,explicitRepeat:!0,linewise:!0},repeatOverride:t.line+1})},set:function(e,t){var n,o,i,r,a,s,c,l,u=t.args,h=t.setCfg||{};if(!u||u.length<1)e&&ye(e,"Invalid mapping: "+t.input);else{if(o=(n=u[0].split("="))[0],i=n[1],r=!1,a=!1,"?"==o.charAt(o.length-1)){if(i)throw Error("Trailing characters: "+t.argString);o=o.substring(0,o.length-1),r=!0}else"!"==o.charAt(o.length-1)&&(o=o.substring(0,o.length-1),a=!0);void 0===i&&"no"==o.substring(0,2)&&(o=o.substring(2),i=!1),(s=Ye[o]&&"boolean"==Ye[o].type)&&(a?i=!y(o,e,h):null==i&&(i=!0)),!s&&void 0===i||r?(c=y(o,e,h))instanceof Error?ye(e,c.message):ye(e,!0===c||!1===c?" "+(c?"":"no")+o:"  "+o+"="+c):(l=g(o,i,e,h))instanceof Error&&ye(e,l.message)}},setlocal:function(e,t){t.setCfg={scope:"local"},this.set(e,t)},setglobal:function(e,t){t.setCfg={scope:"global"},this.set(e,t)},registers:function(e,t){var n,o,i,r=t.args,a=nt.registerController.registers,s="----------Registers----------\n\n";if(r)for(r=r.join(""),i=0;i<r.length;i++)n=r.charAt(i),nt.registerController.isValidRegister(n)&&(s+='"'+n+"    "+(a[n]||new E).toString()+"\n");else for(n in a)(o=a[n].toString()).length&&(s+='"'+n+"    "+o+"\n");ye(e,s)},sort:function(e,t){function n(e,t){var n,r,s;return o&&(n=e,e=t,t=n),i&&(e=e.toLowerCase(),t=t.toLowerCase()),r=a&&p.exec(e),s=a&&p.exec(t),r?(r=parseInt((r[1]+r[2]).toLowerCase(),f))-(s=parseInt((s[1]+s[2]).toLowerCase(),f)):e<t?-1:1}var o,i,r,a,s,c,l,u,h,d,p,f,m,g,y,v,C,w,k=function(){var e,n,c,l,u;if(t.argString){if((e=new De.StringStream(t.argString)).eat("!")&&(o=!0),e.eol())return;if(!e.eatSpace())return"Invalid arguments";if(!(n=e.match(/([dinuox]+)?\s*(\/.+\/)?\s*/))&&!e.eol())return"Invalid arguments";if(n[1]){if(i=-1!=n[1].indexOf("i"),r=-1!=n[1].indexOf("u"),(c=-1!=n[1].indexOf("d")||-1!=n[1].indexOf("n")&&1)+(l=-1!=n[1].indexOf("x")&&1)+(u=-1!=n[1].indexOf("o")&&1)>1)return"Invalid arguments";a=(c?"decimal":l&&"hex")||u&&"octal"}n[2]&&(s=new RegExp(n[2].substr(1,n[2].length-2),i?"i":""))}}();if(k)ye(e,k+": "+t.argString);else if((c=t.line||e.firstLine())!=(l=t.lineEnd||t.line||e.lastLine())){if(u=new Ve(c,0),h=new Ve(l,F(e,l)),d=e.getRange(u,h).split("\n"),p=s||("decimal"==a?/(-?)([\d]+)/:"hex"==a?/(-?)(?:0x)?([0-9a-f]+)/i:"octal"==a?/([0-7]+)/:null),f="decimal"==a?10:"hex"==a?16:"octal"==a?8:null,m=[],g=[],a||s)for(y=0;y<d.length;y++)(v=s?d[y].match(s):null)&&""!=v[0]?m.push(v):!s&&p.exec(d[y])?m.push(d[y]):g.push(d[y]);else g=d;if(m.sort(s?function(e,t){var n;return o&&(n=e,e=t,t=n),i&&(e[0]=e[0].toLowerCase(),t[0]=t[0].toLowerCase()),e[0]<t[0]?-1:1}:n),s)for(y=0;y<m.length;y++)m[y]=m[y].input;else a||g.sort(n);if(d=o?m.concat(g):g.concat(m),r)for(C=d,d=[],y=0;y<C.length;y++)C[y]!=w&&d.push(C[y]),w=C[y];e.replaceRange(d.join("\n"),u,h)}},vglobal:function(e,t){this.global(e,t)},normal:function(e,t){var n,o,i,r=t.argString;if(r&&"!"==r[0]&&(r=r.slice(1),at=!0),r=r.trimStart())if("number"==typeof(n=t.line))for(o=isNaN(t.lineEnd)?n:t.lineEnd,i=n;i<=o;i++)e.setCursor(i,0),S(e,t.argString.trimStart()),e.state.vim.insertMode&&be(e,!0);else S(e,t.argString.trimStart()),e.state.vim.insertMode&&be(e,!0);else ye(e,"Argument is required.")},global:function(e,t){var n,o,i,r,a,s,c,l,u,h,d,p,f=t.argString;if(f){if(n="v"===t.commandName[0],"!"===f[0]&&"g"===t.commandName[0]&&(n=!0,f=f.slice(1)),o=void 0!==t.line?t.line:e.firstLine(),i=t.lineEnd||t.line||e.lastLine(),r=function(e){return pe(e,"/")}(f),a=f,r.length&&(a=r[0],s=r.slice(1,r.length).join("/")),a)try{Ce(e,a,!0,!0)}catch(t){return void ye(e,"Invalid regex: "+a)}for(c=de(e).getQuery(),l=[],u=o;u<=i;u++)h=e.getLine(u),c.test(h)!==n&&l.push(s?e.getLineHandle(u):h);s?(d=0,(p=function(){var t,n,o;if(d<l.length){if(t=l[d++],null==(n=e.getLineNumber(t)))return void p();o=n+1+s,St.processCommand(e,o,{callback:p})}else e.releaseLineHandles&&e.releaseLineHandles()})()):ye(e,l.join("\n"))}else ye(e,"Regular Expression missing from global")},substitute:function(e,t){var n,o,i,r,a,s,c,l,u,h,d,p,m,g;if(!e.getSearchCursor)throw new Error("Search feature not available. Requires searchcursor.js or any other getSearchCursor implementation.");if(r="",l=!1,u=!1,(o=(n=t.argString)?pe(n,n[0]):[]).length)i=o[0],y("pcre")&&""!==i&&(i=new RegExp(i).source),void 0!==(r=o[1])&&(r=y("pcre")?function(e){for(var t,n,o=new De.StringStream(e),i=[];!o.eol();){for(;o.peek()&&"\\"!=o.peek();)i.push(o.next());for(n in t=!1,vt)if(o.match(n,!0)){t=!0,i.push(vt[n]);break}t||i.push(o.next())}return i.join("")}(r.replace(/([^\\])&/g,"$1$$&")):function(e){var t,n,o,i,r=!1,a=[];for(t=-1;t<e.length;t++)n=e.charAt(t)||"",o=e.charAt(t+1)||"",yt[n+o]?(a.push(yt[n+o]),t++):r?(a.push(n),r=!1):"\\"===n?(r=!0,i=o,ze.test(i)||"$"===o?a.push("$"):"/"!==o&&"\\"!==o&&a.push("\\")):("$"===n&&a.push("$"),a.push(n),"/"===o&&a.push("\\"));return a.join("")}(r),nt.lastSubstituteReplacePart=r),a=o[2]?o[2].split(" "):[];else if(n&&n.length)return void ye(e,"Substitutions should be of the form :s/pattern/replace/");if(a&&(s=a[0],c=parseInt(a[1]),s&&(-1!=s.indexOf("c")&&(l=!0),-1!=s.indexOf("g")&&(u=!0),i=y("pcre")?i+"/"+s:i.replace(/\//g,"\\/")+"/"+s)),i)try{Ce(e,i,!0,!0)}catch(t){return void ye(e,"Invalid regex: "+i)}void 0!==(r=r||nt.lastSubstituteReplacePart)?(h=de(e).getQuery(),d=void 0!==t.line?t.line:e.getCursor().line,p=t.lineEnd||d,d==e.firstLine()&&p==e.lastLine()&&(p=1/0),c&&(p=(d=p)+c-1),m=I(e,new Ve(d,0)),g=e.getSearchCursor(h,m),function(e,t,n,o,i,r,a,s,c){function l(){e.operation((function(){for(;!p;)u(),h();d()}))}function u(){var t=e.getRange(r.from(),r.to()).replace(a,s),n=r.to().line;r.replace(t),g=r.to().line,i+=g-n,y=g<n}function h(){for(;c=void 0,l=void 0,c=m&&_(r.to()),(l=r.findNext())&&!l[0]&&c&&$(r.from(),c)&&(l=r.findNext()),l&&(t=r.from(),a=o,s=i,"number"!=typeof t&&(t=t.line),a instanceof Array?f(t,a):"number"==typeof s?t>=a&&t<=s:t==a);)if(n||r.from().line!=g||y)return e.scrollIntoView(r.from(),30),e.setSelection(r.from(),r.to()),m=r.from(),void(p=!1);var t,a,s,c,l;p=!0}function d(t){if(t&&t(),e.focus(),m){e.setCursor(m);var n=e.state.vim;n.exMode=!1,n.lastHPos=n.lastHSPos=m.ch}c&&c()}var p,m,g,y;if(e.state.vim.exMode=!0,p=!1,h(),!p)return t?void ve(e,{prefix:ge("span","replace with ",ge("strong",s)," (y/n/a/q/l)"),onKeyDown:function(t,n,o){var i;switch(De.e_stop(t),x(t)){case"y":u(),h();break;case"n":h();break;case"a":i=c,c=void 0,e.operation(l),c=i;break;case"l":u();case"q":case"<Esc>":case"<C-c>":case"<C-[>":d(o)}return p&&d(o),!0}}):(l(),void(c&&c()));ye(e,"No matches for "+a.source)}(e,l,u,d,p,g,h,r,t.callback)):ye(e,"No previous substitute regular expression")},startinsert:function(e,t){S(e,"!"==t.argString?"A":"i",{})},redo:De.commands.redo,undo:De.commands.undo,write:function(e){De.commands.save?De.commands.save(e):e.save&&e.save()},nohlsearch:function(e){Se(e)},yank:function(e){var t=_(e.getCursor()),n=t.line,o=e.getLine(n);nt.registerController.pushText("0","yank",o,!0,!0)},delete:function(e,t){var n=t.selectionLine,o=isNaN(t.selectionLineEnd)?n:t.selectionLineEnd;pt.delete(e,{linewise:!0},[{anchor:new Ve(n,0),head:new Ve(o+1,0)}])},join:function(e,t){var n=t.selectionLine,o=isNaN(t.selectionLineEnd)?n:t.selectionLineEnd;e.setCursor(new Ve(n,0)),ft.joinLines(e,{repeat:o-n},e.state.vim)},delmarks:function(e,t){var n,o,i,r,a,s,c,l,d,p;if(t.argString&&U(t.argString))for(n=e.state.vim,o=new De.StringStream(U(t.argString));!o.eol();){if(o.eatSpace(),i=o.pos,!o.match(/[a-zA-Z]/,!1))return void ye(e,"Invalid argument: "+t.argString.substring(i));if(r=o.next(),o.match("-",!0)){if(!o.match(/[a-zA-Z]/,!1))return void ye(e,"Invalid argument: "+t.argString.substring(i));if(a=r,s=o.next(),!(u(a)&&u(s)||h(a)&&h(s)))return void ye(e,"Invalid argument: "+a+"-");if((c=a.charCodeAt(0))>=(l=s.charCodeAt(0)))return void ye(e,"Invalid argument: "+t.argString.substring(i));for(d=0;d<=l-c;d++)p=String.fromCharCode(c+d),delete n.marks[p]}else delete n.marks[r]}else ye(e,"Argument required")}},St=new wt,m("insertModeEscKeysTimeout",200,"number"),De.Vim=it,xt={return:"CR",backspace:"BS",delete:"Del",esc:"Esc",left:"Left",right:"Right",up:"Up",down:"Down",space:"Space",insert:"Ins",home:"Home",end:"End",pageup:"PageUp",pagedown:"PageDown",enter:"CR"},Mt=it.handleKey.bind(it),it.handleKey=function(e,t,n){return e.operation((function(){return Mt(e,t,n)}),!0)},w(),t.CodeMirror=De,At=it.maybeInitVimState_,t.handler={$id:"ace/keyboard/vim",drawCursor:function(e,t,n,o,i){var r=this.state.vim||{},a=n.characterWidth,s=n.lineHeight,c=t.top,l=t.left;r.insertMode||!(o.cursor?bt.comparePoints(o.cursor,o.start)<=0:i.selection.isBackwards()||i.selection.isEmpty())&&l>a&&(l-=a),!r.insertMode&&r.status&&(c+=s/=2),Tt.translate(e,l,c),Tt.setStyle(e.style,"width",a+"px"),Tt.setStyle(e.style,"height",s+"px")},$getDirectionForHighlight:function(e){var t=e.state.cm,n=At(t);if(!n.insertMode)return e.session.selection.isBackwards()||e.session.selection.isEmpty()},handleKeyboard:function(e,t,n,o,i){var r,a,s,c,l=e.editor,u=l.state.cm,h=At(u);if(-1!=o){if(h.insertMode||(-1==t?(n.charCodeAt(0)>255&&e.inputKey&&(n=e.inputKey)&&4==e.inputHash&&(n=n.toUpperCase()),e.inputChar=n):4==t||0==t?e.inputKey==n&&e.inputHash==t&&e.inputChar?(n=e.inputChar,t=-1):(e.inputChar=null,e.inputKey=n,e.inputHash=t):e.inputChar=e.inputKey=null),u.state.overwrite&&h.insertMode&&"backspace"==n&&0==t)return{command:"gotoleft"};if("c"==n&&1==t&&!It.isMac&&l.getCopyText())return l.once("copy",(function(){h.insertMode?l.selection.clearSelection():u.operation((function(){Z(u)}))})),{command:"null",passEvent:!0};if("esc"!=n||h.insertMode||h.visualMode||u.ace.inMultiSelectMode||(r=de(u).getOverlay())&&u.removeOverlay(r),-1==t||1&t||0===t&&n.length>1){if(a=h.insertMode,s=function(e,t,n,o){var i,r;return t.length>1&&"n"==t[0]&&(t=t.replace("numpad","")),t=xt[t]||t,i="",n.ctrlKey&&(i+="C-"),n.altKey&&(i+="A-"),(i||t.length>1)&&n.shiftKey&&(i+="S-"),o&&!o.expectLiteralNext&&1==t.length&&(Ue.keymap&&t in Ue.keymap?!1===Ue.remapCtrl&&i||(t=Ue.keymap[t]):t.charCodeAt(0)>255&&(r=n.code&&n.code.slice(-1)||"",n.shiftKey||(r=r.toLowerCase()),r&&(t=r))),(i+=t).length>1&&(i="<"+i+">"),i}(0,n,i||{},h),null==h.status&&(h.status=""),c=_e(u,s,"user"),h=At(u),c&&null!=h.status?h.status+=s:null==h.status&&(h.status=""),u._signal("changeStatus"),!c&&(-1!=t||a))return;return{command:"null",passEvent:!c}}}},attach:function(e){function t(){var t=At(n).insertMode;n.ace.renderer.setStyle("normal-mode",!t),e.textInput.setCommandMode(!t),e.renderer.$keepTextAreaAtCursor=t,e.renderer.$blockCursor=!t}e.state||(e.state={});var n=new De(e);e.state.cm=n,e.$vimModeHandler=this,a(n),At(n).status=null,n.on("vim-command-done",(function(){n.virtualSelectionMode()||(At(n).status=null,n.ace._signal("changeStatus"),n.ace.session.markUndoGroup())})),n.on("changeStatus",(function(){n.ace.renderer.updateCursor(),n.ace._signal("changeStatus")})),n.on("vim-mode-change",(function(){n.virtualSelectionMode()||(t(),n._signal("changeStatus"))})),t(),e.renderer.$cursorLayer.drawCursor=this.drawCursor.bind(n)},detach:function(e){var t=e.state.cm;s(t),t.destroy(),e.state.cm=null,e.$vimModeHandler=null,e.renderer.$cursorLayer.drawCursor=null,e.renderer.setStyle("normal-mode",!1),e.textInput.setCommandMode(!1),e.renderer.$keepTextAreaAtCursor=!0},getStatusText:function(e){var t,n=e.state.cm,o=At(n);return o.insertMode?"INSERT":(t="",o.visualMode&&(t+="VISUAL",o.visualLine&&(t+=" LINE"),o.visualBlock&&(t+=" BLOCK")),o.status&&(t+=(t?" ":"")+o.status),t)}},it.defineOption({name:"wrap",set:function(e,t){t&&t.ace.setOption("wrap",e)},type:"boolean"},!1),it.defineEx("write","w",(function(){console.log(":write is not implemented")})),We.push({keys:"zc",type:"action",action:"fold",actionArgs:{open:!1}},{keys:"zC",type:"action",action:"fold",actionArgs:{open:!1,all:!0}},{keys:"zo",type:"action",action:"fold",actionArgs:{open:!0}},{keys:"zO",type:"action",action:"fold",actionArgs:{open:!0,all:!0}},{keys:"za",type:"action",action:"fold",actionArgs:{toggle:!0}},{keys:"zA",type:"action",action:"fold",actionArgs:{toggle:!0,all:!0}},{keys:"zf",type:"action",action:"fold",actionArgs:{open:!0,all:!0}},{keys:"zd",type:"action",action:"fold",actionArgs:{open:!0,all:!0}},{keys:"<C-A-k>",type:"action",action:"aceCommand",actionArgs:{name:"addCursorAbove"}},{keys:"<C-A-j>",type:"action",action:"aceCommand",actionArgs:{name:"addCursorBelow"}},{keys:"<C-A-S-k>",type:"action",action:"aceCommand",actionArgs:{name:"addCursorAboveSkipCurrent"}},{keys:"<C-A-S-j>",type:"action",action:"aceCommand",actionArgs:{name:"addCursorBelowSkipCurrent"}},{keys:"<C-A-h>",type:"action",action:"aceCommand",actionArgs:{name:"selectMoreBefore"}},{keys:"<C-A-l>",type:"action",action:"aceCommand",actionArgs:{name:"selectMoreAfter"}},{keys:"<C-A-S-h>",type:"action",action:"aceCommand",actionArgs:{name:"selectNextBefore"}},{keys:"<C-A-S-l>",type:"action",action:"aceCommand",actionArgs:{name:"selectNextAfter"}}),We.push({keys:"gq",type:"operator",operator:"hardWrap"}),it.defineOperator("hardWrap",(function(e,t,n,o,i){var r=n[0].anchor.line,a=n[0].head.line;return t.linewise&&a--,Ht(e.ace,{startRow:r,endRow:a}),Ve(a,0)})),m("textwidth",void 0,"number",["tw"],(function(e,t){var n;if(void 0!==t)return void 0===e?t.ace.getOption("printMarginColumn"):void((n=Math.round(e))>1&&t.ace.setOption("printMarginColumn",n))})),ft.aceCommand=function(e,t,n){e.vimCmd=t,e.ace.inVirtualSelectionMode?e.ace.on("beforeEndOperation",$e):$e(0,e.ace)},ft.fold=function(e,t,n){e.ace.execCommand(["toggleFoldWidget","toggleFoldWidget","foldOther","unfoldall"][(t.all?2:0)+(t.open?1:0)])},je=We.length,t.handler.defaultKeymap=We,t.handler.actions=ft,t.Vim=it})),ace.require(["ace/keyboard/vim"],(function(e){"object"==typeof module&&"object"==typeof exports&&module&&(module.exports=e)}));