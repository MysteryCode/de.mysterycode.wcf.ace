ace.define("ace/ext/chromevox",["require","exports","module","ace/editor","ace/config"],function(e,n,o){function t(){return"undefined"!=typeof cvox&&cvox&&cvox.Api}function c(e){if(t())Z(e);else{if(++ee>=ne)return;window.setTimeout(c,500,e)}}var r={};r.SpeechProperty,r.Cursor,r.Token,r.Annotation;var i={punctuationEcho:"none",relativePitch:-.6},a=[{substr:";",newSubstr:" semicolon "},{substr:":",newSubstr:" colon "}],u={SPEAK_ANNOT:"annots",SPEAK_ALL_ANNOTS:"all_annots",TOGGLE_LOCATION:"toggle_location",SPEAK_MODE:"mode",SPEAK_ROW_COL:"row_col",TOGGLE_DISPLACEMENT:"toggle_displacement",FOCUS_TEXT:"focus_text"};r.editor=null;var s=null,p={},l=!1,f=!1,d=!1,v=null,m={},A={},g=function(e){return"CONTROL + SHIFT "+String.fromCharCode(e)},E=function(){return"ace/keyboard/vim"===r.editor.keyBinding.getKeyboardHandler().$id},h=function(e){return r.editor.getSession().getTokenAt(e.row,e.column+1)},S=function(e){return r.editor.getSession().getLine(e.row)},k=function(e){p[e.row]&&cvox.Api.playEarcon("ALERT_NONMODAL"),l?(cvox.Api.stop(),P(e),b(h(e)),_(e.row,1)):_(e.row,0)},x=function(e){var n=S(e),o=n.substr(e.column-1);0===e.column&&(o=" "+n);return null!==/^\W(\w+)/.exec(o)},y={constant:{prop:{rate:.8,pitch:.4,volume:.9}},entity:{prop:{rate:.8,pitch:.8,volume:.9}},keyword:{prop:{rate:.8,pitch:.3,volume:.9}},storage:{prop:{rate:.8,pitch:.7,volume:.9}},variable:{prop:{rate:.8,pitch:.8,volume:.9}},meta:{prop:{rate:1,pitch:.5,volume:.9},replace:[{substr:"</",newSubstr:" closing tag "},{substr:"/>",newSubstr:" close tag "},{substr:"<",newSubstr:" tag start "},{substr:">",newSubstr:" tag end "}]}},w={prop:w},T=function(e,n){for(var o=e,t=0;t<n.length;t++){var c=n[t],r=new RegExp(c.substr,"g");o=o.replace(r,c.newSubstr)}return o},O=function(e,n,o){var t={};t.value="",t.type=e[n].type;for(var c=n;c<o;c++)t.value+=e[c].value;return t},C=function(e){if(e.length<=1)return e;for(var n=[],o=0,t=1;t<e.length;t++){var c=e[o],r=e[t];N(c)!==N(r)&&(n.push(O(e,o,t)),o=t)}return n.push(O(e,o,e.length)),n},L=function(e){var n=r.editor.getSession().getLine(e);return null!==/^\s*$/.exec(n)},_=function(e,n){var o=r.editor.getSession().getTokens(e);if(0===o.length||L(e))cvox.Api.playEarcon("EDITABLE_TEXT");else{var t=(o=C(o))[0];o=o.filter(function(e){return e!==t}),K(t,n),o.forEach(b)}},b=function(e){K(e,1)},N=function(e){if(e&&e.type){var n=e.type.split(".");if(0!==n.length){var o=n[0],t=y[o];return t||w}}},K=function(e,n){var o=N(e),t=T(e.value,a);o.replace&&(t=T(t,o.replace)),cvox.Api.speak(t,n,o.prop)},P=function(e){var n=S(e);cvox.Api.speak(n[e.column],1)},M=function(e,n){var o=S(n).substring(e.column,n.column);o=o.replace(/ /g," space "),cvox.Api.speak(o)},D=function(e,n){if(1!==Math.abs(e.column-n.column)){var o=S(n).length;if(0===n.column||n.column===o)return void _(n.row,0);if(x(n))return cvox.Api.stop(),void b(h(n))}P(n)},I=function(e,n){r.editor.selection.isEmpty()?f?M(e,n):D(e,n):(M(e,n),cvox.Api.speak("selected",1))},R=function(e){if(d)d=!1;else{var n=r.editor.selection.getCursor();n.row!==s.row?k(n):I(s,n),s=n}},G=function(e){r.editor.selection.isEmpty()&&cvox.Api.speak("unselected")},B=function(e){switch(e.action){case"remove":cvox.Api.speak(e.text,0,i),d=!0;break;case"insert":cvox.Api.speak(e.text,0),d=!0}},F=function(e){var n=e.row,o=e.column;return!p[n]||!p[n][o]},$=function(e){p={};for(var n=0;n<e.length;n++){var o=e[n],t=o.row,c=o.column;p[t]||(p[t]={}),p[t][c]=o}},q=function(e){var n=r.editor.getSession().getAnnotations();n.filter(F).length>0&&cvox.Api.playEarcon("ALERT_NONMODAL"),$(n)},W=function(e){var n=e.type+" "+e.text+" on "+H(e.row,e.column);n=n.replace(";","semicolon"),cvox.Api.speak(n,1)},X=function(e){var n=p[e];for(var o in n)W(n[o])},H=function(e,n){return"row "+(e+1)+" column "+(n+1)},U=function(e){if(e.ctrlKey&&e.shiftKey){var n=m[e.keyCode];n&&n.func()}},V=function(e,n){if(E()){var o=n.keyBinding.$data.state;if(o!==v){switch(o){case"insertMode":cvox.Api.playEarcon("ALERT_MODAL"),cvox.Api.setKeyEcho(!0);break;case"start":cvox.Api.playEarcon("ALERT_MODAL"),cvox.Api.setKeyEcho(!1)}v=o}}},J=function(e){var n=e.detail.customCommand,o=A[n];o&&(o.func(),r.editor.focus())},Y=function(){var e=z.map(function(e){return{desc:e.desc+g(e.keyCode),cmd:e.cmd}}),n=document.querySelector("body");n.setAttribute("contextMenuActions",JSON.stringify(e)),n.addEventListener("ATCustomEvent",J,!0)},j=function(e){e.match?_(s.row,0):cvox.Api.playEarcon("INVALID_KEYPRESS")},z=[{keyCode:49,func:function(){X(s.row)},cmd:u.SPEAK_ANNOT,desc:"Speak annotations on line"},{keyCode:50,func:function(){for(var e in p)X(e)},cmd:u.SPEAK_ALL_ANNOTS,desc:"Speak all annotations"},{keyCode:51,func:function(){if(E())switch(r.editor.keyBinding.$data.state){case"insertMode":cvox.Api.speak("Insert mode");break;case"start":cvox.Api.speak("Command mode")}},cmd:u.SPEAK_MODE,desc:"Speak Vim mode"},{keyCode:52,func:function(){(l=!l)?cvox.Api.speak("Speak location on row change enabled."):cvox.Api.speak("Speak location on row change disabled.")},cmd:u.TOGGLE_LOCATION,desc:"Toggle speak row location"},{keyCode:53,func:function(){cvox.Api.speak(H(s.row,s.column))},cmd:u.SPEAK_ROW_COL,desc:"Speak row and column"},{keyCode:54,func:function(){(f=!f)?cvox.Api.speak("Speak displacement on column changes."):cvox.Api.speak("Speak current character or word on column changes.")},cmd:u.TOGGLE_DISPLACEMENT,desc:"Toggle speak displacement"},{keyCode:55,func:function(){r.editor.focus()},cmd:u.FOCUS_TEXT,desc:"Focus text"}],Q=function(e,n){r.editor=n,n.getSession().selection.on("changeCursor",R),n.getSession().selection.on("changeSelection",G),n.getSession().on("change",B),n.getSession().on("changeAnnotation",q),n.on("changeStatus",V),n.on("findSearchBox",j),n.container.addEventListener("keydown",U),s=n.selection.getCursor()},Z=function(e){Q(0,e),z.forEach(function(e){m[e.keyCode]=e,A[e.cmd]=e}),e.on("focus",Q),E()&&cvox.Api.setKeyEcho(!1),Y()},ee=0,ne=15,oe=e("../editor").Editor;e("../config").defineOptions(oe.prototype,"editor",{enableChromevoxEnhancements:{set:function(e){e&&c(this)},value:!0}})}),ace.require(["ace/ext/chromevox"],function(){});