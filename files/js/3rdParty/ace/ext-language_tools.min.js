ace.define("ace/snippets",["require","exports","module","ace/lib/dom","ace/lib/oop","ace/lib/event_emitter","ace/lib/lang","ace/range","ace/range_list","ace/keyboard/hash_handler","ace/tokenizer","ace/clipboard","ace/editor"],(function(e,t,i){"use strict";function n(e){var t=(new Date).toLocaleString("en-us",e);return 1==t.length?"0"+t:t}var o,r,s,a,p,c,l=e("./lib/dom"),h=e("./lib/oop"),u=e("./lib/event_emitter").EventEmitter,d=e("./lib/lang"),f=e("./range").Range,g=e("./range_list").RangeList,m=e("./keyboard/hash_handler").HashHandler,b=e("./tokenizer").Tokenizer,v=e("./clipboard"),y={CURRENT_WORD:function(e){return e.session.getTextRange(e.session.getWordRange())},SELECTION:function(e,t,i){var n=e.session.getTextRange();return i?n.replace(/\n\r?([ \t]*\S)/g,"\n"+i+"$1"):n},CURRENT_LINE:function(e){return e.session.getLine(e.getCursorPosition().row)},PREV_LINE:function(e){return e.session.getLine(e.getCursorPosition().row-1)},LINE_INDEX:function(e){return e.getCursorPosition().row},LINE_NUMBER:function(e){return e.getCursorPosition().row+1},SOFT_TABS:function(e){return e.session.getUseSoftTabs()?"YES":"NO"},TAB_SIZE:function(e){return e.session.getTabSize()},CLIPBOARD:function(e){return v.getText&&v.getText()},FILENAME:function(e){return/[^/\\]*$/.exec(this.FILEPATH(e))[0]},FILENAME_BASE:function(e){return/[^/\\]*$/.exec(this.FILEPATH(e))[0].replace(/\.[^.]*$/,"")},DIRECTORY:function(e){return this.FILEPATH(e).replace(/[^/\\]*$/,"")},FILEPATH:function(e){return"/not implemented.txt"},WORKSPACE_NAME:function(){return"Unknown"},FULLNAME:function(){return"Unknown"},BLOCK_COMMENT_START:function(e){var t=e.session.$mode||{};return t.blockComment&&t.blockComment.start||""},BLOCK_COMMENT_END:function(e){var t=e.session.$mode||{};return t.blockComment&&t.blockComment.end||""},LINE_COMMENT:function(e){return(e.session.$mode||{}).lineCommentStart||""},CURRENT_YEAR:n.bind(null,{year:"numeric"}),CURRENT_YEAR_SHORT:n.bind(null,{year:"2-digit"}),CURRENT_MONTH:n.bind(null,{month:"numeric"}),CURRENT_MONTH_NAME:n.bind(null,{month:"long"}),CURRENT_MONTH_NAME_SHORT:n.bind(null,{month:"short"}),CURRENT_DATE:n.bind(null,{day:"2-digit"}),CURRENT_DAY_NAME:n.bind(null,{weekday:"long"}),CURRENT_DAY_NAME_SHORT:n.bind(null,{weekday:"short"}),CURRENT_HOUR:n.bind(null,{hour:"2-digit",hour12:!1}),CURRENT_MINUTE:n.bind(null,{minute:"2-digit"}),CURRENT_SECOND:n.bind(null,{second:"2-digit"})};y.SELECTED_TEXT=y.SELECTION,o=function(){function e(){this.snippetMap={},this.snippetNameMap={},this.variables=y}return e.prototype.getTokenizer=function(){return e.$tokenizer||this.createTokenizer()},e.prototype.createTokenizer=function(){function t(e){return e=e.substr(1),/^\d+$/.test(e)?[{tabstopId:parseInt(e,10)}]:[{text:e}]}function i(e){return"(?:[^\\\\"+e+"]|\\\\.)"}var n={regex:"/("+i("/")+"+)/",onMatch:function(e,t,i){var n=i[0];return n.fmtString=!0,n.guard=e.slice(1,-1),n.flag="",""},next:"formatString"};return e.$tokenizer=new b({start:[{regex:/\\./,onMatch:function(e,t,i){var n=e[1];return("}"==n&&i.length||-1!="`$\\".indexOf(n))&&(e=n),[e]}},{regex:/}/,onMatch:function(e,t,i){return[i.length?i.shift():e]}},{regex:/\$(?:\d+|\w+)/,onMatch:t},{regex:/\$\{[\dA-Z_a-z]+/,onMatch:function(e,i,n){var o=t(e.substr(1));return n.unshift(o[0]),o},next:"snippetVar"},{regex:/\n/,token:"newline",merge:!1}],snippetVar:[{regex:"\\|"+i("\\|")+"*\\|",onMatch:function(e,t,i){var n=e.slice(1,-1).replace(/\\[,|\\]|,/g,(function(e){return 2==e.length?e[1]:"\0"})).split("\0").map((function(e){return{value:e}}));return i[0].choices=n,[n[0]]},next:"start"},n,{regex:"([^:}\\\\]|\\\\.)*:?",token:"",next:"start"}],formatString:[{regex:/:/,onMatch:function(e,t,i){return i.length&&i[0].expectElse?(i[0].expectElse=!1,i[0].ifEnd={elseEnd:i[0]},[i[0].ifEnd]):":"}},{regex:/\\./,onMatch:function(e,t,i){var n=e[1];return"}"==n&&i.length||-1!="`$\\".indexOf(n)?e=n:"n"==n?e="\n":"t"==n?e="\t":-1!="ulULE".indexOf(n)&&(e={changeCase:n,local:n>"a"}),[e]}},{regex:"/\\w*}",onMatch:function(e,t,i){var n=i.shift();return n&&(n.flag=e.slice(1,-1)),this.next=n&&n.tabstopId?"start":"",[n||e]},next:"start"},{regex:/\$(?:\d+|\w+)/,onMatch:function(e,t,i){return[{text:e.slice(1)}]}},{regex:/\${\w+/,onMatch:function(e,t,i){var n={text:e.slice(2)};return i.unshift(n),[n]},next:"formatStringVar"},{regex:/\n/,token:"newline",merge:!1},{regex:/}/,onMatch:function(e,t,i){var n=i.shift();return this.next=n&&n.tabstopId?"start":"",[n||e]},next:"start"}],formatStringVar:[{regex:/:\/\w+}/,onMatch:function(e,t,i){return i[0].formatFunction=e.slice(2,-1),[i.shift()]},next:"formatString"},n,{regex:/:[\?\-+]?/,onMatch:function(e,t,i){"+"==e[1]&&(i[0].ifEnd=i[0]),"?"==e[1]&&(i[0].expectElse=!0)},next:"formatString"},{regex:"([^:}\\\\]|\\\\.)*:?",token:"",next:"formatString"}]}),e.$tokenizer},e.prototype.tokenizeTmSnippet=function(e,t){return this.getTokenizer().getLineTokens(e,t).tokens.map((function(e){return e.value||e}))},e.prototype.getVariableValue=function(e,t,i){if(/^\d+$/.test(t))return(this.variables.__||{})[t]||"";if(/^[A-Z]\d+$/.test(t))return(this.variables[t[0]+"__"]||{})[t.substr(1)]||"";if(t=t.replace(/^TM_/,""),!this.variables.hasOwnProperty(t))return"";var n=this.variables[t];return"function"==typeof n&&(n=this.variables[t](e,t,i)),null==n?"":n},e.prototype.tmStrFormat=function(e,t,i){var n,o,r,s,a;return t.fmt?(n=t.flag||"",o=t.guard,o=new RegExp(o,n.replace(/[^gim]/g,"")),r="string"==typeof t.fmt?this.tokenizeTmSnippet(t.fmt,"formatString"):t.fmt,s=this,a=e.replace(o,(function(){var e,t,n,o,a,p=s.variables.__;for(s.variables.__=[].slice.call(arguments),e=s.resolveVariables(r,i),t="E",n=0;n<e.length;n++)"object"==typeof(o=e[n])?(e[n]="",o.changeCase&&o.local?(a=e[n+1])&&"string"==typeof a&&("u"==o.changeCase?e[n]=a[0].toUpperCase():e[n]=a[0].toLowerCase(),e[n+1]=a.substr(1)):o.changeCase&&(t=o.changeCase)):"U"==t?e[n]=o.toUpperCase():"L"==t&&(e[n]=o.toLowerCase());return s.variables.__=p,e.join("")})),a):e},e.prototype.tmFormatFunction=function(e,t,i){return"upcase"==t.formatFunction?e.toUpperCase():"downcase"==t.formatFunction?e.toLowerCase():e},e.prototype.resolveVariables=function(e,t){function i(t){var i=e.indexOf(t,n+1);-1!=i&&(n=i)}var n,o,r,s,a=[],p="",c=!0;for(n=0;n<e.length;n++)"string"!=typeof(o=e[n])?o&&(c=!1,o.fmtString&&(-1==(r=e.indexOf(o,n+1))&&(r=e.length),o.fmt=e.slice(n+1,r),n=r),o.text?(s=this.getVariableValue(t,o.text,p)+"",o.fmtString&&(s=this.tmStrFormat(s,o,t)),o.formatFunction&&(s=this.tmFormatFunction(s,o,t)),s&&!o.ifEnd?(a.push(s),i(o)):!s&&o.ifEnd&&i(o.ifEnd)):o.elseEnd?i(o.elseEnd):(null!=o.tabstopId||null!=o.changeCase)&&a.push(o)):(a.push(o),"\n"==o?(c=!0,p=""):c&&(p=/^\t*/.exec(o)[0],c=/\S/.test(o)));return a},e.prototype.getDisplayTextForSnippet=function(e,t){return r.call(this,e,t).text},e.prototype.insertSnippetForSelection=function(e,t,i){var n,o,a,p,c;void 0===i&&(i={}),n=r.call(this,e,t,i),o=e.getSelectionRange(),a=e.session.replace(o,n.text),p=new s(e),c=e.inVirtualSelectionMode&&e.selection.index,p.addTabstops(n.tabstops,o.start,a,c)},e.prototype.insertSnippet=function(e,t,i){void 0===i&&(i={});var n=this;if(e.inVirtualSelectionMode)return n.insertSnippetForSelection(e,t,i);e.forEachSelection((function(){n.insertSnippetForSelection(e,t,i)}),null,{keepOrder:!0}),e.tabstopManager&&e.tabstopManager.tabNext()},e.prototype.$getScope=function(e){var t,i,n=e.session.$mode.$id||"";return"html"!==(n=n.split("/").pop())&&"php"!==n||("php"!==n||e.session.$mode.inlinePhp||(n="html"),t=e.getCursorPosition(),"object"==typeof(i=e.session.getState(t.row))&&(i=i[0]),i.substring&&("js-"==i.substring(0,3)?n="javascript":"css-"==i.substring(0,4)?n="css":"php-"==i.substring(0,4)&&(n="php"))),n},e.prototype.getActiveScopes=function(e){var t=this.$getScope(e),i=[t],n=this.snippetMap;return n[t]&&n[t].includeScopes&&i.push.apply(i,n[t].includeScopes),i.push("_"),i},e.prototype.expandWithTab=function(e,t){var i=this,n=e.forEachSelection((function(){return i.expandSnippetForSelection(e,t)}),null,{keepOrder:!0});return n&&e.tabstopManager&&e.tabstopManager.tabNext(),n},e.prototype.expandSnippetForSelection=function(e,t){var i,n=e.getCursorPosition(),o=e.session.getLine(n.row),r=o.substring(0,n.column),s=o.substr(n.column),a=this.snippetMap;return this.getActiveScopes(e).some((function(e){var t=a[e];return t&&(i=this.findMatchingSnippet(t,r,s)),!!i}),this),!!i&&(t&&t.dryRun||(e.session.doc.removeInLine(n.row,n.column-i.replaceBefore.length,n.column+i.replaceAfter.length),this.variables.M__=i.matchBefore,this.variables.T__=i.matchAfter,this.insertSnippetForSelection(e,i.content),this.variables.M__=this.variables.T__=null),!0)},e.prototype.findMatchingSnippet=function(e,t,i){var n,o;for(n=e.length;n--;)if((!(o=e[n]).startRe||o.startRe.test(t))&&(!o.endRe||o.endRe.test(i))&&(o.startRe||o.endRe))return o.matchBefore=o.startRe?o.startRe.exec(t):[""],o.matchAfter=o.endRe?o.endRe.exec(i):[""],o.replaceBefore=o.triggerRe?o.triggerRe.exec(t)[0]:"",o.replaceAfter=o.endTriggerRe?o.endTriggerRe.exec(i)[0]:"",o},e.prototype.register=function(e,t){function i(e){return e&&!/^\^?\(.*\)\$?$|^\\b$/.test(e)&&(e="(?:"+e+")"),e||""}function n(e,t,n){return e=i(e),t=i(t),n?(e=t+e)&&"$"!=e[e.length-1]&&(e+="$"):(e+=t)&&"^"!=e[0]&&(e="^"+e),new RegExp(e)}function o(e){var i,o;e.scope||(e.scope=t||"_"),t=e.scope,r[t]||(r[t]=[],s[t]={}),i=s[t],e.name&&((o=i[e.name])&&a.unregister(o),i[e.name]=e),r[t].push(e),e.prefix&&(e.tabTrigger=e.prefix),!e.content&&e.body&&(e.content=Array.isArray(e.body)?e.body.join("\n"):e.body),e.tabTrigger&&!e.trigger&&(!e.guard&&/^\w/.test(e.tabTrigger)&&(e.guard="\\b"),e.trigger=d.escapeRegExp(e.tabTrigger)),(e.trigger||e.guard||e.endTrigger||e.endGuard)&&(e.startRe=n(e.trigger,e.guard,!0),e.triggerRe=new RegExp(e.trigger),e.endRe=n(e.endTrigger,e.endGuard,!0),e.endTriggerRe=new RegExp(e.endTrigger))}var r=this.snippetMap,s=this.snippetNameMap,a=this;e||(e=[]),Array.isArray(e)?e.forEach(o):Object.keys(e).forEach((function(t){o(e[t])})),this._signal("registerSnippets",{scope:t})},e.prototype.unregister=function(e,t){function i(e){var i,r,s=o[e.scope||t];s&&s[e.name]&&(delete s[e.name],(r=(i=n[e.scope||t])&&i.indexOf(e))>=0&&i.splice(r,1))}var n=this.snippetMap,o=this.snippetNameMap;e.content?i(e):Array.isArray(e)&&e.forEach(i)},e.prototype.parseSnippetFile=function(e){var t,i,n,o,r,s,a;for(e=e.replace(/\r/g,""),t=[],i={},n=/^#.*|^({[\s\S]*})\s*$|^(\S+) (.*)$|^((?:\n*\t.*)+)/gm;o=n.exec(e);){if(o[1])try{i=JSON.parse(o[1]),t.push(i)}catch(e){}o[4]?(i.content=o[4].replace(/^\t/gm,""),t.push(i),i={}):(r=o[2],s=o[3],"regex"==r?(a=/\/((?:[^\/\\]|\\.)*)|$/g,i.guard=a.exec(s)[1],i.trigger=a.exec(s)[1],i.endTrigger=a.exec(s)[1],i.endGuard=a.exec(s)[1]):"snippet"==r?(i.tabTrigger=s.match(/^\S*/)[0],i.name||(i.name=s)):r&&(i[r]=s))}return t},e.prototype.getSnippetByName=function(e,t){var i,n=this.snippetNameMap;return this.getActiveScopes(t).some((function(t){var o=n[t];return o&&(i=o[e]),!!i}),this),i},e}(),h.implement(o.prototype,u),r=function(e,t,i){function n(e){var t,i,n=[];for(t=0;t<e.length;t++){if("object"==typeof(i=e[t])){if(l[i.tabstopId])continue;i=n[e.lastIndexOf(i,t-1)]||{tabstopId:i.tabstopId}}n[t]=i}return n}var o,r,s,a,p,c,l,h,u,d,f,g,m,b,v,y;for(void 0===i&&(i={}),o=e.getCursorPosition(),r=e.session.getLine(o.row),s=e.session.getTabString(),a=r.match(/^\s*/)[0],o.column<a.length&&(a=a.slice(0,o.column)),t=t.replace(/\r/g,""),p=this.tokenizeTmSnippet(t),p=(p=this.resolveVariables(p,e)).map((function(e){return"\n"!=e||i.excludeExtraIndent?"string"==typeof e?e.replace(/\t/g,s):e:e+a})),c=[],p.forEach((function(e,t){var i,n,o,r;"object"==typeof e&&(i=e.tabstopId,(n=c[i])||((n=c[i]=[]).index=i,n.value="",n.parents={}),-1===n.indexOf(e)&&(e.choices&&!n.choices&&(n.choices=e.choices),n.push(e),-1!==(o=p.indexOf(e,t+1))&&((r=p.slice(t+1,o)).some((function(e){return"object"==typeof e}))&&!n.value?n.value=r:!r.length||n.value&&"string"==typeof n.value||(n.value=r.join("")))))})),c.forEach((function(e){e.length=0})),l={},h=0;h<p.length;h++)"object"==typeof(u=p[h])&&(d=u.tabstopId,f=c[d],g=p.indexOf(u,h+1),l[d]?l[d]===u&&(delete l[d],Object.keys(l).forEach((function(e){f.parents[e]=!0}))):(l[d]=u,"string"!=typeof(m=f.value)?m=n(m):u.fmt&&(m=this.tmStrFormat(m,u,e)),p.splice.apply(p,[h+1,Math.max(0,g-h)].concat(m,u)),-1===f.indexOf(u)&&f.push(u)));return b=0,v=0,y="",p.forEach((function(e){if("string"==typeof e){var t=e.split("\n");t.length>1?(v=t[t.length-1].length,b+=t.length-1):v+=e.length,y+=e}else e&&(e.start?e.end={row:b,column:v}:e.start={row:b,column:v})})),{text:y,tabstops:c,tokens:p}},(s=function(){function e(e){if(this.index=0,this.ranges=[],this.tabstops=[],e.tabstopManager)return e.tabstopManager;e.tabstopManager=this,this.$onChange=this.onChange.bind(this),this.$onChangeSelection=d.delayedCall(this.onChangeSelection.bind(this)).schedule,this.$onChangeSession=this.onChangeSession.bind(this),this.$onAfterExec=this.onAfterExec.bind(this),this.attach(e)}return e.prototype.attach=function(e){this.$openTabstops=null,this.selectedTabstop=null,this.editor=e,this.session=e.session,this.editor.on("change",this.$onChange),this.editor.on("changeSelection",this.$onChangeSelection),this.editor.on("changeSession",this.$onChangeSession),this.editor.commands.on("afterExec",this.$onAfterExec),this.editor.keyBinding.addKeyboardHandler(this.keyboardHandler)},e.prototype.detach=function(){this.tabstops.forEach(this.removeTabstopMarkers,this),this.ranges.length=0,this.tabstops.length=0,this.selectedTabstop=null,this.editor.off("change",this.$onChange),this.editor.off("changeSelection",this.$onChangeSelection),this.editor.off("changeSession",this.$onChangeSession),this.editor.commands.off("afterExec",this.$onAfterExec),this.editor.keyBinding.removeKeyboardHandler(this.keyboardHandler),this.editor.tabstopManager=null,this.session=null,this.editor=null},e.prototype.onChange=function(e){var t,i,n,o,r,s,a,p,c,l="r"==e.action[0],h=this.selectedTabstop||{},u=h.parents||{},d=this.tabstops.slice();for(t=0;t<d.length;t++){if(n=(i=d[t])==h||u[i.index],i.rangeList.$bias=n?0:1,"remove"==e.action&&i!==h)for(o=i.parents&&i.parents[h.index],r=(r=i.rangeList.pointIndex(e.start,o))<0?-r-1:r+1,s=(s=i.rangeList.pointIndex(e.end,o))<0?-s-1:s-1,a=i.rangeList.ranges.slice(r,s),p=0;p<a.length;p++)this.removeRange(a[p]);i.rangeList.$onChange(e)}c=this.session,this.$inChange||!l||1!=c.getLength()||c.getValue()||this.detach()},e.prototype.updateLinkedFields=function(){var e,i,n,o,r,s,a=this.selectedTabstop;if(a&&a.hasLinkedRanges&&a.firstNonLinked){for(this.$inChange=!0,i=(e=this.session).getTextRange(a.firstNonLinked),n=0;n<a.length;n++)(o=a[n]).linked&&(r=o.original,s=t.snippetManager.tmStrFormat(i,r,this.editor),e.replace(o,s));this.$inChange=!1}},e.prototype.onAfterExec=function(e){e.command&&!e.command.readOnly&&this.updateLinkedFields()},e.prototype.onChangeSelection=function(){var e,t,i,n,o,r;if(this.editor){for(e=this.editor.selection.lead,t=this.editor.selection.anchor,i=this.editor.selection.isEmpty(),n=0;n<this.ranges.length;n++)if(!this.ranges[n].linked&&(o=this.ranges[n].contains(e.row,e.column),r=i||this.ranges[n].contains(t.row,t.column),o&&r))return;this.detach()}},e.prototype.onChangeSession=function(){this.detach()},e.prototype.tabNext=function(e){var t=this.tabstops.length,i=this.index+(e||1);(i=Math.min(Math.max(i,1),t))==t&&(i=0),this.selectTabstop(i),this.updateTabstopMarkers(),0===i&&this.detach()},e.prototype.selectTabstop=function(e){var t,i,n,o;if(this.$openTabstops=null,(t=this.tabstops[this.index])&&this.addTabstopMarkers(t),this.index=e,(t=this.tabstops[this.index])&&t.length){if(this.selectedTabstop=t,i=t.firstNonLinked||t,t.choices&&(i.cursor=i.start),this.editor.inVirtualSelectionMode)this.editor.selection.fromOrientedRange(i);else for((n=this.editor.multiSelect).toSingleRange(i),o=0;o<t.length;o++)t.hasLinkedRanges&&t[o].linked||n.addRange(t[o].clone(),!0);this.editor.keyBinding.addKeyboardHandler(this.keyboardHandler),this.selectedTabstop&&this.selectedTabstop.choices&&this.editor.execCommand("startAutocomplete",{matches:this.selectedTabstop.choices})}},e.prototype.addTabstops=function(e,t,i){var n,o,r,s,c,l=this.useLink||!this.editor.getOption("enableMultiselect");this.$openTabstops||(this.$openTabstops=[]),e[0]||(n=f.fromPoints(i,i),p(n.start,t),p(n.end,t),e[0]=[n],e[0].index=0),o=this.index,r=[o+1,0],s=this.ranges,c=this.snippetId=(this.snippetId||0)+1,e.forEach((function(e,i){var n,o,p,h=this.$openTabstops[i]||e;for(h.snippetId=c,n=0;n<e.length;n++)o=e[n],p=f.fromPoints(o.start,o.end||o.start),a(p.start,t),a(p.end,t),p.original=o,p.tabstop=h,s.push(p),h!=e?h.unshift(p):h[n]=p,o.fmtString||h.firstNonLinked&&l?(p.linked=!0,h.hasLinkedRanges=!0):h.firstNonLinked||(h.firstNonLinked=p);h.firstNonLinked||(h.hasLinkedRanges=!1),h===e&&(r.push(h),this.$openTabstops[i]=h),this.addTabstopMarkers(h),h.rangeList=h.rangeList||new g,h.rangeList.$bias=0,h.rangeList.addList(h)}),this),r.length>2&&(this.tabstops.length&&r.push(r.splice(2,1)[0]),this.tabstops.splice.apply(this.tabstops,r))},e.prototype.addTabstopMarkers=function(e){var t=this.session;e.forEach((function(e){e.markerId||(e.markerId=t.addMarker(e,"ace_snippet-marker","text"))}))},e.prototype.removeTabstopMarkers=function(e){var t=this.session;e.forEach((function(e){t.removeMarker(e.markerId),e.markerId=null}))},e.prototype.updateTabstopMarkers=function(){if(this.selectedTabstop){var e=this.selectedTabstop.snippetId;0===this.selectedTabstop.index&&e--,this.tabstops.forEach((function(t){t.snippetId===e?this.addTabstopMarkers(t):this.removeTabstopMarkers(t)}),this)}},e.prototype.removeRange=function(e){var t=e.tabstop.indexOf(e);-1!=t&&e.tabstop.splice(t,1),-1!=(t=this.ranges.indexOf(e))&&this.ranges.splice(t,1),-1!=(t=e.tabstop.rangeList.ranges.indexOf(e))&&e.tabstop.splice(t,1),this.session.removeMarker(e.markerId),e.tabstop.length||(-1!=(t=this.tabstops.indexOf(e.tabstop))&&this.tabstops.splice(t,1),this.tabstops.length||this.detach())},e}()).prototype.keyboardHandler=new m,s.prototype.keyboardHandler.bindKeys({Tab:function(e){t.snippetManager&&t.snippetManager.expandWithTab(e)||(e.tabstopManager.tabNext(1),e.renderer.scrollCursorIntoView())},"Shift-Tab":function(e){e.tabstopManager.tabNext(-1),e.renderer.scrollCursorIntoView()},Esc:function(e){e.tabstopManager.detach()}}),a=function(e,t){0==e.row&&(e.column+=t.column),e.row+=t.row},p=function(e,t){e.row==t.row&&(e.column-=t.column),e.row-=t.row},l.importCssString("\n.ace_snippet-marker {\n    -moz-box-sizing: border-box;\n    box-sizing: border-box;\n    background: rgba(194, 193, 208, 0.09);\n    border: 1px dotted rgba(211, 208, 235, 0.62);\n    position: absolute;\n}","snippets.css",!1),t.snippetManager=new o,c=e("./editor").Editor,function(){this.insertSnippet=function(e,i){return t.snippetManager.insertSnippet(this,e,i)},this.expandSnippet=function(e){return t.snippetManager.expandWithTab(this,e)}}.call(c.prototype)})),ace.define("ace/autocomplete/popup",["require","exports","module","ace/virtual_renderer","ace/editor","ace/range","ace/lib/event","ace/lib/lang","ace/lib/dom","ace/config","ace/lib/useragent"],(function(e,t,i){"use strict";var n=e("../virtual_renderer").VirtualRenderer,o=e("../editor").Editor,r=e("../range").Range,s=e("../lib/event"),a=e("../lib/lang"),p=e("../lib/dom"),c=e("../config").nls,l=e("./../lib/useragent"),h=function(e){return"suggest-aria-id:".concat(e)},u=l.isSafari?"menu":"listbox",d=l.isSafari?"menuitem":"option",f=l.isSafari?"aria-current":"aria-selected",g=function(e){var t,i=new n(e);return i.$maxLines=4,(t=new o(i)).setHighlightActiveLine(!1),t.setShowPrintMargin(!1),t.renderer.setShowGutter(!1),t.renderer.setHighlightGutterLine(!1),t.$mouseHandler.$focusTimeout=0,t.$highlightTagPending=!0,t},m=function(e){var t,i,n,o,l,m,b,v=p.createElement("div"),y=g(v);return e&&e.appendChild(v),v.style.display="none",y.renderer.content.style.cursor="default",y.renderer.setStyle("ace_autocomplete"),y.renderer.$textLayer.element.setAttribute("role",u),y.renderer.$textLayer.element.setAttribute("aria-roledescription",c("autocomplete.popup.aria-roledescription","Autocomplete suggestions")),y.renderer.$textLayer.element.setAttribute("aria-label",c("autocomplete.popup.aria-label","Autocomplete suggestions")),y.renderer.textarea.setAttribute("aria-hidden","true"),y.setOption("displayIndentGuides",!1),y.setOption("dragDelay",150),t=function(){},y.focus=t,y.$isFocused=!0,y.renderer.$cursorLayer.restartTimer=t,y.renderer.$cursorLayer.element.style.opacity="0",y.renderer.$maxLines=8,y.renderer.$keepTextAreaAtCursor=!1,y.setHighlightActiveLine(!1),y.session.highlight(""),y.session.$searchHighlight.clazz="ace_highlight-marker",y.on("mousedown",(function(e){var t=e.getDocumentPosition();y.selection.moveToPosition(t),o.start.row=o.end.row=t.row,e.stop()})),n=new r(-1,0,-1,1/0),(o=new r(-1,0,-1,1/0)).id=y.session.addMarker(o,"ace_active-line","fullLine"),y.setSelectOnHover=function(e){e?n.id&&(y.session.removeMarker(n.id),n.id=null):n.id=y.session.addMarker(n,"ace_line-hover","fullLine")},y.setSelectOnHover(!1),y.on("mousemove",(function(e){if(i){if(i.x!=e.x||i.y!=e.y){(i=e).scrollTop=y.renderer.scrollTop,y.isMouseOver=!0;var t=i.getDocumentPosition().row;n.start.row!=t&&(n.id||y.setRow(t),m(t))}}else i=e})),y.renderer.on("beforeRender",(function(){if(i&&-1!=n.start.row){i.$pos=null;var e=i.getDocumentPosition().row;n.id||y.setRow(e),m(e,!0)}})),y.renderer.on("afterRender",(function(){var e,t=y.getRow(),i=y.renderer.$textLayer,n=i.element.childNodes[t-i.config.firstRow],o=document.activeElement;n!==y.selectedNode&&y.selectedNode&&(p.removeCssClass(y.selectedNode,"ace_selected"),o.removeAttribute("aria-activedescendant"),y.selectedNode.removeAttribute(f),y.selectedNode.removeAttribute("id")),y.selectedNode=n,n&&(p.addCssClass(n,"ace_selected"),e=h(t),n.id=e,i.element.setAttribute("aria-activedescendant",e),o.setAttribute("aria-activedescendant",e),n.setAttribute("role",d),n.setAttribute("aria-roledescription",c("autocomplete.popup.item.aria-roledescription","item")),n.setAttribute("aria-label",y.getData(t).caption||y.getData(t).value),n.setAttribute("aria-setsize",y.data.length),n.setAttribute("aria-posinset",t+1),n.setAttribute("aria-describedby","doc-tooltip"),n.setAttribute(f,"true"))})),l=function(){m(-1)},m=function(e,t){e!==n.start.row&&(n.start.row=n.end.row=e,t||y.session._emit("changeBackMarker"),y._emit("changeHoverMarker"))},y.getHoveredRow=function(){return n.start.row},s.addListener(y.container,"mouseout",(function(){y.isMouseOver=!1,l()})),y.on("hide",l),y.on("changeSelection",l),y.session.doc.getLength=function(){return y.data.length},y.session.doc.getLine=function(e){var t=y.data[e];return"string"==typeof t?t:t&&t.value||""},(b=y.session.bgTokenizer).$tokenizeRow=function(e){function t(e,t){e&&h.push({type:(l.className||"")+(t||""),value:e})}var i,n,o,r,s,a,p,c,l=y.data[e],h=[];if(!l)return h;for("string"==typeof l&&(l={value:l}),n=(i=l.caption||l.value||l.name).toLowerCase(),o=(y.filterText||"").toLowerCase(),r=0,s=0,a=0;a<=o.length;a++)if(a!=s&&(l.matchMask&1<<a||a==o.length)){if(p=o.slice(s,a),s=a,-1==(c=n.indexOf(p,r)))continue;t(i.slice(r,c),""),r=c+p.length,t(i.slice(c,r),"completion-highlight")}return t(i.slice(r,i.length),""),h.push({type:"completion-spacer",value:" "}),l.meta&&h.push({type:"completion-meta",value:l.meta}),l.message&&h.push({type:"completion-message",value:l.message}),h},b.$updateOnChange=t,b.start=t,y.session.$computeWidth=function(){return this.screenWidth=0},y.isOpen=!1,y.isTopdown=!1,y.autoSelect=!0,y.filterText="",y.isMouseOver=!1,y.data=[],y.setData=function(e,t){y.filterText=t||"",y.setValue(a.stringRepeat("\n",e.length),-1),y.data=e||[],y.setRow(0)},y.getData=function(e){return y.data[e]},y.getRow=function(){return o.start.row},y.setRow=function(e){e=Math.max(this.autoSelect?0:-1,Math.min(this.data.length-1,e)),o.start.row!=e&&(y.selection.clearSelection(),o.start.row=o.end.row=e||0,y.session._emit("changeBackMarker"),y.moveCursorTo(e||0,0),y.isOpen&&y._signal("select"))},y.on("changeSelection",(function(){y.isOpen&&y.setRow(y.selection.lead.row),y.renderer.scrollCursorIntoView()})),y.hide=function(){this.container.style.display="none",y.anchorPos=null,y.anchor=null,y.isOpen&&(y.isOpen=!1,this._signal("hide"))},y.tryShow=function(e,t,n,o){var r,s,a,p,c,l,h,u,d,f;return!((o||!y.isOpen||!y.anchorPos||!y.anchor||y.anchorPos.top!==e.top||y.anchorPos.left!==e.left||y.anchor!==n)&&(r=this.container,s=window.innerHeight,a=window.innerWidth,c=(p=this.renderer).$maxLines*t*1.4,l={top:0,bottom:0,left:0},h=s-e.top-3*this.$borderSize-t,u=e.top-3*this.$borderSize,n||(n=u<=h||h>=c?"bottom":"top"),"top"===n?(l.bottom=e.top-this.$borderSize,l.top=l.bottom-c):"bottom"===n&&(l.top=e.top+t+this.$borderSize,l.bottom=l.top+c),d=l.top>=0&&l.bottom<=s,!o&&!d||(p.$maxPixelHeight=d?null:"top"===n?u:h,"top"===n?(r.style.top="",r.style.bottom=s-l.bottom+"px",y.isTopdown=!1):(r.style.top=l.top+"px",r.style.bottom="",y.isTopdown=!0),r.style.display="",(f=e.left)+r.offsetWidth>a&&(f=a-r.offsetWidth),r.style.left=f+"px",r.style.right="",y.isOpen||(y.isOpen=!0,this._signal("show"),i=null),y.anchorPos=e,y.anchor=n,0)))},y.show=function(e,t,i){this.tryShow(e,t,i?"bottom":void 0,!0)},y.goTo=function(e){var t=this.getRow(),i=this.session.getLength()-1;switch(e){case"up":t=t<=0?i:t-1;break;case"down":t=t>=i?-1:t+1;break;case"start":t=0;break;case"end":t=i}this.setRow(t)},y.getTextLeftOffset=function(){return this.$borderSize+this.renderer.$padding+this.$imageSize},y.$imageSize=0,y.$borderSize=1,y};p.importCssString('\n.ace_editor.ace_autocomplete .ace_marker-layer .ace_active-line {\n    background-color: #CAD6FA;\n    z-index: 1;\n}\n.ace_dark.ace_editor.ace_autocomplete .ace_marker-layer .ace_active-line {\n    background-color: #3a674e;\n}\n.ace_editor.ace_autocomplete .ace_line-hover {\n    border: 1px solid #abbffe;\n    margin-top: -1px;\n    background: rgba(233,233,253,0.4);\n    position: absolute;\n    z-index: 2;\n}\n.ace_dark.ace_editor.ace_autocomplete .ace_line-hover {\n    border: 1px solid rgba(109, 150, 13, 0.8);\n    background: rgba(58, 103, 78, 0.62);\n}\n.ace_completion-meta {\n    opacity: 0.5;\n    margin-left: 0.9em;\n}\n.ace_completion-message {\n    margin-left: 0.9em;\n    color: blue;\n}\n.ace_editor.ace_autocomplete .ace_completion-highlight{\n    color: #2d69c7;\n}\n.ace_dark.ace_editor.ace_autocomplete .ace_completion-highlight{\n    color: #93ca12;\n}\n.ace_editor.ace_autocomplete {\n    width: 300px;\n    z-index: 200000;\n    border: 1px lightgray solid;\n    position: fixed;\n    box-shadow: 2px 3px 5px rgba(0,0,0,.2);\n    line-height: 1.4;\n    background: #fefefe;\n    color: #111;\n}\n.ace_dark.ace_editor.ace_autocomplete {\n    border: 1px #484747 solid;\n    box-shadow: 2px 3px 5px rgba(0, 0, 0, 0.51);\n    line-height: 1.4;\n    background: #25282c;\n    color: #c1c1c1;\n}\n.ace_autocomplete .ace_text-layer  {\n    width: calc(100% - 8px);\n}\n.ace_autocomplete .ace_line {\n    display: flex;\n    align-items: center;\n}\n.ace_autocomplete .ace_line > * {\n    min-width: 0;\n    flex: 0 0 auto;\n}\n.ace_autocomplete .ace_line .ace_ {\n    flex: 0 1 auto;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n.ace_autocomplete .ace_completion-spacer {\n    flex: 1;\n}\n.ace_autocomplete.ace_loading:after  {\n    content: "";\n    position: absolute;\n    top: 0px;\n    height: 2px;\n    width: 8%;\n    background: blue;\n    z-index: 100;\n    animation: ace_progress 3s infinite linear;\n    animation-delay: 300ms;\n    transform: translateX(-100%) scaleX(1);\n}\n@keyframes ace_progress {\n    0% { transform: translateX(-100%) scaleX(1) }\n    50% { transform: translateX(625%) scaleX(2) } \n    100% { transform: translateX(1500%) scaleX(3) } \n}\n@media (prefers-reduced-motion) {\n    .ace_autocomplete.ace_loading:after {\n        transform: translateX(625%) scaleX(2);\n        animation: none;\n     }\n}\n',"autocompletion.css",!1),t.AcePopup=m,t.$singleLineEditor=g,t.getAriaId=h})),ace.define("ace/autocomplete/inline_screenreader",["require","exports","module"],(function(e,t,i){"use strict";var n=function(){function e(e){this.editor=e,this.screenReaderDiv=document.createElement("div"),this.screenReaderDiv.classList.add("ace_screenreader-only"),this.editor.container.appendChild(this.screenReaderDiv)}return e.prototype.setScreenReaderContent=function(e){for(!this.popup&&this.editor.completer&&this.editor.completer.popup&&(this.popup=this.editor.completer.popup,this.popup.renderer.on("afterRender",function(){var e,t,i=this.popup.getRow(),n=this.popup.renderer.$textLayer,o=n.element.childNodes[i-n.config.firstRow];if(o){for(e="doc-tooltip ",t=0;t<this._lines.length;t++)e+="ace-inline-screenreader-line-".concat(t," ");o.setAttribute("aria-describedby",e)}}.bind(this)));this.screenReaderDiv.firstChild;)this.screenReaderDiv.removeChild(this.screenReaderDiv.firstChild);this._lines=e.split(/\r\n|\r|\n/);var t=this.createCodeBlock();this.screenReaderDiv.appendChild(t)},e.prototype.destroy=function(){this.screenReaderDiv.remove()},e.prototype.createCodeBlock=function(){var e,t,i,n=document.createElement("pre");for(n.setAttribute("id","ace-inline-screenreader"),e=0;e<this._lines.length;e++)(t=document.createElement("code")).setAttribute("id","ace-inline-screenreader-line-".concat(e)),i=document.createTextNode(this._lines[e]),t.appendChild(i),n.appendChild(t);return n},e}();t.AceInlineScreenReader=n})),ace.define("ace/autocomplete/inline",["require","exports","module","ace/snippets","ace/autocomplete/inline_screenreader"],(function(e,t,i){"use strict";var n=e("../snippets").snippetManager,o=e("./inline_screenreader").AceInlineScreenReader,r=function(){function e(){this.editor=null}return e.prototype.show=function(e,t,i){if(i=i||"",e&&this.editor&&this.editor!==e&&(this.hide(),this.editor=null,this.inlineScreenReader=null),!e||!t)return!1;this.inlineScreenReader||(this.inlineScreenReader=new o(e));var r=t.snippet?n.getDisplayTextForSnippet(e,t.snippet):t.value;return!(t.hideInlinePreview||!r||!r.startsWith(i))&&(this.editor=e,this.inlineScreenReader.setScreenReaderContent(r),""===(r=r.slice(i.length))?e.removeGhostText():e.setGhostText(r),!0)},e.prototype.isOpen=function(){return!!this.editor&&!!this.editor.renderer.$ghostText},e.prototype.hide=function(){return!!this.editor&&(this.editor.removeGhostText(),!0)},e.prototype.destroy=function(){this.hide(),this.editor=null,this.inlineScreenReader&&(this.inlineScreenReader.destroy(),this.inlineScreenReader=null)},e}();t.AceInline=r})),ace.define("ace/autocomplete/util",["require","exports","module"],(function(e,t,i){"use strict";t.parForEach=function(e,t,i){var n,o=0,r=e.length;for(0===r&&i(),n=0;n<r;n++)t(e[n],(function(e,t){++o===r&&i(e,t)}))};var n=/[a-zA-Z_0-9\$\-\u00A2-\u2000\u2070-\uFFFF]/;t.retrievePrecedingIdentifier=function(e,t,i){var o,r;for(i=i||n,o=[],r=t-1;r>=0&&i.test(e[r]);r--)o.push(e[r]);return o.reverse().join("")},t.retrieveFollowingIdentifier=function(e,t,i){var o,r;for(i=i||n,o=[],r=t;r<e.length&&i.test(e[r]);r++)o.push(e[r]);return o},t.getCompletionPrefix=function(e){var t,i=e.getCursorPosition(),n=e.session.getLine(i.row);return e.completers.forEach(function(e){e.identifierRegexps&&e.identifierRegexps.forEach(function(e){!t&&e&&(t=this.retrievePrecedingIdentifier(n,i.column,e))}.bind(this))}.bind(this)),t||this.retrievePrecedingIdentifier(n,i.column)},t.triggerAutocomplete=function(e,t){t=null==t?e.session.getPrecedingCharacter():t;return e.completers.some((function(e){if(e.triggerCharacters&&Array.isArray(e.triggerCharacters))return e.triggerCharacters.includes(t)}))}})),ace.define("ace/autocomplete",["require","exports","module","ace/keyboard/hash_handler","ace/autocomplete/popup","ace/autocomplete/inline","ace/autocomplete/popup","ace/autocomplete/util","ace/lib/lang","ace/lib/dom","ace/snippets","ace/config","ace/lib/event","ace/lib/scroll"],(function(e,t,i){"use strict";var n,o,r=e("./keyboard/hash_handler").HashHandler,s=e("./autocomplete/popup").AcePopup,a=e("./autocomplete/inline").AceInline,p=e("./autocomplete/popup").getAriaId,c=e("./autocomplete/util"),l=e("./lib/lang"),h=e("./lib/dom"),u=e("./snippets").snippetManager,d=e("./config"),f=e("./lib/event"),g=e("./lib/scroll").preventParentScroll,m=function(e,t){t.completer&&t.completer.destroy()},b=function(){function e(){this.autoInsert=!1,this.autoSelect=!0,this.autoShown=!1,this.exactMatch=!1,this.inlineEnabled=!1,this.keyboardHandler=new r,this.keyboardHandler.bindKeys(this.commands),this.parentNode=null,this.setSelectOnHover=!1,this.hasSeen=new Set,this.showLoadingState=!1,this.stickySelectionDelay=500,this.blurListener=this.blurListener.bind(this),this.changeListener=this.changeListener.bind(this),this.mousedownListener=this.mousedownListener.bind(this),this.mousewheelListener=this.mousewheelListener.bind(this),this.onLayoutChange=this.onLayoutChange.bind(this),this.changeTimer=l.delayedCall(function(){this.updateCompletions(!0)}.bind(this)),this.tooltipTimer=l.delayedCall(this.updateDocTooltip.bind(this),50),this.popupTimer=l.delayedCall(this.$updatePopupPosition.bind(this),50),this.stickySelectionTimer=l.delayedCall(function(){this.stickySelection=!0}.bind(this),this.stickySelectionDelay),this.$firstOpenTimer=l.delayedCall(function(){var t=this.completionProvider&&this.completionProvider.initialPosition;this.autoShown||this.popup&&this.popup.isOpen||!t||0===this.editor.completers.length||(this.completions=new o(e.completionsForLoading),this.openPopup(this.editor,t.prefix,!1),this.popup.renderer.setStyle("ace_loading",!0))}.bind(this),this.stickySelectionDelay)}return Object.defineProperty(e,"completionsForLoading",{get:function(){return[{caption:d.nls("autocomplete.loading","Loading..."),value:""}]},enumerable:!1,configurable:!0}),e.prototype.$init=function(){return this.popup=new s(this.parentNode||document.body||document.documentElement),this.popup.on("click",function(e){this.insertMatch(),e.stop()}.bind(this)),this.popup.focus=this.editor.focus.bind(this.editor),this.popup.on("show",this.$onPopupShow.bind(this)),this.popup.on("hide",this.$onHidePopup.bind(this)),this.popup.on("select",this.$onPopupChange.bind(this)),f.addListener(this.popup.container,"mouseout",this.mouseOutListener.bind(this)),this.popup.on("changeHoverMarker",this.tooltipTimer.bind(null,null)),this.popup.renderer.on("afterRender",this.$onPopupRender.bind(this)),this.popup},e.prototype.$initInline=function(){if(this.inlineEnabled&&!this.inlineRenderer)return this.inlineRenderer=new a,this.inlineRenderer},e.prototype.getPopup=function(){return this.popup||this.$init()},e.prototype.$onHidePopup=function(){this.inlineRenderer&&this.inlineRenderer.hide(),this.hideDocTooltip(),this.stickySelectionTimer.cancel(),this.popupTimer.cancel(),this.stickySelection=!1},e.prototype.$seen=function(e){!this.hasSeen.has(e)&&e&&e.completer&&e.completer.onSeen&&"function"==typeof e.completer.onSeen&&(e.completer.onSeen(this.editor,e),this.hasSeen.add(e))},e.prototype.$onPopupChange=function(e){if(this.inlineRenderer&&this.inlineEnabled){var t=e?null:this.popup.getData(this.popup.getRow());if(this.$updateGhostText(t),this.popup.isMouseOver&&this.setSelectOnHover)return void this.tooltipTimer.call(null,null);this.popupTimer.schedule(),this.tooltipTimer.schedule()}else this.popupTimer.call(null,null),this.tooltipTimer.call(null,null)},e.prototype.$updateGhostText=function(e){var t=this.base.row,i=this.base.column,n=this.editor.getCursorPosition().column,o=this.editor.session.getLine(t).slice(i,n);this.inlineRenderer.show(this.editor,e,o)?this.$seen(e):this.inlineRenderer.hide()},e.prototype.$onPopupRender=function(){var e,t,i=this.inlineRenderer&&this.inlineEnabled;if(this.completions&&this.completions.filtered&&this.completions.filtered.length>0)for(e=this.popup.getFirstVisibleRow();e<=this.popup.getLastVisibleRow();e++)!(t=this.popup.getData(e))||i&&!t.hideInlinePreview||this.$seen(t)},e.prototype.$onPopupShow=function(e){this.$onPopupChange(e),this.stickySelection=!1,this.stickySelectionDelay>=0&&this.stickySelectionTimer.schedule(this.stickySelectionDelay)},e.prototype.observeLayoutChanges=function(){var e,t;if(!this.$elements&&this.editor){for(window.addEventListener("resize",this.onLayoutChange,{passive:!0}),window.addEventListener("wheel",this.mousewheelListener),e=this.editor.container.parentNode,t=[];e;)t.push(e),e.addEventListener("scroll",this.onLayoutChange,{passive:!0}),e=e.parentNode;this.$elements=t}},e.prototype.unObserveLayoutChanges=function(){var e=this;window.removeEventListener("resize",this.onLayoutChange,{passive:!0}),window.removeEventListener("wheel",this.mousewheelListener),this.$elements&&this.$elements.forEach((function(t){t.removeEventListener("scroll",e.onLayoutChange,{passive:!0})})),this.$elements=null},e.prototype.onLayoutChange=function(){if(!this.popup.isOpen)return this.unObserveLayoutChanges();this.$updatePopupPosition(),this.updateDocTooltip()},e.prototype.$updatePopupPosition=function(){var e,t,i,n,o=this.editor,r=o.renderer,s=r.layerConfig.lineHeight,a=r.$cursorLayer.getPixelPosition(this.base,!0);a.left-=this.popup.getTextLeftOffset(),e=o.container.getBoundingClientRect(),a.top+=e.top-r.layerConfig.offset,a.left+=e.left-o.renderer.scrollLeft,a.left+=r.gutterWidth,t={top:a.top,left:a.left},r.$ghostText&&r.$ghostTextWidget&&this.base.row===r.$ghostText.position.row&&(t.top+=r.$ghostTextWidget.el.offsetHeight),n=(i=o.container.getBoundingClientRect().bottom-s)<t.top?{top:i,left:t.left}:t,this.popup.tryShow(n,s,"bottom")||this.popup.tryShow(a,s,"top")||this.popup.show(a,s)},e.prototype.openPopup=function(e,t,i){var n,o,r,s,a;this.$firstOpenTimer.cancel(),this.popup||this.$init(),this.inlineEnabled&&!this.inlineRenderer&&this.$initInline(),this.popup.autoSelect=this.autoSelect,this.popup.setSelectOnHover(this.setSelectOnHover),n=this.popup.getRow(),o=this.popup.data[n],this.popup.setData(this.completions.filtered,this.completions.filterText),this.editor.textInput.setAriaOptions&&this.editor.textInput.setAriaOptions({activeDescendant:p(this.popup.getRow()),inline:this.inlineEnabled}),e.keyBinding.addKeyboardHandler(this.keyboardHandler),this.stickySelection&&(r=this.popup.data.indexOf(o)),r&&-1!==r||(r=0),this.popup.setRow(this.autoSelect?r:-1),r===n&&o!==this.completions.filtered[r]&&this.$onPopupChange(),s=this.inlineRenderer&&this.inlineEnabled,r===n&&s&&(a=this.popup.getData(this.popup.getRow()),this.$updateGhostText(a)),i||(this.popup.setTheme(e.getTheme()),this.popup.setFontSize(e.getFontSize()),this.$updatePopupPosition(),this.tooltipNode&&this.updateDocTooltip()),this.changeTimer.cancel(),this.observeLayoutChanges()},e.prototype.detach=function(){this.editor&&(this.editor.keyBinding.removeKeyboardHandler(this.keyboardHandler),this.editor.off("changeSelection",this.changeListener),this.editor.off("blur",this.blurListener),this.editor.off("mousedown",this.mousedownListener),this.editor.off("mousewheel",this.mousewheelListener)),this.$firstOpenTimer.cancel(),this.changeTimer.cancel(),this.hideDocTooltip(),this.completionProvider&&this.completionProvider.detach(),this.popup&&this.popup.isOpen&&this.popup.hide(),this.popup&&this.popup.renderer&&this.popup.renderer.off("afterRender",this.$onPopupRender),this.base&&this.base.detach(),this.activated=!1,this.completionProvider=this.completions=this.base=null,this.unObserveLayoutChanges()},e.prototype.changeListener=function(e){var t=this.editor.selection.lead;(t.row!=this.base.row||t.column<this.base.column)&&this.detach(),this.activated?this.changeTimer.schedule():this.detach()},e.prototype.blurListener=function(e){var t=document.activeElement,i=this.editor.textInput.getElement(),n=e.relatedTarget&&this.tooltipNode&&this.tooltipNode.contains(e.relatedTarget),o=this.popup&&this.popup.container;t==i||t.parentNode==o||n||t==this.tooltipNode||e.relatedTarget==i||this.detach()},e.prototype.mousedownListener=function(e){this.detach()},e.prototype.mousewheelListener=function(e){this.popup&&!this.popup.isMouseOver&&this.detach()},e.prototype.mouseOutListener=function(e){this.popup.isOpen&&this.$updatePopupPosition()},e.prototype.goTo=function(e){this.popup.goTo(e)},e.prototype.insertMatch=function(e,t){var i,n;return e||(e=this.popup.getData(this.popup.getRow())),!!e&&(""===e.value?this.detach():(i=this.completions,n=this.getCompletionProvider().insertMatch(this.editor,e,i.filterText,t),this.completions==i&&this.detach(),n))},e.prototype.showPopup=function(e,t){this.editor&&this.detach(),this.activated=!0,this.editor=e,e.completer!=this&&(e.completer&&e.completer.detach(),e.completer=this),e.on("changeSelection",this.changeListener),e.on("blur",this.blurListener),e.on("mousedown",this.mousedownListener),e.on("mousewheel",this.mousewheelListener),this.updateCompletions(!1,t)},e.prototype.getCompletionProvider=function(e){return this.completionProvider||(this.completionProvider=new n(e)),this.completionProvider},e.prototype.gatherCompletions=function(e,t){return this.getCompletionProvider().gatherCompletions(e,t)},e.prototype.updateCompletions=function(t,i){var n,r,s,a;if(t&&this.base&&this.completions){if(n=this.editor.getCursorPosition(),(r=this.editor.session.getTextRange({start:this.base,end:n}))==this.completions.filterText)return;return this.completions.setFilter(r),this.completions.filtered.length?1!=this.completions.filtered.length||this.completions.filtered[0].value!=r||this.completions.filtered[0].snippet?void this.openPopup(this.editor,r,t):this.detach():this.detach()}if(i&&i.matches)return n=this.editor.getSelectionRange().start,this.base=this.editor.session.doc.createAnchor(n.row,n.column),this.base.$insertRight=!0,this.completions=new o(i.matches),this.getCompletionProvider().completions=this.completions,this.openPopup(this.editor,"",t);s=this.editor.getSession(),n=this.editor.getCursorPosition(),r=c.getCompletionPrefix(this.editor),this.base=s.doc.createAnchor(n.row,n.column-r.length),this.base.$insertRight=!0,a={exactMatch:this.exactMatch,ignoreCaption:this.ignoreCaption},this.getCompletionProvider({prefix:r,pos:n}).provideCompletions(this.editor,a,function(i,n,r){var s,a,p=n.filtered,l=c.getCompletionPrefix(this.editor);if(this.$firstOpenTimer.cancel(),r){if(!p.length)return"function"==typeof(s=!this.autoShown&&this.emptyMessage)&&(s=this.emptyMessage(l)),s?(a=[{caption:s,value:""}],this.completions=new o(a),this.openPopup(this.editor,l,t),this.popup.renderer.setStyle("ace_loading",!1),void this.popup.renderer.setStyle("ace_empty-message",!0)):this.detach();if(1==p.length&&p[0].value==l&&!p[0].snippet)return this.detach();if(this.autoInsert&&!this.autoShown&&1==p.length)return this.insertMatch(p[0])}this.completions=!r&&this.showLoadingState?new o(e.completionsForLoading.concat(p),n.filterText):n,this.openPopup(this.editor,l,t),this.popup.renderer.setStyle("ace_empty-message",!1),this.popup.renderer.setStyle("ace_loading",!r)}.bind(this)),!this.showLoadingState||this.autoShown||this.popup&&this.popup.isOpen||this.$firstOpenTimer.delay(this.stickySelectionDelay/2)},e.prototype.cancelContextMenu=function(){this.editor.$mouseHandler.cancelContextMenu()},e.prototype.updateDocTooltip=function(){var e,t,i,n=this.popup,o=this.completions.filtered,r=o&&(o[n.getHoveredRow()]||o[n.getRow()]),s=null;if(!r||!this.editor||!this.popup.isOpen)return this.hideDocTooltip();for(e=this.editor.completers.length,t=0;t<e;t++)if((i=this.editor.completers[t]).getDocTooltip&&r.completerId===i.id){s=i.getDocTooltip(r);break}if(s||"string"==typeof r||(s=r),"string"==typeof s&&(s={docText:s}),!s||!s.docHTML&&!s.docText)return this.hideDocTooltip();this.showDocTooltip(s)},e.prototype.showDocTooltip=function(e){var t,i,n,o;this.tooltipNode||(this.tooltipNode=h.createElement("div"),this.tooltipNode.style.margin="0",this.tooltipNode.style.pointerEvents="auto",this.tooltipNode.style.overscrollBehavior="contain",this.tooltipNode.tabIndex=-1,this.tooltipNode.onblur=this.blurListener.bind(this),this.tooltipNode.onclick=this.onTooltipClick.bind(this),this.tooltipNode.id="doc-tooltip",this.tooltipNode.setAttribute("role","tooltip"),this.tooltipNode.addEventListener("wheel",g)),t=this.editor.renderer.theme,this.tooltipNode.className="ace_tooltip ace_doc-tooltip "+(t.isDark?"ace_dark ":"")+(t.cssClass||""),i=this.tooltipNode,e.docHTML?i.innerHTML=e.docHTML:e.docText&&(i.textContent=e.docText),i.parentNode||this.popup.container.appendChild(this.tooltipNode),o=(n=this.popup).container.getBoundingClientRect(),i.style.top=n.container.style.top,i.style.bottom=n.container.style.bottom,i.style.display="block",window.innerWidth-o.right<320?o.left<320?n.isTopdown?(i.style.top=o.bottom+"px",i.style.left=o.left+"px",i.style.right="",i.style.bottom=""):(i.style.top=n.container.offsetTop-i.offsetHeight+"px",i.style.left=o.left+"px",i.style.right="",i.style.bottom=""):(i.style.right=window.innerWidth-o.left+"px",i.style.left=""):(i.style.left=o.right+1+"px",i.style.right="")},e.prototype.hideDocTooltip=function(){if(this.tooltipTimer.cancel(),this.tooltipNode){var e=this.tooltipNode;this.editor.isFocused()||document.activeElement!=e||this.editor.focus(),this.tooltipNode=null,e.parentNode&&e.parentNode.removeChild(e)}},e.prototype.onTooltipClick=function(e){for(var t=e.target;t&&t!=this.tooltipNode;){if("A"==t.nodeName&&t.href){t.rel="noreferrer",t.target="_blank";break}t=t.parentNode}},e.prototype.destroy=function(){if(this.detach(),this.popup){this.popup.destroy();var e=this.popup.container;e&&e.parentNode&&e.parentNode.removeChild(e)}this.editor&&this.editor.completer==this&&(this.editor.off("destroy",m),this.editor.completer=null),this.inlineRenderer=this.popup=this.editor=null},e}();b.prototype.commands={Up:function(e){e.completer.goTo("up")},Down:function(e){e.completer.goTo("down")},"Ctrl-Up|Ctrl-Home":function(e){e.completer.goTo("start")},"Ctrl-Down|Ctrl-End":function(e){e.completer.goTo("end")},Esc:function(e){e.completer.detach()},Return:function(e){return e.completer.insertMatch()},"Shift-Return":function(e){e.completer.insertMatch(null,{deleteSuffix:!0})},Tab:function(e){var t=e.completer.insertMatch();if(t||e.tabstopManager)return t;e.completer.goTo("down")},Backspace:function(e){e.execCommand("backspace"),!c.getCompletionPrefix(e)&&e.completer&&e.completer.detach()},PageUp:function(e){e.completer.popup.gotoPageUp()},PageDown:function(e){e.completer.popup.gotoPageDown()}},b.for=function(e){return e.completer instanceof b||(e.completer&&(e.completer.destroy(),e.completer=null),d.get("sharedPopups")?(b.$sharedInstance||(b.$sharedInstance=new b),e.completer=b.$sharedInstance):(e.completer=new b,e.once("destroy",m))),e.completer},b.startCommand={name:"startAutocomplete",exec:function(e,t){var i=b.for(e);i.autoInsert=!1,i.autoSelect=!0,i.autoShown=!1,i.showPopup(e,t),i.cancelContextMenu()},bindKey:"Ctrl-Space|Ctrl-Shift-Space|Alt-Space"},n=function(){function e(e){this.initialPosition=e,this.active=!0}return e.prototype.insertByIndex=function(e,t,i){return!(!this.completions||!this.completions.filtered)&&this.insertMatch(e,this.completions.filtered[t],i)},e.prototype.insertMatch=function(e,t,i){var n,o,r,s,a;if(!t)return!1;if(e.startOperation({command:{name:"insertMatch"}}),t.completer&&t.completer.insertMatch)t.completer.insertMatch(e,t);else{if(!this.completions)return!1;if(n=this.completions.filterText.length,o=0,t.range&&t.range.start.row===t.range.end.row&&(n-=this.initialPosition.prefix.length,n+=this.initialPosition.pos.column-t.range.start.column,o+=t.range.end.column-this.initialPosition.pos.column),n||o)for(r=e.selection.getAllRanges?e.selection.getAllRanges():[e.getSelectionRange()],s=0;a=r[s];s++)a.start.column-=n,a.end.column+=o,e.session.remove(a);t.snippet?u.insertSnippet(e,t.snippet):this.$insertString(e,t),t.completer&&t.completer.onInsert&&"function"==typeof t.completer.onInsert&&t.completer.onInsert(e,t),t.command&&"startAutocomplete"===t.command&&e.execCommand(t.command)}return e.endOperation(),!0},e.prototype.$insertString=function(e,t){var i=t.value||t;e.execCommand("insertstring",i)},e.prototype.gatherCompletions=function(e,t){var i,n=e.getSession(),o=e.getCursorPosition(),r=c.getCompletionPrefix(e),s=[];return this.completers=e.completers,i=e.completers.length,e.completers.forEach((function(a,p){a.getCompletions(e,n,o,r,(function(n,o){a.hideInlinePreview&&(o=o.map((function(e){return Object.assign(e,{hideInlinePreview:a.hideInlinePreview})}))),!n&&o&&(s=s.concat(o)),t(null,{prefix:c.getCompletionPrefix(e),matches:s,finished:0==--i})}))})),!0},e.prototype.provideCompletions=function(e,t,i){var n,r=function(e){var n=e.prefix,r=e.matches;this.completions=new o(r),t.exactMatch&&(this.completions.exactMatch=!0),t.ignoreCaption&&(this.completions.ignoreCaption=!0),this.completions.setFilter(n),(e.finished||this.completions.filtered.length)&&i(null,this.completions,e.finished)}.bind(this),s=!0,a=null;this.gatherCompletions(e,function(e,t){this.active&&(e&&(i(e,[],!0),this.detach()),0===t.prefix.indexOf(t.prefix)&&(s?a=t:r(t)))}.bind(this)),s=!1,a&&(n=a,a=null,r(n))},e.prototype.detach=function(){this.active=!1,this.completers&&this.completers.forEach((function(e){"function"==typeof e.cancel&&e.cancel()}))},e}(),o=function(){function e(e,t){this.all=e,this.filtered=e,this.filterText=t||"",this.exactMatch=!1,this.ignoreCaption=!1}return e.prototype.setFilter=function(e){var t,i;t=e.length>this.filterText&&0===e.lastIndexOf(this.filterText,0)?this.filtered:this.all,this.filterText=e,t=(t=this.filterCompletions(t,this.filterText)).sort((function(e,t){return t.exactMatch-e.exactMatch||t.$score-e.$score||(e.caption||e.value).localeCompare(t.caption||t.value)})),i=null,t=t.filter((function(e){var t=e.snippet||e.caption||e.value;return t!==i&&(i=t,!0)})),this.filtered=t},e.prototype.filterCompletions=function(e,t){var i,n,o,r,s,a,p,c,l,h,u,d,f=[],g=t.toUpperCase(),m=t.toLowerCase();e:for(i=0;n=e[i];i++)if(o=!this.ignoreCaption&&n.caption||n.value||n.snippet){if(r=-1,s=0,a=0,this.exactMatch){if(t!==o.substr(0,t.length))continue e}else if((l=o.toLowerCase().indexOf(m))>-1)a=l;else for(h=0;h<t.length;h++){if(u=o.indexOf(m[h],r+1),d=o.indexOf(g[h],r+1),(p=u>=0&&(d<0||u<d)?u:d)<0)continue e;(c=p-r-1)>0&&(-1===r&&(a+=10),a+=c,s|=1<<h),r=p}n.matchMask=s,n.exactMatch=a?0:1,n.$score=(n.score||0)-a,f.push(n)}return f},e}(),t.Autocomplete=b,t.CompletionProvider=n,t.FilteredList=o})),ace.define("ace/autocomplete/text_completer",["require","exports","module","ace/range"],(function(e,t,i){function n(e,t){var i=function(e,t){return e.getTextRange(o.fromPoints({row:0,column:0},t)).split(r).length-1}(e,t),n=e.getValue().split(r),s=Object.create(null),a=n[i];return n.forEach((function(e,t){var o,r;e&&e!==a&&(o=Math.abs(i-t),r=n.length-o,s[e]?s[e]=Math.max(r,s[e]):s[e]=r)})),s}var o=e("../range").Range,r=/[^a-zA-Z_0-9\$\-\u00C0-\u1FFF\u2C00-\uD7FF\w]+/;t.getCompletions=function(e,t,i,o,r){var s=n(t,i),a=Object.keys(s);r(null,a.map((function(e){return{caption:e,value:e,score:s[e],meta:"local"}})))}})),ace.define("ace/ext/language_tools",["require","exports","module","ace/snippets","ace/autocomplete","ace/config","ace/lib/lang","ace/autocomplete/util","ace/autocomplete/text_completer","ace/editor","ace/config"],(function(e,t,i){"use strict";var n,o,r,s,a,p,c,l,h,u=e("../snippets").snippetManager,d=e("../autocomplete").Autocomplete,f=e("../config"),g=e("../lib/lang"),m=e("../autocomplete/util"),b=e("../autocomplete/text_completer"),v={getCompletions:function(e,t,i,n,o){var r;if(t.$mode.completer)return t.$mode.completer.getCompletions(e,t,i,n,o);r=e.session.getState(i.row),o(null,t.$mode.getCompletions(r,t,i,n).map((function(e){return e.completerId=v.id,e})))},id:"keywordCompleter"},y=function(e){var t={};return e.replace(/\${(\d+)(:(.*?))?}/g,(function(e,i,n,o){return t[i]=o||""})).replace(/\$(\d+?)/g,(function(e,i){return t[i]}))},x={getCompletions:function(e,t,i,n,o){var r,s,a=[],p=t.getTokenAt(i.row,i.column);p&&p.type.match(/(tag-name|tag-open|tag-whitespace|attribute-name|attribute-value)\.xml$/)?a.push("html-tag"):a=u.getActiveScopes(e),r=u.snippetMap,s=[],a.forEach((function(e){var t,i,n,o=r[e]||[];for(t=o.length;t--;)(n=(i=o[t]).name||i.tabTrigger)&&s.push({caption:n,snippet:i.content,meta:i.tabTrigger&&!i.name?i.tabTrigger+" ":"snippet",completerId:x.id})}),this),o(null,s)},getDocTooltip:function(e){e.snippet&&!e.docHTML&&(e.docHTML=["<b>",g.escapeHTML(e.caption),"</b>","<hr></hr>",g.escapeHTML(y(e.snippet))].join(""))},id:"snippetCompleter"},T=[x,b,v];t.setCompleters=function(e){T.length=0,e&&T.push.apply(T,e)},t.addCompleter=function(e){T.push(e)},t.textCompleter=b,t.keyWordCompleter=v,t.snippetCompleter=x,n={name:"expandSnippet",exec:function(e){return u.expandWithTab(e)},bindKey:"Tab"},o=function(e,t){r(t.session.$mode)},r=function(e){"string"==typeof e&&(e=f.$modes[e]),e&&(u.files||(u.files={}),s(e.$id,e.snippetFileId),e.modes&&e.modes.forEach(r))},s=function(e,t){t&&e&&!u.files[e]&&(u.files[e]={},f.loadModule(t,(function(t){t&&(u.files[e]=t,!t.snippets&&t.snippetText&&(t.snippets=u.parseSnippetFile(t.snippetText)),u.register(t.snippets||[],t.scope),t.includeScopes&&(u.snippetMap[t.scope].includeScopes=t.includeScopes,t.includeScopes.forEach((function(e){r("ace/mode/"+e)}))))})))},a=function(e){var t,i=e.editor,n=i.completer&&i.completer.activated;"backspace"===e.command.name?n&&!m.getCompletionPrefix(i)&&i.completer.detach():"insertstring"!==e.command.name||n||(p=e,(t=e.editor.$liveAutocompletionDelay)?c.delay(t):l(e))},c=g.delayedCall((function(){l(p)}),0),l=function(e){var t,i=e.editor,n=m.getCompletionPrefix(i),o=e.args,r=m.triggerAutocomplete(i,o);(n&&n.length>=i.$liveAutocompletionThreshold||r)&&((t=d.for(i)).autoShown=!0,t.showPopup(i))},h=e("../editor").Editor,e("../config").defineOptions(h.prototype,"editor",{enableBasicAutocompletion:{set:function(e){e?(this.completers||(this.completers=Array.isArray(e)?e:T),this.commands.addCommand(d.startCommand)):this.commands.removeCommand(d.startCommand)},value:!1},enableLiveAutocompletion:{set:function(e){e?(this.completers||(this.completers=Array.isArray(e)?e:T),this.commands.on("afterExec",a)):this.commands.off("afterExec",a)},value:!1},liveAutocompletionDelay:{initialValue:0},liveAutocompletionThreshold:{initialValue:0},enableSnippets:{set:function(e){e?(this.commands.addCommand(n),this.on("changeMode",o),o(null,this)):(this.commands.removeCommand(n),this.off("changeMode",o))},value:!1}})})),ace.require(["ace/ext/language_tools"],(function(e){"object"==typeof module&&"object"==typeof exports&&module&&(module.exports=e)}));